============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, rerunfailures-16.1, pyfakefs-6.0.0, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 300.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 957 items

tests/scripts/test_online_fetch_zeturf.py::test_fallback_parse_html_extracts_data PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R1-C1-R1C1] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[1-2-R1C2] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R4C5-None-R4C5] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag_raises_error PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_coerce_runner_entry PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_build_snapshot_payload PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_fetch_race_snapshot_cli 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:07 [INFO] [CLI] snapshot chargé depuis snapshot.json
PASSED                                                                   [  0%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[1-2-R1C2] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R1-C2-R1C2] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R3-10-R3C10] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[4-5-R4C5] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_slugify_hippodrome PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[12,5-12.5] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[15.5-15.5] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[20-20.0] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[abc-None] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[None-None] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_extracts_data PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_data_odd_attribute PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_cotes_infos_script PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_missing_cheval PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_tbody PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_no_runners_table PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_runner_missing_data PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw0-expected0] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw1-expected1] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw2-expected2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw3-expected3] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw4-expected4] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw5-expected5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw6-expected6] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw7-expected7] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw8-None] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw9-expected9] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_invalid_input PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_normalise_snapshot_result_merges_h30_odds PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_normalise_snapshot_result_no_market PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_http_get_raises_on_403 PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_http_get_raises_on_suspicious_html PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_double_extract_parses_real_html_fixture 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:08 [WARNING] [ZEturf] Extraction fallback utilisée pour https://www.zeturf.fr/fr/course/2025-11-20/R1C1 (snapshot=H-30)
2026-01-03 18:57:08 [INFO] [ZEturf] phase=H30 url=https://www.zeturf.fr/fr/course/2025-11-20/R1C1-saint-galmier partants=12
PASSED                                                                   [  4%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_runners_table_finds_no_runners PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_script_finds_no_odds PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_data_finds_nothing PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_double_extract_uses_fallback 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [WARNING] [ZEturf] Champ clé manquant: meeting (url=http://example.com, snapshot=H-30)
2026-01-03 18:57:10 [WARNING] [ZEturf] Champ clé manquant: discipline (url=http://example.com, snapshot=H-30)
2026-01-03 18:57:10 [WARNING] [ZEturf] Champ clé manquant: partants (url=http://example.com, snapshot=H-30)
2026-01-03 18:57:10 [WARNING] [ZEturf] Aucun partant détecté (url=http://example.com, snapshot=H-30) — retournera une liste vide
2026-01-03 18:57:10 [WARNING] [ZEturf] Extraction fallback utilisée pour http://example.com (snapshot=H-30)
PASSED                                                                   [  4%]
tests/scripts/test_simulate_ev_script.py::test_implied_prob_valid PASSED [  4%]
tests/scripts/test_simulate_ev_script.py::test_implied_prob_invalid PASSED [  4%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_basic PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_with_invalids PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_zero_total PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_empty PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_implied_probs_list PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_implied_probs_with_invalid_odds PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_ideal PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_fallback_prob PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_stake_capping PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_min_stake_filter PASSED [  5%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_no_valid_runners PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_all_pass PASSED   [  6%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_sp_fails PASSED   [  6%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_combo_fails PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_risk_fails_both PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_sharpe_fails_both PASSED [  6%]
tests/scripts/test_simulate_wrapper_script.py::test_simulate_wrapper_uses_calibrated_probability PASSED [  6%]
tests/scripts/test_simulate_wrapper_script.py::test_simulate_wrapper_fallback_no_correlation PASSED [  6%]
tests/scripts/test_simulate_wrapper_script.py::test_correlation_penalty_defaults_gracefully PASSED [  6%]
tests/scripts/test_simulate_wrapper_script.py::test_simulate_wrapper_applies_correlation_penalty PASSED [  7%]
tests/test_analysis_drift.py::test_drift_is_detected_and_applied 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Starting analysis pipeline for phase.
2026-01-03 18:57:10 [INFO] Fetching race details from data source.
2026-01-03 18:57:10 [INFO] Snapshot fetched successfully.
2026-01-03 18:57:10 [INFO] Snapshot saved to GCS at data/2025-01-01_R1C1/snapshots/20260103_175710_H-5.json
2026-01-03 18:57:10 [INFO] Preparing to run GPI ticket generation.
2026-01-03 18:57:10 [INFO] H-5 phase: attempting to load H-30 snapshot for drift.
2026-01-03 18:57:10 [INFO] Found latest H-30 snapshot: data/R1C1/snapshots/20250101_120000_H-30.json
2026-01-03 18:57:10 [INFO] Calling generate_tickets.
2026-01-03 18:57:10 [INFO] Analysis and ticket generation complete.
PASSED                                                                   [  7%]
tests/test_analysis_drift.py::test_pipeline_raises_if_doc_id_missing PASSED [  7%]
tests/test_analysis_drift.py::test_pipeline_abstains_if_snapshot_is_empty 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Starting analysis pipeline for phase.
2026-01-03 18:57:10 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  7%]
tests/test_analysis_drift.py::test_pipeline_handles_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Starting analysis pipeline for phase.
2026-01-03 18:57:10 [ERROR] Analysis pipeline failed: Unexpected GCS error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/analysis_pipeline.py", line 156, in run_analysis_for_phase
    snapshot_data, gcs_path = await _fetch_and_save_snapshot(
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Unexpected GCS error

PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [WARNING] No snapshots found in directory.
PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_h30_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [WARNING] No H-30 snapshot found for drift calculation.
PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_list_files_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [ERROR] Failed to find or load H-30 snapshot: GCS List Error
PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_read_file_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [ERROR] Failed to find or load H-30 snapshot: GCS Read Error
PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_empty_snapshot_from_data_source 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Starting analysis pipeline for phase.
2026-01-03 18:57:10 [INFO] Fetching race details from data source.
2026-01-03 18:57:10 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  7%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_snapshot_with_no_runners 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Starting analysis pipeline for phase.
2026-01-03 18:57:10 [INFO] Fetching race details from data source.
2026-01-03 18:57:10 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  8%]
tests/test_analysis_utils.py::test_normalise_text[None-] PASSED          [  8%]
tests/test_analysis_utils.py::test_normalise_text[  \xc9curie Sp\xe9ciale  -ecurie speciale] PASSED [  8%]
tests/test_analysis_utils.py::test_normalise_text[  -] PASSED            [  8%]
tests/test_analysis_utils.py::test_normalise_text[TROT-trot] PASSED      [  8%]
tests/test_analysis_utils.py::test_normalise_text[handicap-handicap] PASSED [  8%]
tests/test_analysis_utils.py::test_coerce_partants[14-14] PASSED         [  8%]
tests/test_analysis_utils.py::test_coerce_partants[14.0-14] PASSED       [  8%]
tests/test_analysis_utils.py::test_coerce_partants[14 partants-14] PASSED [  8%]
tests/test_analysis_utils.py::test_coerce_partants[environ 14-14] PASSED [  8%]
tests/test_analysis_utils.py::test_coerce_partants[None-None] PASSED     [  9%]
tests/test_analysis_utils.py::test_coerce_partants[True-None] PASSED     [  9%]
tests/test_analysis_utils.py::test_coerce_partants[N/A-None] PASSED      [  9%]
tests/test_analysis_utils.py::test_coerce_partants[-5-None] PASSED       [  9%]
tests/test_analysis_utils.py::test_compute_overround_cap_default PASSED  [  9%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_handicap_large_field PASSED [  9%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_large_field_from_label PASSED [  9%]
tests/test_analysis_utils.py::test_compute_overround_cap_small_field_uses_default PASSED [  9%]
tests/test_analysis_utils.py::test_compute_overround_cap_updates_context PASSED [  9%]
tests/test_analysis_utils_extended.py::test_parse_musique[1p2p(23)3p4hDAI-expected0] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_parse_musique[0a9a8a-expected1] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_parse_musique[None-expected2] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_parse_musique[   -expected3] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data0-VOLATIL] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data1-VOLATIL] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data2-VOLATIL] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data3-S\xdbR] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data4-VOLATIL] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data5-NEUTRE] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list0-expected_probs0-1.0] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list1-expected_probs1-0.0] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list2-expected_probs2-0.25] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list3-expected_probs3-0.5] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data0-True] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data1-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data2-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data3-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data4-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data0-True] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data1-False] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data2-False] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data3-False] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data4-False] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data0-expected_score0] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data1-expected_score1] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data2-0.0] PASSED [ 12%]
tests/test_api_endpoints.py::test_health_check_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Request started
2026-01-03 18:57:10 [INFO] Request finished
2026-01-03 18:57:10 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 12%]
tests/test_api_endpoints.py::test_pronostics_ui_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Request started
2026-01-03 18:57:10 [INFO] Request finished
2026-01-03 18:57:10 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 12%]
tests/test_api_endpoints.py::test_root_redirect 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:10 [INFO] Request started
2026-01-03 18:57:10 [INFO] Request finished
2026-01-03 18:57:11 [INFO] HTTP Request: GET http://testserver/ "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_date_validation 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:11 [INFO] Request started
2026-01-03 18:57:11 [INFO] Request finished
2026-01-03 18:57:11 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=not-a-real-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_default_date_is_today 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:11 [INFO] Request started
2026-01-03 18:57:11 [INFO] Building plan for 2025-07-15 using Boturfers as the single source.
2026-01-03 18:57:11 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-07-15
2026-01-03 18:57:11 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:11 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-07-15 "HTTP/1.1 404 Not Found"
2026-01-03 18:57:11 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-07-15: 404
2026-01-03 18:57:11 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-03 18:57:11 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-03 18:57:11 [INFO] Request finished
2026-01-03 18:57:11 [INFO] HTTP Request: GET http://testserver/api/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_empty_response 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:11 [INFO] Request started
2026-01-03 18:57:11 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-03 18:57:11 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-03 18:57:11 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:11 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-03 18:57:11 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-03 18:57:11 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-03 18:57:11 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-03 18:57:11 [INFO] Request finished
2026-01-03 18:57:11 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_etag_304_not_modified 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:11 [INFO] Request started
2026-01-03 18:57:11 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-03 18:57:11 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-03 18:57:11 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:11 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-03 18:57:11 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-03 18:57:11 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-03 18:57:11 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-03 18:57:11 [INFO] Request finished
2026-01-03 18:57:11 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
2026-01-03 18:57:11 [INFO] Request started
2026-01-03 18:57:11 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-03 18:57:11 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-03 18:57:11 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:11 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-03 18:57:11 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-03 18:57:11 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-03 18:57:11 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-03 18:57:11 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 304 Not Modified"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_rich_response_structure 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_security.py::test_api_key_authentication 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received request to schedule day races. Force: False, Dry Run: True
2026-01-03 18:57:12 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_security.py::test_ops_run_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 13%]
tests/test_api_security.py::test_ops_status_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 13%]
tests/test_api_security.py::test_api_key_not_required 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received request to schedule day races. Force: False, Dry Run: True
2026-01-03 18:57:12 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_valid_token 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received run-phase request for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-03 18:57:12 [INFO] Updating Firestore document
2026-01-03 18:57:12 [INFO] Run phase completed successfully for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_google_auth_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_invalid_token_scheme 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_snapshot_9h_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_bootstrap_day_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_tasks.py::test_snapshot_9h_task_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received snapshot-9h request for 2026-01-03 with URLs: [], RC Labels: []
2026-01-03 18:57:12 [INFO] Snapshot-9h completed successfully for 2026-01-03.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_tasks.py::test_snapshot_9h_task_with_specific_date_and_urls 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received snapshot-9h request for 2025-10-26 with URLs: ['http://example.com/r1c1', 'http://example.com/r1c2'], RC Labels: []
2026-01-03 18:57:12 [INFO] Snapshot-9h completed successfully for 2025-10-26.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_tasks.py::test_run_phase_task_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Starting Firestore-native course analysis
2026-01-03 18:57:12 [INFO] Course analysis completed successfully.
2026-01-03 18:57:12 [INFO] Updating Firestore document
2026-01-03 18:57:12 [INFO] Run phase completed successfully for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_tasks.py::test_run_phase_task_run_course_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Starting Firestore-native course analysis
2026-01-03 18:57:12 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: mock_error_from_analysis
2026-01-03 18:57:12 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_run_phase_task_exception_handling 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Starting Firestore-native course analysis
2026-01-03 18:57:12 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: unexpected_error
2026-01-03 18:57:12 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_bootstrap_day_task_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received request to bootstrap day 2026-01-03
2026-01-03 18:57:12 [INFO] Building daily plan for 2026-01-03...
2026-01-03 18:57:12 [INFO] Plan built: 2 races for 2026-01-03.
2026-01-03 18:57:12 [INFO] Bootstrap day completed. Scheduled 3 tasks.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_bootstrap_day_task_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Request started
2026-01-03 18:57:12 [INFO] Received request to bootstrap day 2026-01-03
2026-01-03 18:57:12 [INFO] Building daily plan for 2026-01-03...
2026-01-03 18:57:12 [WARNING] Empty plan for 2026-01-03. No tasks to schedule.
2026-01-03 18:57:12 [INFO] Request finished
2026-01-03 18:57:12 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 404 Not Found"
PASSED                                                                   [ 15%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_meetings PASSED [ 15%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_reunions PASSED [ 15%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_data PASSED [ 15%]
tests/test_cron_decider.py::test_load_meetings_from_list PASSED          [ 15%]
tests/test_cron_decider.py::test_load_meetings_invalid_json_raises_error PASSED [ 15%]
tests/test_cron_decider.py::test_parse_start_iso_timestamp PASSED        [ 15%]
tests/test_cron_decider.py::test_parse_start_hh_mm_with_date_hint PASSED [ 16%]
tests/test_cron_decider.py::test_parse_start_invalid_format PASSED       [ 16%]
tests/test_cron_decider.py::test_parse_start_hh_mm_no_date_hint PASSED   [ 16%]
tests/test_cron_decider.py::test_invoke_runner 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [WARNING] Environment variable ALLOW_HEURISTIC not set; using default '0'
PASSED                                                                   [ 16%]
tests/test_cron_decider.py::test_main_meetings_file_not_found PASSED     [ 16%]
tests/test_cron_decider.py::test_main_happy_path_h5 PASSED               [ 16%]
tests/test_cron_decider.py::test_main_happy_path_h30 PASSED              [ 16%]
tests/test_cron_decider.py::test_main_no_trigger_outside_window PASSED   [ 16%]
tests/test_cron_decider.py::test_main_no_trigger_if_missing_info PASSED  [ 16%]
tests/test_cron_decider.py::test_main_empty_meetings_file PASSED         [ 17%]
tests/test_cron_decider.py::test_main_trigger_at_window_edge PASSED      [ 17%]
tests/test_dutching_allocation.py::test_equal_profit_stakes_sum PASSED   [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_valid_input PASSED [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_empty_odds_list PASSED [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list0] PASSED [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list1] PASSED [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list2] PASSED [ 17%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list3] PASSED [ 17%]
tests/test_dutching_utils.py::test_diversify_guard_no_correlation PASSED [ 17%]
tests/test_dutching_utils.py::test_diversify_guard_correlated_same_stable_driver_within_threshold PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_correlated_same_stable_driver_outside_threshold PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_different_stable_same_driver PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_same_stable_different_driver PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_missing_ecurie_or_driver_lenient PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_missing_chrono_lenient PASSED [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_empty_list PASSED     [ 18%]
tests/test_dutching_utils.py::test_diversify_guard_single_horse PASSED   [ 18%]
tests/test_dutching_utils.py::test_require_mid_odds_found PASSED         [ 18%]
tests/test_dutching_utils.py::test_require_mid_odds_not_found_all_low PASSED [ 19%]
tests/test_dutching_utils.py::test_require_mid_odds_not_found_all_high PASSED [ 19%]
tests/test_dutching_utils.py::test_require_mid_odds_empty_list PASSED    [ 19%]
tests/test_dutching_utils.py::test_require_mid_odds_missing_odds PASSED  [ 19%]
tests/test_dutching_utils.py::test_require_mid_odds_non_numeric_odds_ignored PASSED [ 19%]
tests/test_env_utils.py::test_get_env_missing_warns 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [WARNING] Environment variable MISSING_VAR not set; using default 'fallback'
PASSED                                                                   [ 19%]
tests/test_env_utils.py::test_get_env_required_missing_logs_critical 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [CRITICAL] Missing required environment variable 'REQUIRED_MISSING'. App may not function correctly.
PASSED                                                                   [ 19%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-03 18:57:12 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 19%]
tests/test_env_utils.py::test_get_env_alias_support 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [INFO] Environment variable ALIAS_VAR='alias_value' used as alias for PRIMARY_VAR
PASSED                                                                   [ 19%]
tests/test_env_utils.py::test_get_env_casting_error_returns_default 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [ERROR] Invalid value for environment variable 'INT_VAR': 'not-an-int'. Returning default.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/config/env_utils.py", line 75, in get_env
    value = cast(raw_value)
            ^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'not-an-int'
PASSED                                                                   [ 19%]
tests/test_env_utils.py::test_get_env_value_equals_default_no_override_log PASSED [ 20%]
tests/test_env_utils.py::test_get_env_required_missing_non_prod_logs_critical_no_exit 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:12 [CRITICAL] Missing required environment variable 'NON_PROD_REQUIRED'. App may not function correctly.
PASSED                                                                   [ 20%]
tests/test_ev_calculator.py::test_make_hashable_hashable_types PASSED    [ 20%]
tests/test_ev_calculator.py::test_make_hashable_list PASSED              [ 20%]
tests/test_ev_calculator.py::test_make_hashable_dict PASSED              [ 20%]
tests/test_ev_calculator.py::test_make_hashable_nested_structures PASSED [ 20%]
tests/test_ev_calculator.py::test_make_hashable_unhashable_fallback PASSED [ 20%]
tests/test_ev_calculator.py::test_kelly_fraction_valid_inputs PASSED     [ 20%]
tests/test_ev_calculator.py::test_kelly_fraction_probability_out_of_range PASSED [ 20%]
tests/test_ev_calculator.py::test_kelly_fraction_odds_out_of_range PASSED [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_single_group PASSED     [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_multiple_groups PASSED  [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_no_dutching_groups PASSED [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_mixed_groups PASSED     [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_invalid_odds_in_group PASSED [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_single_valid_ticket_in_group PASSED [ 21%]
tests/test_ev_calculator.py::test_apply_dutching_group_too_small PASSED  [ 21%]
tests/test_ev_calculator.py::test_ticket_label_with_id PASSED            [ 21%]
tests/test_ev_calculator.py::test_ticket_label_with_name PASSED          [ 21%]
tests/test_ev_calculator.py::test_ticket_label_with_label PASSED         [ 22%]
tests/test_ev_calculator.py::test_ticket_label_with_selection PASSED     [ 22%]
tests/test_ev_calculator.py::test_ticket_label_with_runner PASSED        [ 22%]
tests/test_ev_calculator.py::test_ticket_label_no_label_keys_falls_back_to_index PASSED [ 22%]
tests/test_ev_calculator.py::test_ticket_label_empty_string_values_falls_back_to_index PASSED [ 22%]
tests/test_ev_calculator.py::test_clone_leg_dict PASSED                  [ 22%]
tests/test_ev_calculator.py::test_clone_leg_list_of_dicts PASSED         [ 22%]
tests/test_ev_calculator.py::test_clone_leg_primitive_type PASSED        [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_for_probability PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_details PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs PASSED [ 23%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_id_only PASSED [ 23%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_no_identifiable_legs PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_ticket_id PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_selection_id PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_leg_id_in_legs PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_mixed_dependencies PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_empty PASSED    [ 23%]
tests/test_ev_calculator.py::test_prepare_ticket_dependencies PASSED     [ 23%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_id_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_leg_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_no_specific_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_empty PASSED  [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_independent PASSED [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_positive_correlation PASSED [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_negative_correlation PASSED [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_rho_clipping PASSED [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_lower_bound PASSED [ 24%]
tests/test_ev_calculator.py::test_merge_legs_no_duplicates PASSED        [ 24%]
tests/test_ev_calculator.py::test_merge_legs_with_duplicates PASSED      [ 25%]
tests/test_ev_calculator.py::test_merge_legs_with_dict_duplicates PASSED [ 25%]
tests/test_ev_calculator.py::test_merge_legs_empty_inputs PASSED         [ 25%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_simulate_fn PASSED [ 25%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_legs PASSED [ 25%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_no_cache PASSED [ 25%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_miss PASSED [ 25%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_hit PASSED [ 25%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_and_cache PASSED [ 25%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_no_cache PASSED [ 26%]
tests/test_ev_calculator.py::test_estimate_joint_probability_no_simulate_fn_uses_approx PASSED [ 26%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_copula_monte_carlo PASSED [ 26%]
tests/test_ev_calculator.py::test_covariance_from_joint_positive PASSED  [ 26%]
tests/test_ev_calculator.py::test_covariance_from_joint_negative PASSED  [ 26%]
tests/test_ev_calculator.py::test_covariance_from_joint_zero_probability PASSED [ 26%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_tickets PASSED [ 26%]
tests/test_ev_calculator.py::test_compute_joint_moments_fewer_than_min_tickets PASSED [ 26%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_shared_exposures PASSED [ 26%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_positive_covariance PASSED [ 26%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_negative_covariance PASSED [ 27%]
tests/test_ev_calculator.py::test_compute_joint_moments_covariance_below_threshold PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-None-0.0] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.0-0.01-100-None-1.0] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.0-100-None-0.0] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.02-0.0] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.005-0.0] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.01-0.01-1-None-0.1353352832366127] PASSED [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin_invalid_bankroll PASSED   [ 27%]
tests/test_ev_calculator.py::test_risk_of_ruin_respects_baseline_variance PASSED [ 28%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_with_scipy PASSED [ 28%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_without_scipy_fallback_to_grid_search PASSED [ 28%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_empty_tickets PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_p_provided PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p_cached PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_no_p_or_legs_raises_value_error PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_p_raises_value_error PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_odds_raises_value_error PASSED [ 28%]
tests/test_ev_calculator.py::test_process_single_ticket_stake_capping_and_rounding PASSED [ 29%]
tests/test_ev_calculator.py::test_process_tickets_basic_functionality PASSED [ 29%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_single_ticket PASSED [ 29%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_with_combined_ticket PASSED [ 29%]
tests/test_ev_calculator.py::test_calculate_final_metrics_green_flag PASSED [ 29%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ev_ratio PASSED [ 29%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ror PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_ev_roi_basic_functionality PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_budget PASSED   [ 29%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_variance_cap_config PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_ev_roi_with_optimize_true PASSED [ 30%]
tests/test_ev_calculator.py::test_compute_ev_roi_variance_capping PASSED [ 30%]
tests/test_ev_thresholds.py::test_ev_sp_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 30%]
tests/test_ev_thresholds.py::test_ev_global_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 30%]
tests/test_ev_thresholds.py::test_validate_policy_roi_below_threshold PASSED [ 30%]
tests/test_ev_thresholds.py::test_validate_policy_raises_on_low_roi_message PASSED [ 30%]
tests/test_evaluate_combo.py::test_default_config_path_missing PASSED    [ 30%]
tests/test_evaluate_combo.py::test_env_path_missing PASSED               [ 30%]
tests/test_evaluate_combo.py::test_env_path_present PASSED               [ 30%]
tests/test_evaluate_combo.py::test_gates_when_calibration_missing PASSED [ 31%]
tests/test_evaluate_combo.py::test_override_missing_calibration 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 31%]
tests/test_evaluate_combo.py::test_with_calibration PASSED               [ 31%]
tests/test_evaluate_combo.py::test_marks_unreliable_probabilities 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 31%]
tests/test_fetch_je_stats.py::test_normalise_text[  Test String  -teststring] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_normalise_text[\xc9curie Sp\xe9ciale-ecuriespeciale] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_normalise_text[J. VANMEERBECK-jvanmeerbeck] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_parse_percentage[R\xe9ussite jockey/cheval : 15%-15.0] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_parse_percentage[Ratio: 3 / 10-30.0] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires : 5-5.0] PASSED [ 31%]
tests/test_fetch_je_stats.py::test_parse_percentage[Taux de r\xe9ussite : 0.25-25.0] PASSED [ 32%]
tests/test_fetch_je_stats.py::test_parse_percentage[Just a number 42.5 here-42.5] PASSED [ 32%]
tests/test_fetch_je_stats.py::test_parse_percentage[No number here-None] PASSED [ 32%]
tests/test_fetch_je_stats.py::test_parse_percentage[-None] PASSED        [ 32%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires=10-10.0] PASSED [ 32%]
tests/test_fetch_je_stats.py::test_parse_percentage[12,5%-12.5] PASSED   [ 32%]
tests/test_fetch_je_stats.py::test_extract_links_from_horse_page PASSED  [ 32%]
tests/test_fetch_je_stats.py::test_extract_rate_from_profile PASSED      [ 32%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name PASSED     [ 32%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name_http_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] Failed to fetch Geny search results for Bold Eagle
PASSED                                                                   [ 33%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_success PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_handles_failures 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] Failed to fetch horse page http://horse.url
PASSED                                                                   [ 33%]
tests/test_fetch_je_stats.py::test_collect_stats_integration PASSED      [ 33%]
tests/test_firestore_client.py::test_update_race_document_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Updating Firestore document
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_update_race_document_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [ERROR] Failed to update document some_id: Firestore unavailable
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 29, in update_race_document
    doc_ref = db.collection(config.FIRESTORE_COLLECTION).document(document_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Firestore unavailable
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_update_race_document_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] Firestore is not available, skipping update.
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_get_races_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_get_races_for_date_empty 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_get_races_for_date_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [ERROR] Failed to query races by date 2025-12-30: Query failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 51, in get_races_for_date
    races_ref = db.collection(config.FIRESTORE_COLLECTION)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Query failed
PASSED                                                                   [ 33%]
tests/test_firestore_client.py::test_get_races_for_date_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] Firestore is not available, cannot query races.
PASSED                                                                   [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-pmu-2025-12-25-2025-12-25_R1C2] PASSED [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://turf.fr/R5C3/details-2025-12-25-2025-12-25_R5C3] PASSED [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[R3C8-2025-12-25-2025-12-25_R3C8] PASSED [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[some-string-r4c1-other-2025-12-25-2025-12-25_R4C1] PASSED [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[invalid-url-2025-12-25-None] PASSED [ 34%]
tests/test_firestore_client.py::test_get_doc_id_from_url[-2025-12-25-None] PASSED [ 34%]
tests/test_firestore_client.py::test_get_processing_status_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 34%]
tests/test_firestore_client.py::test_get_processing_status_for_date_db_not_available PASSED [ 34%]
tests/test_firestore_client.py::test_get_processing_status_for_date_empty_daily_plan 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_get_processing_status_for_date_explicit_empty_plan_reason 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unprocessed_races 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_get_processing_status_for_date_error_decision 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unknown_decision 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] Queried races from Firestore
PASSED                                                                   [ 35%]
tests/test_firestore_client_extended.py::test_get_processing_status_for_date_processing_stalled PASSED [ 35%]
tests/test_firestore_client_extended.py::test_get_processing_status_for_date_db_empty PASSED [ 35%]
tests/test_gcs_client_extended.py::test_gcs_manager_init PASSED          [ 35%]
tests/test_gcs_client_extended.py::test_gcs_manager_init_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [WARNING] GCS_BUCKET is not set in the configuration. GCS operations will fail.
PASSED                                                                   [ 35%]
tests/test_gcs_client_extended.py::test_gcs_manager_lazy_init PASSED     [ 35%]
tests/test_gcs_client_extended.py::test_get_gcs_path PASSED              [ 36%]
tests/test_gcs_client_extended.py::test_file_exists PASSED               [ 36%]
tests/test_gcs_client_extended.py::test_get_gcs_fs PASSED                [ 36%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
PASSED                                                                   [ 36%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_singleton PASSED [ 36%]
tests/test_gcs_client_extended.py::test_get_gcs_fs_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-03 18:57:13 [ERROR] GCSManager is not initialized. Cannot get filesystem.
PASSED                                                                   [ 36%]
tests/test_gcs_client_extended.py::test_build_gcs_path PASSED            [ 36%]
tests/test_gcs_client_extended.py::test_build_gcs_path_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-03 18:57:13 [ERROR] GCSManager is not initialized. Cannot build GCS path.
PASSED                                                                   [ 36%]
tests/test_gcs_utils.py::test_is_gcs_enabled PASSED                      [ 36%]
tests/test_gcs_utils.py::test_is_gcs_disabled PASSED                     [ 36%]
tests/test_gcs_utils.py::test_disabled_reason_when_disabled PASSED       [ 37%]
tests/test_gcs_utils.py::test_disabled_reason_when_enabled PASSED        [ 37%]
tests/test_gcs_utils.py::test_get_gcs_client_initialization_success PASSED [ 37%]
tests/test_gcs_utils.py::test_get_gcs_client_initialization_failure 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:13 [ERROR] Failed to initialize GCS client: Auth failure
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/gcs_utils.py", line 23, in _get_gcs_client
    _gcs_client = storage.Client()
                  ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Auth failure
PASSED                                                                   [ 37%]
tests/test_gcs_utils.py::test_upload_file_gcs_disabled PASSED            [ 37%]
tests/test_gcs_utils.py::test_upload_file_client_is_none PASSED          [ 37%]
tests/test_gcs_utils.py::test_upload_file_local_file_not_found 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [WARNING] Local file not found, cannot upload to GCS: nonexistent/file.json
PASSED                                                                   [ 37%]
tests/test_gcs_utils.py::test_upload_file_path_construction[data/snapshots/R1C1/file.json-prod/snapshots/R1C1/file.json] PASSED [ 37%]
tests/test_gcs_utils.py::test_upload_file_path_construction[snapshots/R1C2/file.json-prod/snapshots/R1C2/file.json] PASSED [ 37%]
tests/test_gcs_utils.py::test_upload_file_path_construction[analyses/R1C3/file.json-prod/analyses/R1C3/file.json] PASSED [ 38%]
tests/test_gcs_utils.py::test_upload_file_path_construction[some/other/path/data/analyses/R1/file.json-prod/analyses/R1/file.json] PASSED [ 38%]
tests/test_gcs_utils.py::test_upload_file_path_construction[unknown/path/file.json-prod/unknown/path/file.json] PASSED [ 38%]
tests/test_gcs_utils.py::test_upload_file_gcs_api_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [ERROR] Failed to upload data/snapshots/R1C1/file.json to GCS: 403 Permission denied
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/gcs_utils.py", line 85, in upload_file
    blob.upload_from_filename(str(local_file))
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
google.api_core.exceptions.Forbidden: 403 Permission denied
PASSED                                                                   [ 38%]
tests/test_guardrails.py::test_evaluate_guardrail_uses_multiple_paths PASSED [ 38%]
tests/test_guardrails.py::test_evaluate_guardrail_detects_low_values PASSED [ 38%]
tests/test_guardrails.py::test_load_json_raises_on_non_object PASSED     [ 38%]
tests/test_guardrails.py::test_extract_metric_returns_zero_when_missing PASSED [ 38%]
tests/test_guardrails.py::test_append_env_writes_to_file PASSED          [ 38%]
tests/test_guardrails.py::test_main_success_path PASSED                  [ 38%]
tests/test_guardrails.py::test_main_abstention_path_creates_report PASSED [ 39%]
tests/test_guardrails.py::test_main_file_not_found PASSED                [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-1.0-1.0-0.25] PASSED    [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.2-3.0-1.0-1.0-0.0] PASSED     [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.3333333333333333-3.0-1.0-1.0-0.0] PASSED [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-0.5-1.0-0.125] PASSED   [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-0.2-0.2] PASSED     [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-0.5-0.3-0.3] PASSED     [ 39%]
tests/test_kelly.py::test_kelly_fraction[1.5-3.0-1.0-1.0-0.0] PASSED     [ 39%]
tests/test_kelly.py::test_kelly_fraction[0.0-3.0-1.0-1.0-0.0] PASSED     [ 40%]
tests/test_kelly.py::test_kelly_fraction[-0.5-3.0-1.0-1.0-0.0] PASSED    [ 40%]
tests/test_kelly.py::test_kelly_fraction[0.5-1.0-1.0-1.0-0.0] PASSED     [ 40%]
tests/test_kelly.py::test_kelly_fraction[0.5-0.5-1.0-1.0-0.0] PASSED     [ 40%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0--0.5-1.0-0.25] PASSED   [ 40%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-1.5-0.7] PASSED     [ 40%]
tests/test_kelly.py::test_kelly_stake PASSED                             [ 40%]
tests/test_kelly_cap.py::test_kelly_cap_limits_stakes PASSED             [ 40%]
tests/test_kelly_cap.py::test_validate_budget_ok PASSED                  [ 40%]
tests/test_kelly_cap.py::test_validate_budget_total_exceeded PASSED      [ 40%]
tests/test_kelly_cap.py::test_validate_budget_horse_cap_exceeded PASSED  [ 41%]
tests/test_logging_io.py::test_csv_header_and_columns PASSED             [ 41%]
tests/test_no_vig_ev.py::test_no_vig_sum_to_one PASSED                   [ 41%]
tests/test_no_vig_ev.py::test_ev_drops_when_margin_higher PASSED         [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>14h05</td>-14:05] PASSED [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'> 9h30 </td>-09:30] PASSED [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>21:45</td>-21:45] PASSED [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>08:15</td>-08:15] PASSED [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>12h00</td>-12:00] PASSED [ 41%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>No time here</td>-None] PASSED [ 42%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td></td>-None] PASSED [ 42%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.boturfers.fr/courses/2025-01-01/r2c3-race-name-R2-C3] PASSED [ 42%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.boturfers.fr/courses/2025-01-01/R2C3-race-name-R2-C3] PASSED [ 42%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-R1-C2] PASSED [ 42%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://zeturf.com/R12C5/details-R12-C5] PASSED [ 42%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_no_match_raises_value_error PASSED [ 42%]
tests/test_orchestrator_runner.py::test_run_course_extract_rc_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [ERROR] Invalid URL format
PASSED                                                                   [ 42%]
tests/test_orchestrator_runner.py::test_run_course_analysis_pipeline_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [INFO] Starting Firestore-native course analysis
2026-01-03 18:57:14 [INFO] Course analysis completed successfully.
PASSED                                                                   [ 42%]
tests/test_orchestrator_runner.py::test_run_course_analysis_pipeline_failure 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [ERROR] Course analysis failed.
PASSED                                                                   [ 42%]
tests/test_orchestrator_runner.py::test_run_course_unexpected_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Unexpected error
PASSED                                                                   [ 43%]
tests/test_overround.py::test_compute_overround_place_nominal PASSED     [ 43%]
tests/test_overround.py::test_compute_overround_place_with_odds_place_fallback PASSED [ 43%]
tests/test_overround.py::test_compute_overround_place_with_cote_fallback PASSED [ 43%]
tests/test_overround.py::test_compute_overround_place_mixed_sources PASSED [ 43%]
tests/test_overround.py::test_compute_overround_place_handles_invalid_data PASSED [ 43%]
tests/test_overround.py::test_compute_overround_place_empty_list 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [WARNING] Could not calculate place overround: no valid place odds found.
PASSED                                                                   [ 43%]
tests/test_overround.py::test_compute_overround_place_no_valid_odds 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:14 [WARNING] Could not calculate place overround: no valid place odds found.
PASSED                                                                   [ 43%]
tests/test_overround.py::test_adaptive_cap_returns_base_cap PASSED       [ 43%]
tests/test_p_finale.py::test_apply_drift_steam_no_pval PASSED            [ 43%]
tests/test_p_finale.py::test_apply_drift_steam_no_maps PASSED            [ 44%]
tests/test_p_finale.py::test_apply_drift_steam_invalid_map_data PASSED   [ 44%]
tests/test_p_finale.py::test_apply_drift_steam_applies_steam_bonus PASSED [ 44%]
tests/test_p_finale.py::test_apply_drift_steam_applies_drift_penalty_to_fav PASSED [ 44%]
tests/test_p_finale.py::test_apply_drift_steam_no_penalty_for_drifting_non_favorite PASSED [ 44%]
tests/test_p_finale.py::test_apply_drift_steam_no_change_if_delta_not_met PASSED [ 44%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[runners] PASSED [ 44%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[horses] PASSED [ 44%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[partants] PASSED [ 44%]
tests/test_p_finale.py::test_generate_p_finale_data_empty_if_no_runners PASSED [ 45%]
tests/test_p_finale.py::test_generate_p_finale_data_extracts_all_fields_with_fallbacks PASSED [ 45%]
tests/test_p_finale.py::test_generate_p_finale_data_handles_non_dict_runners PASSED [ 45%]
tests/test_p_finale.py::test_generate_p_finale_data_calls_apply_drift_steam PASSED [ 45%]
tests/test_p_finale.py::test_generate_p_finale_data_no_drift_call_if_maps_missing PASSED [ 45%]
tests/test_p_finale_export.py::test_export_creates_csv_and_excel PASSED  [ 45%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map0-p30_map0-2-0.515] PASSED [ 45%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map1-p30_map1-1-0.485] PASSED [ 45%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map2-p30_map2-2-0.5] PASSED [ 45%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map3-p30_map3-1-0.5] PASSED [ 45%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-None-p30_map4-1-0.5] PASSED [ 46%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map5-None-1-0.5] PASSED [ 46%]
tests/test_p_finale_extended.py::test_apply_drift_steam[None-1-p5_map6-p30_map6-1-0.0] PASSED [ 46%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_basic PASSED [ 46%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_empty_runners PASSED [ 46%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_no_drift_config PASSED [ 46%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_roi_is_low PASSED [ 46%]
tests/test_pipeline_run.py::test_generate_tickets_creates_sp_dutching_ticket_when_roi_is_high PASSED [ 46%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_global_roi_is_low PASSED [ 46%]
tests/test_pipeline_run.py::test_generate_tickets_creates_trio_ticket_with_best_roi PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_success PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_missing_budget_raises_error PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_empty_runners_raises_error PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_missing_critical_key_raises_error PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_missing_base_probabilities_raises_error PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_p_base_fallback_from_win_odds PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_real_favorites_detection PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_overround_calculation PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_bonus PASSED [ 47%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_malus PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_volatility_bonus PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_musique_score PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_no_je_or_volatility_data PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_success PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_no_best_chronos PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_malformed_chrono_data PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_no_h30_odds PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_stable_odds PASSED [ 48%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_drift_detected PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_steam_detected PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_favorite_drift_factor PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_outsider_steam_factor PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_high_odds_clamping PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_min_candidates PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_mid_range_priority PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_max_candidates_limit PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_generate_sp_dutching_tickets_no_profitable_candidates PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_generate_sp_dutching_tickets_profitable_candidates_creates_ticket PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[COUPLE-2] PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[COUPLE_PLACE-2] PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[ZE234-2] PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[TRIO-3] PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[ZE4-4] PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[UNKNOWN-3] 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [WARNING] Unknown exotic type 'UNKNOWN', assuming 3 legs.
PASSED                                                                   [ 50%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_no_profitable_combos PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_overround_too_high PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_no_allowed_types PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_not_enough_sp_candidates PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_no_tickets PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_low_global_roi PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_play PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_generate_tickets_populates_top5_pronostic PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_generate_tickets_populates_market_analysis_table PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_p_base_value_error PASSED [ 51%]
tests/test_plan.py::test_build_plan_nominal_case 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 2 races from Boturfers.
2026-01-03 18:57:15 [INFO] Plan complete: 2 races with times
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_scraper_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_handles_malformed_data 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 3 races from Boturfers.
2026-01-03 18:57:15 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_today_string 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2026-01-03 using Boturfers as the single source.
2026-01-03 18:57:15 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_empty_enriched_plan 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-03 18:57:15 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-03 18:57:15 [INFO] Plan complete: 0 races with times
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_handles_compact_rc_format 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_wrapper 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_raises_in_event_loop 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [WARNING] build_plan() is deprecated, use build_plan_async() instead
2026-01-03 18:57:15 [ERROR] Cannot use build_plan() from within event loop. Use build_plan_async() instead.
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_reraises_other_runtime_errors 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 52%]
tests/test_plan_extended.py::test_build_plan_handles_various_invalid_rc_formats 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 4 races from Boturfers.
2026-01-03 18:57:15 [WARNING] Could not parse R/C from 'R C'. Skipping race.
2026-01-03 18:57:15 [WARNING] Could not parse R/C from 'R1C'. Skipping race.
2026-01-03 18:57:15 [WARNING] Could not parse R/C from 'RC1'. Skipping race.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_plan_extended.py::test_build_plan_data_types 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_plan_extended.py::test_build_plan_invalid_runners_count 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_plan_extended.py::test_build_plan_mandatory_keys 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-03 18:57:15 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-03 18:57:15 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_post_course_payload.py::test_merge_meta_both_sources PASSED   [ 53%]
tests/test_post_course_payload.py::test_merge_meta_tickets_takes_priority PASSED [ 53%]
tests/test_post_course_payload.py::test_merge_meta_with_top_level_keys PASSED [ 53%]
tests/test_post_course_payload.py::test_merge_meta_handles_missing_or_invalid_inputs PASSED [ 53%]
tests/test_post_course_payload.py::test_merge_meta_model_alias PASSED    [ 53%]
tests/test_post_course_payload.py::test_compute_post_course_summary_nominal PASSED [ 53%]
tests/test_post_course_payload.py::test_compute_post_course_summary_no_winners PASSED [ 53%]
tests/test_post_course_payload.py::test_compute_post_course_summary_empty_tickets PASSED [ 53%]
tests/test_post_course_payload.py::test_summarise_ticket_metrics PASSED  [ 53%]
tests/test_post_course_payload.py::test_apply_summary_to_ticket_container PASSED [ 54%]
tests/test_post_course_payload.py::test_build_payload PASSED             [ 54%]
tests/test_post_course_payload.py::test_build_payload_from_sources PASSED [ 54%]
tests/test_post_course_payload.py::test_format_csv_line PASSED           [ 54%]
tests/test_resolve_course_id.py::test_resolve_course_context_with_fallback PASSED [ 54%]
tests/test_resolve_course_id.py::test_resolve_course_context_picks_closest_future_entry PASSED [ 54%]
tests/test_resolve_course_id.py::test_resolve_course_context_errors_when_empty PASSED [ 54%]
tests/test_resolve_course_id.py::test_iter_schedule_entries_supports_fr_course_urls PASSED [ 54%]
tests/test_resolve_course_id.py::test_resolve_course_context_supports_fr_course_urls PASSED [ 54%]
tests/test_roi_rebalancer.py::test_compute_allocation_plan_prioritises_high_ev PASSED [ 54%]
tests/test_roi_rebalancer.py::test_plan_serialisation_round_trip PASSED  [ 55%]
tests/test_roi_rebalancer.py::test_allocation_plan_requires_positive_bankroll PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_empty_tickets PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_no_positive_ev_tickets PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_stake_cap PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_invalid_ticket_format PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_allocation_plan_serialization PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_zero_bankroll PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_nominal PASSED [ 55%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_missing_metrics_block PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_ev_block PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_calculates_ev_from_roi_and_stake PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_with_invalid_values PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_from_dir PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_with_direct_file_paths PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_skips_malformed_files PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_skips_files_with_no_metrics PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_with_non_existent_path PASSED [ 56%]
tests/test_roi_rebalancer_extended.py::test_score_basic PASSED           [ 56%]
tests/test_roi_rebalancer_extended.py::test_score_zero_ev PASSED         [ 57%]
tests/test_roi_rebalancer_extended.py::test_score_high_risk PASSED       [ 57%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_basic PASSED      [ 57%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_zero_stake PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_zero_target_stake PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_clamps_max PASSED [ 57%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: True) ---
2026-01-03 18:57:15 [WARNING] Skipping task: Schedule time 2026-01-03T16:27:00+00:00 is in the past.
2026-01-03 18:57:15 [WARNING] Skipping task: Schedule time 2026-01-03T16:52:00+00:00 is in the past.
2026-01-03 18:57:15 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-03 18:57:15 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 57%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: True) ---
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.585364+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.585637+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.585897+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.586144+00:00
2026-01-03 18:57:15 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-03 18:57:15 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 57%]
tests/test_scheduler.py::test_schedule_all_races_real_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.597120+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.597464+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.597706+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.598048+00:00
2026-01-03 18:57:15 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-03 18:57:15 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098595392'>
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098595392'>
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098595392'>
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098595392'>
2026-01-03 18:57:15 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 57%]
tests/test_scheduler.py::test_schedule_all_races_real_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: False) ---
2026-01-03 18:57:15 [WARNING] Skipping task: Schedule time 2026-01-03T16:27:00+00:00 is in the past.
2026-01-03 18:57:15 [WARNING] Skipping task: Schedule time 2026-01-03T16:52:00+00:00 is in the past.
2026-01-03 18:57:15 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-03 18:57:15 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098753760'>
2026-01-03 18:57:15 [INFO] Enqueuing Cloud Task
2026-01-03 18:57:15 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='137983098753760'>
2026-01-03 18:57:15 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 57%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_phase_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [ERROR] Error calculating schedule time: invalid literal for int() with base 10: 'NVALID'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 35, in _calculate_task_schedule
    phase_minutes = int(phase[1:])
                    ^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'NVALID'
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_race_time_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [ERROR] Error calculating schedule time: Invalid isoformat string: '2025-01-01Tnot-a-time'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 36, in _calculate_task_schedule
    race_datetime_local = datetime.fromisoformat(f"{date}T{race_time_local}")
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Invalid isoformat string: '2025-01-01Tnot-a-time'
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_enqueue_run_task_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [ERROR] Service URL is not configured. Cannot create task.
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_enqueue_run_task_oidc_config_missing 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [ERROR] Failed to create task for http://example.com/race: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 106, in enqueue_run_task
    raise ValueError("TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.")
ValueError: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_enqueue_run_task_permission_denied 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [CRITICAL] Permission denied to create Cloud Task. Please grant 'roles/cloudtasks.enqueuer' to 'sa@example.com'. Original error: 403 Forbidden by policy
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_enqueue_run_task_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [ERROR] Failed to create task for http://example.com/race: Network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 124, in enqueue_run_task
    response = client.create_task(parent=parent_path, task=task)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Network error
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_schedule_all_races_real_run_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [CRITICAL] Cannot execute real run without a service_url.
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_schedule_all_races_cloud_tasks_client_init_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [CRITICAL] Failed to initialize Cloud Tasks client: Client init failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 209, in schedule_all_races
    client = tasks_v2.CloudTasksClient()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Client init failed
PASSED                                                                   [ 58%]
tests/test_scheduler_extended.py::test_schedule_all_races_results_are_sorted 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:15 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.735153+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.735458+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.735704+00:00
2026-01-03 18:57:15 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-03T17:59:15.735958+00:00
2026-01-03 18:57:15 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-03 18:57:15 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-03 18:57:15 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 58%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_success PASSED [ 59%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_value_error PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_success PASSED  [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_request_error PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_status_error PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_generic_exception PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_success PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_elements PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[14h30-14:30] PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[9h05-09:05] PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[11:15-11:15] PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[invalid-None] PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[-None] PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[None-None] PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_runners_count_non_digit PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_success PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_reunion_tabs PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_race_table_in_reunion PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_success PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_not_found PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_no_info_block PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_no_runners_table PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_malformed_row PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:16 [ERROR] Erreur inattendue lors du fetch HTML de http://programme.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:16 [ERROR] Erreur inattendue lors du fetch HTML de http://race.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_success PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_empty_url PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_fetcher_error PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_no_races_returned PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_general_exception PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_success PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_empty_url PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_url_partant_transformation PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_fetcher_error PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_no_runners_returned PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_general_exception PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_link PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_missing_conditions PASSED [ 63%]
tests/test_scraper_boturfers_extended.py::test_boturfers_fetcher_init_value_error PASSED [ 63%]
tests/test_scraper_boturfers_extended.py::test_fetcher_fetch_html_httpx_status_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:17 [ERROR] Erreur HTTP lors du téléchargement de http://test.url: 404
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers_extended.py::test_fetcher_fetch_html_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:18 [ERROR] Erreur inattendue lors du fetch HTML de http://test.url: Network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Network error
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_no_reunion_tabs 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:18 [WARNING] Aucun onglet de réunion ('div.tab-pane[id^=r]') trouvé sur la page du programme.
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_no_race_table_in_reunion 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:19 [WARNING] Tableau des courses ('table.table.data.prgm') introuvable pour la réunion R1.
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_reunion_id_from_id_attribute PASSED [ 63%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_empty_race_table PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_malformed_reunion_title PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_not_found PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_from_span_tag PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_from_span_tag_fallback_after_info_block_no_distance PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_no_info_block 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:22 [WARNING] Aucune métadonnée de course n'a pu être extraite de http://race.url.
PASSED                                                                   [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_no_conditions_tag_and_no_conditions_text PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_conditions_from_text_snippet PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_empty_metadata_logs_warning 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:24 [WARNING] Aucune métadonnée de course n'a pu être extraite de http://race.url.
PASSED                                                                   [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_no_runners_table 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:24 [WARNING] Could not find runners table ('table.data') on the page.
PASSED                                                                   [ 64%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_malformed_row 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:24 [WARNING] Failed to parse a runner row: list index out of range. Row skipped.
PASSED                                                                   [ 65%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_runners_from_details_page_no_odds PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_missing_musique_gains PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_row_runners_count_non_digit PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_row_missing_url PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_row_no_name_tag PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_row_missing_runners_count_tag PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type attel\xe9-Attel\xe9-N/A] PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type mont\xe9 corde \xe0 gauche-Mont\xe9-Gauche] PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type plat corde \xe0 droite-Plat-Droite] PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type obstacle-Obstacle-N/A] PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type inconnu-None-N/A] PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_with_odds_place PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_get_snapshot_fetch_html_fails PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_get_snapshot_no_races_extracted 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:30 [ERROR] Aucune course n'a pu être extraite de http://programme.url.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_get_race_snapshot_fetch_html_fails PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_get_race_snapshot_no_runners_extracted 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:30 [ERROR] Aucun partant n'a pu être extrait de http://race.url.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_fetch_boturfers_programme_fetcher_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:30 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:30 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_fetch_boturfers_race_details_fetcher_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:30 [INFO] Début du scraping des détails de course.
2026-01-03 18:57:30 [ERROR] Le scraping des détails a échoué.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_robustness.py::test_parse_programme_handles_broken_reunion_class PASSED [ 67%]
tests/test_scraper_boturfers_robustness.py::test_parse_programme_handles_missing_race_table PASSED [ 67%]
tests/test_scraper_geny.py::test_slugify[Paris-Vincennes (FR)-paris-vincennes-fr] PASSED [ 67%]
tests/test_scraper_geny.py::test_slugify[Hippodrome de la C\xf4te d'Azur-hippodrome-de-la-cote-d-azur] PASSED [ 67%]
tests/test_scraper_geny.py::test_slugify[Saint-Cloud-saint-cloud] PASSED [ 67%]
tests/test_scraper_geny.py::test_slugify[123 Test-123-test] PASSED       [ 67%]
tests/test_scraper_geny.py::test_slugify[-] PASSED                       [ 67%]
tests/test_scraper_geny.py::test_slugify[   -] PASSED                    [ 67%]
tests/test_scraper_geny.py::test_slugify[  _!@# my string 123-my-string-123] PASSED [ 67%]
tests/test_scraper_geny.py::test_fetch_geny_programme_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Discovered 2 meetings from Geny
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_no_races_container 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [WARNING] No 'next-races-container' found on Geny page.
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_empty_rows 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_malformed_row_elements 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [WARNING] Could not find meeting element 'th.race-name' in a row. Skipping row.
2026-01-03 18:57:31 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_request_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [ERROR] An error occurred while requesting 'http://mock.url': Mock request error
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_status_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [ERROR] Error response 404 while requesting 'http://mock.url': Not Found
PASSED                                                                   [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_id_course_from_href_fallback 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Discovered 1 meetings from Geny
PASSED                                                                   [ 68%]
tests/test_scraper_zeturf.py::test_fetch_race_snapshot_full_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] [ZEturf] phase=H30 url=https://www.zeturf.fr/fr/course/2025-11-20/R1C1-saint-galmier partants=12
PASSED                                                                   [ 68%]
tests/test_scraper_zeturf.py::test_phase_norm[H-30-H30] PASSED           [ 68%]
tests/test_scraper_zeturf.py::test_phase_norm[H30-H30] PASSED            [ 68%]
tests/test_scraper_zeturf.py::test_phase_norm[h05-H5] PASSED             [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[H5-H5] PASSED              [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[UNKNOWN-H30] PASSED        [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[-H30] PASSED               [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[None-H30] PASSED           [ 69%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_success PASSED [ 69%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_value_error_no_rc PASSED [ 69%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_empty_snapshot PASSED [ 69%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_missing_runners PASSED [ 69%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_non_dict_snapshot PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_h5_phase_input PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_various_rc_formats PASSED [ 70%]
tests/test_service.py::test_get_pronostics_page 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_get_pronostics_data_empty_case 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_get_pronostics_data_with_data 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_get_ops_status 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_get_ops_status_reason_if_empty 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_health_check 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 70%]
tests/test_service.py::test_legacy_redirects 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: GET http://testserver/api/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 70%]
tests/test_service.py::test_post_ops_run_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Manual run triggered for race R1C1 on 2026-01-03
2026-01-03 18:57:31 [INFO] Successfully processed and saved manual run for 2026-01-03_R1C1
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_run_single_race_missing_course_url 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Manual run triggered for race R1C1 on 2026-01-03
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 400 Bad Request"
PASSED                                                                   [ 71%]
tests/test_service.py::test_run_single_race_unhandled_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Manual run triggered for race R1C1 on 2026-01-03
2026-01-03 18:57:31 [ERROR] Critical error during manual run for 2026-01-03_R1C1: Simulated pipeline error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/service.py", line 280, in run_single_race
    analysis_result = await analysis_pipeline.run_analysis_for_phase(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Simulated pipeline error
2026-01-03 18:57:31 [INFO] Request finished
2026-01-03 18:57:31 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 71%]
tests/test_service.py::test_schedule_day_races_unhandled_exception 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [ERROR] UNHANDLED EXCEPTION in /schedule endpoint: Simulated unhandled error
TRACEBACK:
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/service.py", line 212, in schedule_day_races
    daily_plan = await plan.build_plan_async(plan_date)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Simulated unhandled error

PASSED                                                                   [ 71%]
tests/test_service.py::test_api_pronostics_schema 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:31 [INFO] Request started
2026-01-03 18:57:31 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-03 18:57:31 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-03 18:57:31 [INFO] Début du scraping du programme Boturfers.
2026-01-03 18:57:32 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-03 18:57:32 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-03 18:57:32 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-03 18:57:32 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_ui_contains_critical_elements_and_api_call 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_daily_plan_invalid_date_format 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/api/plan?date=not-a-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_ops_status_invalid_date_format 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/ops/status?date=not-a-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 71%]
tests/test_service_extended.py::test_get_pronostics_data_invalid_date 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=invalid-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 71%]
tests/test_service_extended.py::test_get_pronostics_data_plan_only 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service_smoke.py::test_ping_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service_smoke.py::test_pronostics_endpoint_returns_data 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Request started
2026-01-03 18:57:32 [INFO] Request finished
2026-01-03 18:57:32 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-10 "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_simulate_ev_module.py::test_implied_probs_normalizes PASSED   [ 72%]
tests/test_simulate_ev_module.py::test_normalize_overround_balances_dict PASSED [ 72%]
tests/test_simulate_ev_module.py::test_kelly_fraction_basic PASSED       [ 72%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_cap PASSED   [ 72%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_min_stake_filter PASSED [ 72%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_skips_invalid PASSED [ 72%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_uses_precomputed_implied_probs PASSED [ 72%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_fallbacks_when_probabilities_invalid PASSED [ 73%]
tests/test_simulate_ev_module.py::test_gate_ev_thresholds PASSED         [ 73%]
tests/test_simulate_ev_module.py::test_gate_ev_sharpe_min PASSED         [ 73%]
tests/test_simulate_ev_module.py::test_simulate_ev_batch_uses_simulate_wrapper PASSED [ 73%]
tests/test_simulate_wrapper.py::test_calibration_details_expose_metadata PASSED [ 73%]
tests/test_simulate_wrapper.py::test_beta_binomial_fallback PASSED       [ 73%]
tests/test_simulate_wrapper.py::test_invalid_calibration PASSED          [ 73%]
tests/test_simulate_wrapper.py::test_combination_order PASSED            [ 73%]
tests/test_simulate_wrapper.py::test_cache_prevents_recomputation PASSED [ 73%]
tests/test_simulate_wrapper.py::test_cache_eviction PASSED               [ 73%]
tests/test_simulate_wrapper.py::test_fallback_uses_leg_probabilities PASSED [ 74%]
tests/test_simulate_wrapper.py::test_fallback_uses_implied_odds PASSED   [ 74%]
tests/test_simulate_wrapper.py::test_correlation_penalty_reduces_probability_and_ev PASSED [ 74%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] No race plan found for 2025-01-01. No snapshots will be created.
PASSED                                                                   [ 74%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_successful_run 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Starting daily snapshot job for 2025-01-01, phase H-5
2026-01-03 18:57:32 [INFO] Found 2 races for 2025-01-01. Creating snapshots...
2026-01-03 18:57:32 [INFO] Finished creating 2 snapshot tasks for 2025-01-01.
PASSED                                                                   [ 74%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_incomplete_race_data 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Skipping race with incomplete data: {'date': '2025-01-01', 'r_label': 'R2', 'c_label': 'C1'}
2026-01-03 18:57:32 [WARNING] Skipping race with incomplete data: {'course_url': 'url3', 'r_label': 'R3', 'c_label': 'C1'}
PASSED                                                                   [ 74%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_error_handling 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [ERROR] Failed during daily snapshot job for 2025-01-01: Failed to build plan
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/snapshot_manager.py", line 33, in write_snapshot_for_day_async
    plan = await build_plan_async(date_str)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Failed to build plan
PASSED                                                                   [ 74%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_sync_wrapper PASSED [ 74%]
tests/test_stats_fetcher_extended.py::test_collect_stats_no_snapshot_metadata 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [ERROR] Cannot collect stats, no snapshot found for race_id in phase H-5
PASSED                                                                   [ 74%]
tests/test_stats_fetcher_extended.py::test_collect_stats_snapshot_metadata_no_path 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [ERROR] Cannot collect stats, no snapshot found for race_id in phase H-5
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_no_runners_in_snapshot 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] No runners found in snapshot path/to/snapshot.json, cannot collect stats.
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_successful_run 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Starting stats collection for race_id
2026-01-03 18:57:32 [INFO] Successfully fetched chrono stats for Horse A
2026-01-03 18:57:32 [INFO] Successfully fetched jockey stats for Jockey A: 25.0%
2026-01-03 18:57:32 [INFO] Successfully fetched trainer stats for Trainer A: 30.0%
2026-01-03 18:57:32 [INFO] Successfully fetched chrono stats for Horse B
2026-01-03 18:57:32 [INFO] Successfully fetched jockey stats for Jockey B: 15.0%
2026-01-03 18:57:32 [INFO] Successfully fetched trainer stats for Trainer B: 10.0%
2026-01-03 18:57:32 [WARNING] Could not fetch chrono stats for Horse C
2026-01-03 18:57:32 [WARNING] Jockey name not available for runner Horse C
2026-01-03 18:57:32 [INFO] Successfully fetched trainer stats for Trainer C: 5.0%
2026-01-03 18:57:32 [WARNING] Could not fetch chrono stats for Horse D
2026-01-03 18:57:32 [INFO] Successfully fetched jockey stats for Jockey D: 20.0%
2026-01-03 18:57:32 [WARNING] Trainer name not available for runner Horse D
2026-01-03 18:57:32 [INFO] Successfully saved aggregated stats to path/to/stats.json
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_error_fetching_chrono 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [ERROR] Error fetching chrono stats for Horse A: Chrono error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 74, in collect_stats
    chrono_data = await zoneturf_client.get_chrono_stats(horse_name=runner_name)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Chrono error
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_error_fetching_jockey_trainer 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [ERROR] Error fetching jockey stats for Jockey A: Jockey/Trainer error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 93, in collect_stats
    jockey_stats = await zoneturf_client.get_jockey_trainer_stats(jockey_name, "jockey")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Jockey/Trainer error
2026-01-03 18:57:32 [ERROR] Error fetching trainer stats for Trainer A: Jockey/Trainer error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 118, in collect_stats
    trainer_stats = await zoneturf_client.get_jockey_trainer_stats(trainer_name, "entraineur")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 93, in collect_stats
    jockey_stats = await zoneturf_client.get_jockey_trainer_stats(jockey_name, "jockey")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Jockey/Trainer error
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_save_snapshot_failure 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [CRITICAL] CRITICAL: Failed to save stats snapshot to GCS: GCS save error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 172, in collect_stats
    stats_gcs_path = await gcs_client.save_snapshot(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: GCS save error
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_missing_jockey_trainer_names 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Jockey name not available for runner Horse A
2026-01-03 18:57:32 [WARNING] Trainer name not available for runner Horse A
2026-01-03 18:57:32 [WARNING] Trainer name not available for runner Horse B
2026-01-03 18:57:32 [WARNING] Jockey name not available for runner Horse C
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_runner_without_num_or_nom 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [INFO] Starting stats collection for race_id
2026-01-03 18:57:32 [INFO] Successfully fetched chrono stats for Horse C
2026-01-03 18:57:32 [INFO] Successfully fetched jockey stats for Jockey C: 20.0%
2026-01-03 18:57:32 [INFO] Successfully fetched trainer stats for Trainer C: 20.0%
2026-01-03 18:57:32 [INFO] Successfully saved aggregated stats to path/to/stats.json
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_chrono_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Could not fetch chrono stats for Horse A
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_jockey_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Could not fetch jockey stats for Jockey A
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_trainer_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Could not fetch trainer stats for Trainer A
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'11"6-71.6] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'12''3-72.3] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'10"-70.0] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[59"8-59.8] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[None-None] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[-None] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[invalid-None] 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:32 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:32 [WARNING] Could not parse chrono string: invalid
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_horse_chrono_parsing 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_cache_hit 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_scraping 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_not_found 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [INFO] Cache miss for horse 'Unknown Horse'. Resolving via scraping.
2026-01-03 18:57:33 [WARNING] Could not resolve ID for horse 'Unknown Horse' after scraping.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_pagination_limit 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [INFO] Cache miss for horse 'My Horse'. Resolving via scraping.
2026-01-03 18:57:33 [WARNING] Could not resolve ID for horse 'My Horse' after scraping.
PASSED                                                                   [ 77%]
tests/test_stats_provider_extended.py::test_slugify PASSED               [ 77%]
tests/test_stats_provider_extended.py::test_normalize_name 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_success 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_network_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [ERROR] An error occurred while fetching chrono for 'Test Horse': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 301, in fetch_horse_chrono
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_http_status_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [ERROR] HTTP error while fetching chrono for 'Test Horse': Not Found
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_records_table 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_performances_table 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_data_returns_none 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [WARNING] No chrono data found for horse 'Test Horse' at /cheval/test-horse-12345/
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_network_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [ERROR] An error occurred while fetching stats for jockey 'Test Jockey': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 368, in fetch_jockey_stats
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_http_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:33 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:33 [ERROR] HTTP error while fetching stats for jockey 'Test Jockey': Server Error
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_no_header 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:34 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:34 [WARNING] Stats section not found for jockey 'Test Jockey' at /jockey/test-jockey-123/
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_no_table 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:34 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:34 [WARNING] Stats table not found for jockey 'Test Jockey' at /jockey/test-jockey-123/
PASSED                                                                   [ 78%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_network_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:34 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:34 [ERROR] An error occurred while fetching stats for trainer 'Test Trainer': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 433, in fetch_trainer_stats
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 79%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_http_error 
-------------------------------- live log setup --------------------------------
2026-01-03 18:57:34 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:34 [ERROR] HTTP error while fetching stats for trainer 'Test Trainer': Server Error
PASSED                                                                   [ 79%]
tests/test_tickets_store.py::test_client_returns_storage_client PASSED   [ 79%]
tests/test_tickets_store.py::test_blob_path_constructs_correct_path PASSED [ 79%]
tests/test_tickets_store.py::test_index_path_constructs_correct_path PASSED [ 79%]
tests/test_tickets_store.py::test_render_ticket_html_full_payload PASSED [ 79%]
tests/test_tickets_store.py::test_render_ticket_html_minimal_payload PASSED [ 79%]
tests/test_tickets_store.py::test_render_ticket_html_different_keys_for_ev_roi_tickets PASSED [ 79%]
tests/test_tickets_store.py::test_save_ticket_html_success PASSED        [ 79%]
tests/test_tickets_store.py::test_save_ticket_html_no_bucket_env_var_raises_error PASSED [ 80%]
tests/test_tickets_store.py::test_build_and_save_ticket_success PASSED   [ 80%]
tests/test_tickets_store.py::test_list_ticket_objects_success PASSED     [ 80%]
tests/test_tickets_store.py::test_list_ticket_objects_empty_list PASSED  [ 80%]
tests/test_tickets_store.py::test_list_ticket_objects_no_bucket_env_var_raises_error PASSED [ 80%]
tests/test_tickets_store.py::test_rebuild_index_success PASSED           [ 80%]
tests/test_tickets_store.py::test_rebuild_index_no_bucket_env_var_raises_error PASSED [ 80%]
tests/test_tickets_store.py::test_load_ticket_html_success PASSED        [ 80%]
tests/test_tickets_store.py::test_load_ticket_html_no_bucket_env_var_raises_error PASSED [ 80%]
tests/test_ui.py::test_read_main 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:34 [INFO] Request started
2026-01-03 18:57:34 [INFO] Request finished
2026-01-03 18:57:34 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 80%]
tests/test_update_excel_planning.py::test_cli_invalid_phase_raises_error PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[nb_partants-10-partants-10] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[runners_count-11 partants-partants-11] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[start-10h30-start_time-10:30] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[heure_depart-11:00-start_time-11:00] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[specialite-Steeple-discipline-Steeple] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[r-R5-reunion-R5] PASSED [ 81%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[c-C6-course-C6] PASSED [ 81%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets0-] PASSED [ 81%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets1-SG:1@4.5] PASSED [ 82%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets2-JUM:2-4@12.1 | TRIO:5-6-7] PASSED [ 82%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets3-WEIRD:8-9] PASSED [ 82%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets4-2S4:10-11-12] PASSED [ 82%]
tests/test_update_excel_planning.py::test_h30_updates_existing_row PASSED [ 82%]
tests/test_update_excel_planning.py::test_h30_populates_planning_sheet PASSED [ 82%]
tests/test_update_excel_planning.py::test_h5_updates_status_and_tickets PASSED [ 82%]
tests/test_update_excel_planning.py::test_h5_abstention_uses_reason PASSED [ 82%]
tests/test_update_excel_planning.py::test_h5_preserves_existing_metadata_when_missing PASSED [ 82%]
tests/test_update_excel_planning.py::test_h5_converts_timezone_when_tz_env_set PASSED [ 82%]
tests/test_update_excel_planning.py::test_custom_status_h5_flag PASSED   [ 83%]
tests/test_update_excel_planning.py::test_custom_status_h30_and_h5 PASSED [ 83%]
tests/test_update_excel_planning.py::test_h30_preserves_existing_comment PASSED [ 83%]
tests/test_update_excel_planning.py::test_h30_handles_nested_course_payload PASSED [ 83%]
tests/test_update_excel_planning.py::test_h30_infers_rc_fields PASSED    [ 83%]
tests/test_update_excel_planning.py::test_h5_infers_rc_fields PASSED     [ 83%]
tests/test_update_excel_planning.py::test_h5_compact_ticket_summary PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_respects_input_timezone PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_uses_env_timezone PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[13h05-13:05] PASSED [ 84%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[7h-07:00] PASSED [ 84%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[09 heures 30-09:30] PASSED [ 84%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[18.45-18:45] PASSED [ 84%]
tests/test_update_excel_planning.py::test_cli_alias_and_dash_phase PASSED [ 84%]
tests/test_update_excel_with_results.py::test_update_excel_records_observed_roi PASSED [ 84%]
tests/test_validator_ev.py::test_validate_ev_passes_with_defaults 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 84%]
tests/test_validator_ev.py::test_validate_ev_sp_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 84%]
tests/test_validator_ev.py::test_validate_ev_combo_optional 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 84%]
tests/test_validator_ev.py::test_validate_ev_combo_required 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 84%]
tests/test_validator_ev.py::test_validate_ev_logs_context 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': 18.0, 'stake': 10.0, 'EV_ratio': 0.35}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_probability 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': 25.0, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_payout 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:35 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_policy_pass PASSED             [ 85%]
tests/test_validator_ev.py::test_validate_policy_fail_ev PASSED          [ 85%]
tests/test_validator_ev.py::test_validate_policy_fail_roi PASSED         [ 85%]
tests/test_validator_ev.py::test_validate_combos_pass PASSED             [ 85%]
tests/test_validator_ev.py::test_validate_combos_fail_default PASSED     [ 85%]
tests/test_validator_ev.py::test_combos_allowed_thresholds PASSED        [ 85%]
tests/test_validator_ev.py::test_validate_inputs_ok PASSED               [ 85%]
tests/test_validator_ev.py::test_validate_inputs_partants_insuffisants PASSED [ 86%]
tests/test_validator_ev.py::test_validate_inputs_cote_none PASSED        [ 86%]
tests/test_validator_ev.py::test_validate_inputs_couverture PASSED       [ 86%]
tests/test_validator_ev.py::test_summarise_validation_success PASSED     [ 86%]
tests/test_validator_ev.py::test_summarise_validation_failure_returns_reason PASSED [ 86%]
tests/test_validator_ev.py::test_validator_cli_returns_non_zero_on_failure PASSED [ 86%]
tests/test_validator_ev_extended.py::test_validate_inputs_happy_path PASSED [ 86%]
tests/test_validator_ev_extended.py::test_validate_inputs_not_enough_partants PASSED [ 86%]
tests/test_validator_ev_extended.py::test_validate_inputs_missing_odds PASSED [ 86%]
tests/test_validator_ev_extended.py::test_validate_inputs_none_in_odds PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_inputs_je_coverage_insufficient PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_inputs_je_coverage_missing_but_allowed PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_inconsistent_partants PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_no_partants PASSED    [ 87%]
tests/test_validator_ev_extended.py::test_validate_missing_odds_h30 PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_non_numeric_odds_h5 PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_invalid_odds_h30 PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_missing_je_stats_when_required PASSED [ 87%]
tests/test_validator_ev_extended.py::test_validate_happy_path PASSED     [ 87%]
tests/test_validator_ev_extended.py::test_validate_je_stats_not_required PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_sp_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_global_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_global_none_and_combo_needed 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_happy_path_with_combo 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_happy_path_no_combo 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_missing_p_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': 10, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_ev_missing_payout_expected 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [INFO] [validate_ev] context {'p_success': 0.5, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 88%]
tests/test_validator_ev_extended.py::test_validate_policy_ev_below_threshold PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_policy_roi_below_threshold PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_policy_happy_path PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_budget_total_exceeded PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_budget_per_horse_exceeded PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_budget_happy_path PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_combos_payout_below_threshold PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_combos_happy_path PASSED [ 89%]
tests/test_validator_ev_extended.py::test_combos_allowed_ev_below_threshold PASSED [ 89%]
tests/test_validator_ev_extended.py::test_combos_allowed_payout_below_threshold PASSED [ 89%]
tests/test_validator_ev_extended.py::test_combos_allowed_invalid_inputs PASSED [ 89%]
tests/test_validator_ev_extended.py::test_combos_allowed_happy_path PASSED [ 90%]
tests/test_validator_ev_extended.py::test_cli_happy_path PASSED          [ 90%]
tests/test_validator_ev_extended.py::test_cli_file_not_found PASSED      [ 90%]
tests/test_validator_ev_extended.py::test_cli_validation_error PASSED    [ 90%]
tests/test_validator_ev_extended.py::test_cli_readme_roi_mismatch PASSED [ 90%]
tests/test_validator_ev_extended.py::test_cli_allow_je_na_flag PASSED    [ 90%]
tests/test_validator_ev_extended.py::test_load_cfg_no_config_file PASSED [ 90%]
tests/test_validator_ev_extended.py::test_load_cfg_invalid_yaml_returns_empty_dict 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [WARNING] Invalid YAML in config/gpi.yml, returning empty config.
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_readme PASSED [ 90%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_match PASSED [ 91%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_invalid_value PASSED [ 91%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_below_target PASSED [ 91%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_above_target PASSED [ 91%]
tests/test_validator_ev_extended.py::test_summarise_validation_all_pass PASSED [ 91%]
tests/test_validator_ev_extended.py::test_summarise_validation_first_fails PASSED [ 91%]
tests/test_validator_ev_extended.py::test_must_have_falsy_value_raises_runtime_error PASSED [ 91%]
tests/test_validator_ev_extended.py::test_must_have_truthy_value_returns_value PASSED [ 91%]
tests/test_validator_ev_extended.py::test_normalise_phase_invalid_phase_raises_value_error PASSED [ 91%]
tests/test_validator_ev_extended.py::test_normalise_phase_h5 PASSED      [ 91%]
tests/test_validator_ev_extended.py::test_normalise_phase_h30 PASSED     [ 92%]
tests/test_validator_ev_extended.py::test_normalise_phase_none_returns_h5 PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_json_payload_invalid_json_raises_json_decode_error PASSED [ 92%]
tests/test_validator_ev_extended.py::test_find_first_existing_none_found PASSED [ 92%]
tests/test_validator_ev_extended.py::test_find_first_existing_found PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_partants_invalid_list_format_returns_empty_list PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_partants_invalid_dict_format_raises_value_error PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_odds_empty_odds_map_raises_value_error PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_odds_from_dict_with_invalid_values PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_odds_from_list_with_invalid_values PASSED [ 92%]
tests/test_validator_ev_extended.py::test_load_config_non_existent_path PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_config_invalid_yaml 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [WARNING] Invalid YAML in invalid.yml, returning empty config.
PASSED                                                                   [ 93%]
tests/test_validator_ev_extended.py::test_load_config_invalid_json 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:36 [WARNING] Invalid JSON in invalid.json, returning empty config.
PASSED                                                                   [ 93%]
tests/test_validator_ev_extended.py::test_load_config_valid_yaml PASSED  [ 93%]
tests/test_validator_ev_extended.py::test_load_config_valid_json PASSED  [ 93%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-jullou] PASSED [ 93%]
tests/test_zoneturf_client.py::test_normalize_name[  Jullou  -jullou] PASSED [ 93%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou (FR)-jullou] PASSED [ 93%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard-jullou nivard] PASSED [ 93%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard (FR)-jullou nivard] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[\xc9curie Royale-ecurie royale] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou's Horse-jullous horse] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[-] PASSED             [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[None-] PASSED         [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11"6-71.6] PASSED  [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'15''3-75.3] PASSED [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'20"0-80.0] PASSED  [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[0'59"9-59.9] PASSED  [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[None-None] PASSED    [ 94%]
tests/test_zoneturf_client.py::test_parse_rk_string[-None] PASSED        [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[invalid-None] PASSED [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11-None] PASSED    [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-03 18:57:37 [INFO] Resolved 'Jullou' to ID: 1772764
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'NonExistentHorse' via alphabetical pages...
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_network_error 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-03 18:57:37 [WARNING] Failed to fetch page https://www.zone-turf.fr/cheval/lettre-j.html?p=1: Network issue
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_cache_hit PASSED    [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_no_alpha_in_name PASSED [ 95%]
tests/test_zoneturf_client.py::test_resolve_person_id_success 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'Julien Dupont' (jockey) via alphabetical pages...
2026-01-03 18:57:37 [INFO] Resolved 'Julien Dupont' to ID: 112233
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_resolve_person_id_cache_hit PASSED   [ 96%]
tests/test_zoneturf_client.py::test_resolve_person_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'NonExistentJockey' (jockey) via alphabetical pages...
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_with_jullou_page PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_no_chrono_data PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_empty_content PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_record PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_table_chrono PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_correctly_finds_jullou_chrono PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_success PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_no_stats_block PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_empty_content PASSED [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_success PASSED      [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Could not get Zone-Turf ID for horse: Jullou
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Failed to fetch Zone-Turf page for Jullou due to network error
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Failed to fetch Zone-Turf page for Jullou (ID: 1772764) with status 404
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_cache_hit PASSED    [ 97%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_success PASSED [ 97%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Could not get Zone-Turf ID for jockey: Julien Dupont
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_cache_hit PASSED [ 97%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont due to network error
PASSED                                                                   [ 98%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont (ID: 112233) with status 404
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/cheval/lettre-t.html?p=1
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_info_card PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_performance_card PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_tag PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_text PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_list_group PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_attelle_li PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_red_km_header PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_malformed_row PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_other_horse_name PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_multiple_attelle_sections PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/jockey/lettre-t.html?p=1
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-03 18:57:37 [INFO] Resolving Zone-Turf ID for 'TestPerson' (jockey) via alphabetical pages...
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_rates PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_table PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_malformed_table_data PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_no_stat_paragraph PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
_backup_conflicts/Updatekelly.py                                34     34     18      0     0%   1-117
_backup_conflicts/__init__.py                                    0      0      0      0   100%
_backup_conflicts/analysis_utils.py                             56     56     26      0     0%   3-84
_backup_conflicts/analyze_specific_race.py                      33     33      8      0     0%   2-51
_backup_conflicts/backtest.py                                   78     78     28      0     0%   9-173
_backup_conflicts/backup_restore.py                            202    202     48      0     0%   14-362
_backup_conflicts/build_dataset_from_zeturf_geny.py             23     23      2      0     0%   1-36
_backup_conflicts/build_fr_2024_cotes_arrivees_rapports.py      59     59     20      0     0%   1-81
_backup_conflicts/check_imports.py                               6      6      2      0     0%   1-7
_backup_conflicts/cli_ev.py                                     45     45     10      0     0%   2-91
_backup_conflicts/concat_je_month.py                           105    105     44      0     0%   11-182
_backup_conflicts/corrected_plan_parser.py                     164    164     48      0     0%   6-369
_backup_conflicts/cron_decider.py                               75     75     26      0     0%   9-127
_backup_conflicts/debug_imports.py                               1      1      0      0     0%   2
_backup_conflicts/debug_main.py                                  8      8      0      0     0%   1-11
_backup_conflicts/diag_import.py                                16     16      0      0     0%   2-24
_backup_conflicts/drive_sync.py                                  8      8      2      0     0%   7-20
_backup_conflicts/enrich_requirements.py                        49     49     20      0     0%   4-100
_backup_conflicts/fetch_je_chrono.py                            79     79     20      0     0%   3-179
_backup_conflicts/fetch_reunions_geny.py                        47     47      8      0     0%   4-86
_backup_conflicts/fetch_with_playwright.py                      48     48     12      0     0%   4-69
_backup_conflicts/find_race_script.py                           27     27      8      0     0%   2-45
_backup_conflicts/fix_service.py                                19     19      0      0     0%   2-27
_backup_conflicts/generate_test_plan.py                         44     44      8      0     0%   7-112
_backup_conflicts/get_arrivee_geny.py                          368    368    200      0     0%   22-628
_backup_conflicts/get_todays_plan.py                             8      8      2      0     0%   1-12
_backup_conflicts/gunicorn_config.py                            28     28      0      0     0%   4-62
_backup_conflicts/horse_racing_orchestrator.py                 425    425     86      0     0%   31-986
_backup_conflicts/init.py                                        2      2      0      0     0%   7-8
_backup_conflicts/iterate_race_scraper.py                      191    191     54      0     0%   43-426
_backup_conflicts/lint_sources.py                               94     94     32      0     0%   3-185
_backup_conflicts/logging_io.py                                 18     18      2      0     0%   1-53
_backup_conflicts/logging_untils.py                             57     57     24      0     0%   5-142
_backup_conflicts/merge_all_data.py                             21     21      2      0     0%   2-41
_backup_conflicts/module_dutching_pmu.py                       151    151     58      0     0%   29-283
_backup_conflicts/monitor_roi.py                               202    202     48      0     0%   14-362
_backup_conflicts/online_fetch_zeturf.py                         1      1      0      0     0%   2
_backup_conflicts/pmu_api_client.py                            151    151     24      0     0%   14-389
_backup_conflicts/post_course.py                                51     51      2      0     0%   10-111
_backup_conflicts/prompt_analyse.py                             20     20      2      0     0%   8-60
_backup_conflicts/pytest_config.py                              98     98      8      0     0%   32-314
_backup_conflicts/recalibrate_payouts_pro.py                    33     33     12      0     0%   2-45
_backup_conflicts/resolve_course_id.py                         141    141     64      0     0%   2-258
_backup_conflicts/restore_from_drive.py                         33     33     12      0     0%   3-53
_backup_conflicts/scheduler_plan.py                             15     15      6      0     0%   5-30
_backup_conflicts/show_profile.py                                4      4      0      0     0%   2-6
_backup_conflicts/simulate_wrapper.py                          473    473    242      0     0%   15-828
_backup_conflicts/stats_collector.py                           182    182     38      0     0%   16-544
_backup_conflicts/temp_plan_runner.py                           21     21      6      0     0%   1-46
_backup_conflicts/test_parser_local.py                          24     24      6      0     0%   2-37
_backup_conflicts/test_snapshot.py                               7      7      2      0     0%   1-10
_backup_conflicts/tickets_builder.py                           289    289    160      0     0%   1-519
_backup_conflicts/time_utils.py                                 50     50     16      0     0%   5-147
_backup_conflicts/tools_check_imports.py                         7      7      2      0     0%   1-10
_backup_conflicts/unified_plan_builder.py                      215    215     68      0     0%   14-459
_backup_conflicts/unit_tests_complete.py                       281    281      8      0     0%   5-651
_backup_conflicts/update_excel_planning.py                       1      1      0      0     0%   4
_backup_conflicts/validator_ev_v2.py                             0      0      0      0   100%
check_firestore_data.py                                         35     35      8      0     0%   1-62
config/__init__.py                                               0      0      0      0   100%
config/env_utils.py                                             38      1     16      1    96%   91
debug_task_client.py                                            32     32      4      0     0%   1-55
gunicorn_conf.py                                                36     36      0      0     0%   5-73
hippique/__init__.py                                             0      0      0      0   100%
hippique/analytics/__init__.py                                   2      0      0      0   100%
hippique/analytics/roi_rebalancer.py                           139      6     42      6    93%   32, 51, 97, 163, 216, 224
hippique/utils/__init__.py                                       0      0      0      0   100%
hippique/utils/dutching.py                                      46      2     24      2    94%   26, 43
hippique/utils/probabilities.py                                 14      2      4      2    78%   11, 26
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97      0     14      1    99%   82->85
hippique_orchestrator/analysis_utils.py                        181      8     82      8    93%   61-62, 68-69, 103->105, 107-108, 109->112, 224->252, 229->235, 247, 315->323, 372
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74      9     10      1    88%   85-91, 134-140, 214->194, 242-248
hippique_orchestrator/auth.py                                   28      3      8      1    89%   29, 63-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      5      2      0    61%   61-69
hippique_orchestrator/ev_calculator.py                         522     36    208     13    91%   164->171, 171->161, 291, 340, 417, 479, 498-499, 540->543, 643-687, 731, 897, 923, 957-962
hippique_orchestrator/fetch_je_stats.py                        259     58     66     18    76%   62-69, 73, 86-93, 109, 129, 132, 149, 181->183, 191-192, 197, 205->202, 207-208, 226->231, 229-230, 232->237, 235-236, 279->303, 283->303, 290->294, 294->298, 298->303, 300-301, 348-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       76      0     26      0   100%
hippique_orchestrator/gcs_client.py                             71     17     14      2    75%   43->45, 91-98, 112-114, 124, 144-148
hippique_orchestrator/gcs_utils.py                              52      0     10      0   100%
hippique_orchestrator/kelly.py                                  42      6     18      4    83%   12, 14-15, 48, 59, 61
hippique_orchestrator/logging_io.py                             39     19     10      3    47%   42-44, 47->51, 59-66, 71-79
hippique_orchestrator/logging_middleware.py                     22      4      0      0    82%   50-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25      0     10      0   100%
hippique_orchestrator/p_finale.py                               41      0     22      0   100%
hippique_orchestrator/pipeline_run.py                          353     10    142     15    95%   45, 82-83, 88->90, 100, 171-172, 242, 322->337, 367->369, 379->385, 437->425, 460, 498->494, 503->507, 507->535, 599->586, 612->586, 684-685
hippique_orchestrator/plan.py                                   42      0     16      0   100%
hippique_orchestrator/post_course_payload.py                   181      6     62     10    93%   85->84, 125-128, 245->247, 249->251, 252, 292->299, 294->296, 298, 301->305, 303->305
hippique_orchestrator/runner.py                                 35      0      6      0   100%
hippique_orchestrator/scheduler.py                             101      0     28      0   100%
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206      7     80      6    95%   99-104, 109, 143->141, 151, 163->165, 170, 217
hippique_orchestrator/scrapers/geny.py                          61      1     14      2    96%   87, 95->98
hippique_orchestrator/scrapers/zeturf.py                        26      0      6      0   100%
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66      1     20      1    98%   133
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39      0     14      0   100%
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1048    375    576    112    60%   53-62, 83, 95-96, 100, 110, 116-117, 121->124, 158, 172-175, 177->167, 191, 225-236, 246, 265-277, 281->279, 286-287, 288->283, 291, 317, 337->339, 340, 342, 349-352, 360-361, 365, 377, 379, 396->399, 402->405, 419->421, 421->424, 424->393, 444, 470-471, 475, 477, 481, 486, 499, 507, 516, 547->556, 552->556, 557-563, 580-581, 599->605, 611-624, 637-683, 705, 708, 712-719, 723-726, 743, 746, 776-804, 812-820, 830, 839, 862->858, 874, 877-883, 914-915, 927->930, 945->950, 948->950, 951, 987->983, 1013-1020, 1025-1029, 1042->1049, 1044->1043, 1046->1043, 1049->1086, 1054-1058, 1061-1066, 1071-1072, 1074->1068, 1096-1100, 1103-1107, 1110-1114, 1116->1132, 1123->1130, 1133-1138, 1141, 1168, 1170-1173, 1185, 1187, 1194-1197, 1211-1234, 1243, 1248-1249, 1255, 1264->1260, 1270-1271, 1275-1277, 1280, 1286->1288, 1288->1290, 1291, 1303, 1309, 1333->1301, 1337-1372, 1383-1385, 1391->1418, 1396, 1404, 1416, 1419-1421, 1428, 1431, 1434, 1450, 1457->1461, 1459->1458, 1504->1506, 1506->1508, 1554->1557, 1566->1591, 1610-1613, 1618, 1621-1622, 1630, 1637-1638, 1645-1646, 1649->1658, 1656, 1694-1853, 1858, 1862
hippique_orchestrator/scripts/p_finale_export.py                80     30     30     10    56%   15-17, 28-38, 44, 49-50, 69-70, 80->87, 81->80, 84->80, 88-89, 97-100, 103-104, 110, 123-125
hippique_orchestrator/scripts/resolve_course_id.py             141     52     64     13    59%   41, 44, 47-48, 52, 60, 82->88, 84->88, 89-94, 106, 120-170, 178, 182, 204->209, 206->209, 210-213, 226-256
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221     57     98     13    72%   64, 76-77, 88-89, 102-103, 112-113, 122-123, 143, 162, 182, 186->188, 195, 225, 268-284, 297-326, 332->340, 336, 340->353, 348-349, 353->360, 357, 360->exit, 364
hippique_orchestrator/scripts/simulate_wrapper.py              469    195    240     52    53%   45-46, 55, 106, 115-116, 118, 127->126, 129, 149-155, 162-171, 184-189, 195-200, 229, 235, 246, 259, 264-266, 269-271, 282, 286-288, 290, 295-296, 311, 313->308, 329-330, 334-337, 339, 349, 352->359, 357->359, 361-362, 367-368, 371->347, 385, 401-435, 454-461, 472->481, 483-502, 505->510, 506->510, 507->506, 511, 519, 527-531, 533, 538-539, 545, 547, 553, 559, 562, 565, 575, 578, 606-611, 626, 638-639, 659-665, 678, 685-699, 735-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424     40    226     46    86%   46, 50, 84, 96->94, 110-111, 122, 125, 130-131, 148-154, 157->159, 166->163, 186, 195, 197, 203, 233->235, 237->239, 253->261, 258-259, 267->269, 271->262, 339, 343, 357, 378, 391, 396->395, 412, 415, 418, 423, 429, 437, 448, 462, 479->481, 481->483, 484->486, 491, 493->446, 551, 555, 558, 581, 610->609, 616, 682
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               204     31     36      3    84%   35-37, 136->139, 220-234, 241-242, 271, 317, 348-349, 357, 381-422
hippique_orchestrator/simulate_ev.py                           221     58     98     19    71%   19-20, 22, 34-35, 37, 41, 64, 76-77, 88-89, 102-103, 112-113, 122-123, 143, 162, 182, 186->188, 190-191, 198, 270, 272, 281, 297-326, 332->340, 336, 340->353, 348-349, 353->360, 357, 360->exit, 364
hippique_orchestrator/simulate_wrapper.py                      475     79    236     47    79%   109, 121, 129->132, 130->129, 154-158, 166, 172, 189, 191, 200, 202, 249, 262, 269, 285, 314, 334-337, 339, 346->374, 349, 352->359, 357->359, 371->347, 385, 389, 403, 405, 409, 427, 447, 460-461, 483-502, 506->510, 507->506, 547, 578, 606-611, 626, 638-639, 659-665, 687, 691, 694, 697-699, 759-763, 788, 806, 809, 815->814, 831-837
hippique_orchestrator/snapshot_manager.py                       28      0      6      0   100%
hippique_orchestrator/stats_fetcher.py                          79      0     20      1    99%   78->90
hippique_orchestrator/stats_provider.py                        299     67    102     23    75%   31, 136, 151-170, 176-192, 200, 214-215, 220, 237-256, 288-289, 295, 312->310, 317->310, 328, 331->324, 333->324, 362, 389->387, 394-395, 401->387, 408-409, 427, 441-444, 448-449, 453->451, 458-459, 465->451, 472-473
hippique_orchestrator/tickets_store.py                          67      0      6      1    99%   137->131
hippique_orchestrator/time_utils.py                             14      4      2      1    69%   15, 22, 35, 44
hippique_orchestrator/validator_ev.py                          319     32    142     13    88%   29, 39-41, 54-55, 384->388, 387, 404-405, 415-421, 430->439, 433, 448, 469, 479, 483, 516, 563-564, 580-587
hippique_orchestrator/zoneturf_client.py                       252     11    116     13    93%   48-49, 59, 111->124, 127->161, 134->157, 148->154, 174, 182-183, 205-207, 246->270, 251->256, 258->263, 265->270, 288, 324
main_debug.py                                                   18     18      0      0     0%   1-28
setup.py                                                         2      2      0      0     0%   1-3
sklearn/__init__.py                                              2      2      0      0     0%   3-5
sklearn/linear_model.py                                          4      4      0      0     0%   3-8
sklearn/metrics.py                                               2      2      0      0     0%   3-5
trigger_schedule.py                                             10     10      2      0     0%   1-15
--------------------------------------------------------------------------------------------------------
TOTAL                                                        13610   7523   4900    466    44%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================= 957 passed in 50.22s =============================
