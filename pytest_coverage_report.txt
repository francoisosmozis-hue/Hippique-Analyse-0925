============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, rerunfailures-16.1, pyfakefs-6.0.0, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 300.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 1112 items

tests/hippique/utils/test_probabilities.py::test_implied_prob_from_odds_valid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_implied_prob_from_odds_invalid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_valid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_empty_list PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_invalid_odds_in_list PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_positive_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_negative_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_zero_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_various_stakes PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_edge_cases PASSED [  0%]
tests/scripts/test_monitor_roi.py::test_load_json_safe_success PASSED    [  0%]
tests/scripts/test_monitor_roi.py::test_load_json_safe_failure PASSED    [  1%]
tests/scripts/test_monitor_roi.py::test_parse_tracking_csv_success PASSED [  1%]
tests/scripts/test_monitor_roi.py::test_collect_analyses_no_date_filter PASSED [  1%]
tests/scripts/test_monitor_roi.py::test_collect_analyses_with_date_filter PASSED [  1%]
tests/scripts/test_monitor_roi.py::test_compute_statistics PASSED        [  1%]
tests/scripts/test_monitor_roi.py::test_compute_statistics_no_races_played PASSED [  1%]
tests/scripts/test_monitor_roi.py::test_print_report PASSED              [  1%]
tests/scripts/test_monitor_roi.py::test_export_json PASSED               [  1%]
tests/scripts/test_monitor_roi.py::test_main_run_once PASSED             [  1%]
tests/scripts/test_online_fetch_zeturf.py::test_fallback_parse_html_extracts_data PASSED [  1%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R1-C1-R1C1] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[1-2-R1C2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R4C5-None-R4C5] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag_raises_error PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_coerce_runner_entry PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_build_snapshot_payload PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_fetch_race_snapshot_cli 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:48 [INFO] [CLI] snapshot chargé depuis snapshot.json
PASSED                                                                   [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[1-2-R1C2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R1-C2-R1C2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R3-10-R3C10] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[4-5-R4C5] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_slugify_hippodrome PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[12,5-12.5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[15.5-15.5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[20-20.0] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[abc-None] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[None-None] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_extracts_data PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_data_odd_attribute PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_cotes_infos_script PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_missing_cheval PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_tbody PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw0-expected0] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw1-expected1] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw2-expected2] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw3-expected3] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw4-expected4] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw5-None] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw6-None] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw7-expected7] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_no_runners_table PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_runner_missing_data PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw0-expected0] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw1-expected1] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw2-expected2] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw3-expected3] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw4-expected4] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw5-expected5] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw6-expected6] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw7-expected7] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw8-None] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw9-expected9] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_invalid_input PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_normalise_snapshot_result_merges_h30_odds PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_normalise_snapshot_result_no_market PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_http_get_raises_on_403 PASSED [  6%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_http_get_raises_on_suspicious_html PASSED [  6%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_double_extract_parses_real_html_fixture 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:49 [WARNING] [ZEturf] Extraction fallback utilisée pour https://www.zeturf.fr/fr/course/2025-11-20/R1C1 (snapshot=H-30)
2026-01-06 09:43:49 [INFO] [ZEturf] phase=H30 url=https://www.zeturf.fr/fr/course/2025-11-20/R1C1-saint-galmier partants=12
PASSED                                                                   [  6%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_runners_table_finds_no_runners PASSED [  6%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_script_finds_no_odds PASSED [  6%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_fallback_parse_no_data_finds_nothing PASSED [  6%]
tests/scripts/test_online_fetch_zeturf_parsing.py::test_double_extract_uses_fallback 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:51 [WARNING] [ZEturf] Champ clé manquant: meeting (url=http://example.com, snapshot=H-30)
2026-01-06 09:43:51 [WARNING] [ZEturf] Champ clé manquant: discipline (url=http://example.com, snapshot=H-30)
2026-01-06 09:43:51 [WARNING] [ZEturf] Champ clé manquant: partants (url=http://example.com, snapshot=H-30)
2026-01-06 09:43:51 [WARNING] [ZEturf] Aucun partant détecté (url=http://example.com, snapshot=H-30) — retournera une liste vide
2026-01-06 09:43:51 [WARNING] [ZEturf] Extraction fallback utilisée pour http://example.com (snapshot=H-30)
PASSED                                                                   [  6%]
tests/scripts/test_simulate_ev_script.py::test_implied_prob_valid PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_implied_prob_invalid PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_basic PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_with_invalids PASSED [  6%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_zero_total PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_normalize_overround_empty PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_implied_probs_list PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_implied_probs_with_invalid_odds PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_ideal PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_fallback_prob PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_stake_capping PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_min_stake_filter PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_allocate_dutching_sp_no_valid_runners PASSED [  7%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_all_pass PASSED   [  7%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_sp_fails PASSED   [  7%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_combo_fails PASSED [  8%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_risk_fails_both PASSED [  8%]
tests/scripts/test_simulate_ev_script.py::test_gate_ev_sharpe_fails_both PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_load_calibration_reloads_on_file_change PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_empty_or_invalid_calibration_file 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:51 [WARNING] Could not load or parse calibration file /etc/config/probabilities.yaml: mapping values are not allowed here
  in "/etc/config/probabilities.yaml", line 1, column 11
PASSED                                                                   [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_simulate_wrapper_fallback_no_correlation PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_correlation_penalty_defaults_gracefully PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_simulate_wrapper_applies_correlation_penalty PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_monte_carlo_is_used_when_numpy_present PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_monte_carlo_is_skipped_when_numpy_missing PASSED [  8%]
tests/scripts/test_simulate_wrapper_script.py::test_evaluate_combo_calls_dependencies_and_returns_results PASSED [  8%]
tests/scripts/test_update_excel_with_results.py::test_as_float PASSED    [  8%]
tests/scripts/test_update_excel_with_results.py::test_normalise_notes PASSED [  9%]
tests/scripts/test_update_excel_with_results.py::test_upsert_row PASSED  [  9%]
tests/scripts/test_update_excel_with_results_script.py::test_update_creates_new_excel_and_sheets PASSED [  9%]
tests/scripts/test_update_excel_with_results_script.py::test_update_upserts_existing_row PASSED [  9%]
tests/test_analysis_drift.py::test_drift_is_detected_and_applied 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:51 [INFO] Starting analysis pipeline for phase.
2026-01-06 09:43:51 [INFO] Fetching race details from data source.
2026-01-06 09:43:51 [INFO] Snapshot fetched successfully.
2026-01-06 09:43:51 [INFO] Snapshot saved to GCS at data/2025-01-01_R1C1/snapshots/20260106_084351_H-5.json
2026-01-06 09:43:51 [INFO] Preparing to run GPI ticket generation.
2026-01-06 09:43:51 [INFO] H-5 phase: attempting to load H-30 snapshot for drift.
2026-01-06 09:43:51 [INFO] Found latest H-30 snapshot: data/R1C1/snapshots/20250101_120000_H-30.json
2026-01-06 09:43:51 [INFO] Calling generate_tickets.
2026-01-06 09:43:51 [INFO] Analysis and ticket generation complete.
PASSED                                                                   [  9%]
tests/test_analysis_drift.py::test_pipeline_raises_if_doc_id_missing PASSED [  9%]
tests/test_analysis_drift.py::test_pipeline_abstains_if_snapshot_is_empty 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:51 [INFO] Starting analysis pipeline for phase.
2026-01-06 09:43:51 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  9%]
tests/test_analysis_drift.py::test_pipeline_handles_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:51 [INFO] Starting analysis pipeline for phase.
2026-01-06 09:43:51 [ERROR] Analysis pipeline failed: Unexpected GCS error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/analysis_pipeline.py", line 156, in run_analysis_for_phase
    snapshot_data, gcs_path = await _fetch_and_save_snapshot(
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Unexpected GCS error

PASSED                                                                   [  9%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [WARNING] No snapshots found in directory.
PASSED                                                                   [  9%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_h30_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [WARNING] No H-30 snapshot found for drift calculation.
PASSED                                                                   [  9%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_list_files_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [ERROR] Failed to find or load H-30 snapshot: GCS List Error
PASSED                                                                   [  9%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_read_file_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [ERROR] Failed to find or load H-30 snapshot: GCS Read Error
PASSED                                                                   [ 10%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_empty_snapshot_from_data_source 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Starting analysis pipeline for phase.
2026-01-06 09:43:52 [INFO] Fetching race details from data source.
2026-01-06 09:43:52 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [ 10%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_snapshot_with_no_runners 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Starting analysis pipeline for phase.
2026-01-06 09:43:52 [INFO] Fetching race details from data source.
2026-01-06 09:43:52 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [ 10%]
tests/test_analysis_utils.py::test_normalise_text[None-] PASSED          [ 10%]
tests/test_analysis_utils.py::test_normalise_text[  \xc9curie Sp\xe9ciale  -ecurie speciale] PASSED [ 10%]
tests/test_analysis_utils.py::test_normalise_text[  -] PASSED            [ 10%]
tests/test_analysis_utils.py::test_normalise_text[TROT-trot] PASSED      [ 10%]
tests/test_analysis_utils.py::test_normalise_text[handicap-handicap] PASSED [ 10%]
tests/test_analysis_utils.py::test_coerce_partants[14-14] PASSED         [ 10%]
tests/test_analysis_utils.py::test_coerce_partants[14.0-14] PASSED       [ 10%]
tests/test_analysis_utils.py::test_coerce_partants[14 partants-14] PASSED [ 10%]
tests/test_analysis_utils.py::test_coerce_partants[environ 14-14] PASSED [ 11%]
tests/test_analysis_utils.py::test_coerce_partants[None-None] PASSED     [ 11%]
tests/test_analysis_utils.py::test_coerce_partants[True-None] PASSED     [ 11%]
tests/test_analysis_utils.py::test_coerce_partants[N/A-None] PASSED      [ 11%]
tests/test_analysis_utils.py::test_coerce_partants[-5-None] PASSED       [ 11%]
tests/test_analysis_utils.py::test_compute_overround_cap_default PASSED  [ 11%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_handicap_large_field PASSED [ 11%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_large_field_from_label PASSED [ 11%]
tests/test_analysis_utils.py::test_compute_overround_cap_small_field_uses_default PASSED [ 11%]
tests/test_analysis_utils.py::test_compute_overround_cap_updates_context PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_parse_musique[1p2p(23)3p4hDAI-expected0] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_parse_musique[0a9a8a-expected1] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_parse_musique[None-expected2] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_parse_musique[   -expected3] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data0-VOLATIL] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data1-VOLATIL] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data2-VOLATIL] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data3-S\xdbR] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data4-VOLATIL] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data5-NEUTRE] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list0-expected_probs0-1.0] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list1-expected_probs1-0.0] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list2-expected_probs2-0.25] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list3-expected_probs3-0.5] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data0-True] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data1-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data2-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data3-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data4-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data0-True] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data1-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data2-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data3-False] PASSED [ 13%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data4-False] PASSED [ 14%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data0-expected_score0] PASSED [ 14%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data1-expected_score1] PASSED [ 14%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data2-0.0] PASSED [ 14%]
tests/test_api_endpoints.py::test_health_check_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Request finished
2026-01-06 09:43:52 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_pronostics_ui_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Request finished
2026-01-06 09:43:52 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_root_redirect 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Request finished
2026-01-06 09:43:52 [INFO] HTTP Request: GET http://testserver/ "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_api_pronostics_date_validation 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Request finished
2026-01-06 09:43:52 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=not-a-real-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_api_pronostics_default_date_is_today 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Building plan for 2025-07-15 using Boturfers as the single source.
2026-01-06 09:43:52 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-07-15
2026-01-06 09:43:52 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:43:52 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-07-15 "HTTP/1.1 404 Not Found"
2026-01-06 09:43:52 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-07-15: 404
2026-01-06 09:43:52 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:43:52 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:43:52 [INFO] Request finished
2026-01-06 09:43:52 [INFO] HTTP Request: GET http://testserver/api/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_api_pronostics_empty_response 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:52 [INFO] Request started
2026-01-06 09:43:52 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-06 09:43:52 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-06 09:43:52 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:43:53 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-06 09:43:53 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-06 09:43:53 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:43:53 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_api_pronostics_etag_304_not_modified 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-06 09:43:53 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-06 09:43:53 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:43:53 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-06 09:43:53 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-06 09:43:53 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:43:53 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-06 09:43:53 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-06 09:43:53 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:43:53 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-06 09:43:53 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-06 09:43:53 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:43:53 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 304 Not Modified"
PASSED                                                                   [ 14%]
tests/test_api_endpoints.py::test_api_pronostics_rich_response_structure 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_integration.py::test_health_check_returns_ok 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_integration.py::test_debug_config_returns_ok_and_has_expected_keys 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/debug/config "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_integration.py::test_get_pronostics_api_with_mocked_data 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2023-01-20 "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_schedule_endpoint_is_protected_by_api_key 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_api_key_authentication 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received request to schedule day races. Force: False, Dry Run: True
2026-01-06 09:43:53 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_ops_run_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_ops_status_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_api_key_not_required 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received request to schedule day races. Force: False, Dry Run: True
2026-01-06 09:43:53 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_task_worker_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_task_worker_valid_token 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received run-phase request for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-06 09:43:53 [INFO] Updating Firestore document
2026-01-06 09:43:53 [INFO] Run phase completed successfully for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_task_worker_google_auth_fails 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 16%]
tests/test_api_security.py::test_task_worker_invalid_token_scheme 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 16%]
tests/test_api_security.py::test_snapshot_9h_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 16%]
tests/test_api_security.py::test_bootstrap_day_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 16%]
tests/test_api_security.py::test_ops_run_endpoint_accessible_when_auth_not_required 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Manual run triggered for race R1C1 on 2026-01-06
2026-01-06 09:43:53 [INFO] Successfully processed and saved manual run for 2026-01-06_R1C1
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_security.py::test_ops_status_endpoint_accessible_when_auth_not_required 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_snapshot_9h_task_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received snapshot-9h request for 2026-01-06 with URLs: [], RC Labels: []
2026-01-06 09:43:53 [INFO] Snapshot-9h completed successfully for 2026-01-06.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_snapshot_9h_task_with_specific_date_and_urls 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received snapshot-9h request for 2025-10-26 with URLs: ['http://example.com/r1c1', 'http://example.com/r1c2'], RC Labels: []
2026-01-06 09:43:53 [INFO] Snapshot-9h completed successfully for 2025-10-26.
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_run_phase_task_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received run-phase request for http://example.com/race/2025-12-29/R1C1-prix-de-la-course (phase: H30)
2026-01-06 09:43:53 [INFO] Run phase completed successfully for http://example.com/race/2025-12-29/R1C1-prix-de-la-course (phase: H30)
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_run_phase_task_runner_returns_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received run-phase request for http://example.com/R1C1 (phase: H5)
2026-01-06 09:43:53 [ERROR] Run phase failed for http://example.com/R1C1 (phase: H5)
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_run_phase_task_exception_handling 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received run-phase request for http://example.com/R1C1 (phase: H5)
2026-01-06 09:43:53 [ERROR] Exception during run-phase for http://example.com/R1C1 (phase: H5): unexpected_error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/api/tasks.py", line 54, in run_phase_task
    analysis_result = await run_course( # Renamed result to analysis_result for clarity
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: unexpected_error
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_snapshot_9h_task_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received snapshot-9h request for 2025-10-26 with URLs: [], RC Labels: []
2026-01-06 09:43:53 [ERROR] Exception during snapshot-9h for 2025-10-26: Storage error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/api/tasks.py", line 116, in snapshot_9h_task
    await write_snapshot_for_day_async(
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Storage error
2026-01-06 09:43:53 [INFO] Request finished
2026-01-06 09:43:53 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_bootstrap_day_task_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:53 [INFO] Request started
2026-01-06 09:43:53 [INFO] Received request to bootstrap day 2025-10-26
2026-01-06 09:43:53 [INFO] Building daily plan for 2025-10-26...
2026-01-06 09:43:54 [ERROR] Exception during bootstrap-day for 2025-10-26: Plan build failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/api/tasks.py", line 169, in bootstrap_day_task
    plan = await build_plan_async(target_date_str)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Plan build failed
2026-01-06 09:43:54 [INFO] Request finished
2026-01-06 09:43:54 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 17%]
tests/test_api_tasks.py::test_run_phase_task_infers_doc_id 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Request started
2026-01-06 09:43:54 [INFO] Received run-phase request for http://example.com/2025-01-01/R1C1-race (phase: H5)
2026-01-06 09:43:54 [INFO] Run phase completed successfully for http://example.com/2025-01-01/R1C1-race (phase: H5)
2026-01-06 09:43:54 [INFO] Request finished
2026-01-06 09:43:54 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 17%]
tests/test_api_tasks.py::test_bootstrap_day_task_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Request started
2026-01-06 09:43:54 [INFO] Received request to bootstrap day 2026-01-06
2026-01-06 09:43:54 [INFO] Building daily plan for 2026-01-06...
2026-01-06 09:43:54 [INFO] Plan built: 2 races for 2026-01-06.
2026-01-06 09:43:54 [INFO] Bootstrap day completed. Scheduled 3 tasks.
2026-01-06 09:43:54 [INFO] Request finished
2026-01-06 09:43:54 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 200 OK"
PASSED                                                                   [ 17%]
tests/test_api_tasks.py::test_bootstrap_day_task_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Request started
2026-01-06 09:43:54 [INFO] Received request to bootstrap day 2026-01-06
2026-01-06 09:43:54 [INFO] Building daily plan for 2026-01-06...
2026-01-06 09:43:54 [WARNING] Empty plan for 2026-01-06. No tasks to schedule.
2026-01-06 09:43:54 [INFO] Request finished
2026-01-06 09:43:54 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 404 Not Found"
PASSED                                                                   [ 17%]
tests/test_concat_je_month.py::test_normalize_columns PASSED             [ 17%]
tests/test_concat_je_month.py::test_normalize_columns_missing_cols PASSED [ 17%]
tests/test_concat_je_month.py::test_infer_date_from_path[data/2026-01-01/some_file.csv-expected_date0] PASSED [ 17%]
tests/test_concat_je_month.py::test_infer_date_from_path[data/2025_12_31/other_file.csv-expected_date1] PASSED [ 17%]
tests/test_concat_je_month.py::test_infer_date_from_path[data/no_date_here.csv-None] PASSED [ 17%]
tests/test_concat_je_month.py::test_infer_date_from_path[data/20240229_special.csv-expected_date3] PASSED [ 17%]
tests/test_concat_je_month.py::test_load_and_filter PASSED               [ 17%]
tests/test_concat_je_month.py::test_summarize_month PASSED               [ 18%]
tests/test_concat_je_month.py::test_summarize_month_no_jockey_trainer_data PASSED [ 18%]
tests/test_concat_je_month.py::test_main_success PASSED                  [ 18%]
tests/test_concat_je_month.py::test_main_data_dir_not_found PASSED       [ 18%]
tests/test_concat_je_month.py::test_main_no_csv_files_found PASSED       [ 18%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_meetings PASSED [ 18%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_reunions PASSED [ 18%]
tests/test_cron_decider.py::test_load_meetings_from_dict_key_data PASSED [ 18%]
tests/test_cron_decider.py::test_load_meetings_from_list PASSED          [ 18%]
tests/test_cron_decider.py::test_load_meetings_invalid_json_raises_error PASSED [ 18%]
tests/test_cron_decider.py::test_parse_start_iso_timestamp PASSED        [ 18%]
tests/test_cron_decider.py::test_parse_start_hh_mm_with_date_hint PASSED [ 19%]
tests/test_cron_decider.py::test_parse_start_invalid_format PASSED       [ 19%]
tests/test_cron_decider.py::test_parse_start_hh_mm_no_date_hint PASSED   [ 19%]
tests/test_cron_decider.py::test_invoke_runner 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [WARNING] Environment variable ALLOW_HEURISTIC not set; using default '0'
PASSED                                                                   [ 19%]
tests/test_cron_decider.py::test_main_meetings_file_not_found PASSED     [ 19%]
tests/test_cron_decider.py::test_main_happy_path_h5 PASSED               [ 19%]
tests/test_cron_decider.py::test_main_happy_path_h30 PASSED              [ 19%]
tests/test_cron_decider.py::test_main_no_trigger_outside_window PASSED   [ 19%]
tests/test_cron_decider.py::test_main_no_trigger_if_missing_info PASSED  [ 19%]
tests/test_cron_decider.py::test_main_empty_meetings_file PASSED         [ 19%]
tests/test_cron_decider.py::test_main_trigger_at_window_edge PASSED      [ 19%]
tests/test_data_source.py::test_fetch_programme_routes_to_boturfers 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Fetching programme from data source via URL: http://example.com
PASSED                                                                   [ 20%]
tests/test_data_source.py::test_fetch_race_details_routes_to_boturfers[https://www.boturfers.fr/c/2025-01-01/r1c1-hippique_orchestrator.data_source.boturfers.fetch_boturfers_race_details] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Fetching race details from data source via URL: https://www.boturfers.fr/c/2025-01-01/r1c1
PASSED                                                                   [ 20%]
tests/test_data_source.py::test_fetch_race_details_routes_to_boturfers[http://some-other-site.com/race-hippique_orchestrator.data_source.boturfers.fetch_boturfers_race_details] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Fetching race details from data source via URL: http://some-other-site.com/race
PASSED                                                                   [ 20%]
tests/test_data_source.py::test_fetch_race_details_routes_to_zeturf[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-hippique_orchestrator.data_source.fetch_zeturf_race_details] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Fetching race details from data source via URL: https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test
PASSED                                                                   [ 20%]
tests/test_data_source.py::test_fetch_race_details_routes_to_zeturf[http://zeturf.com/R1C1-hippique_orchestrator.data_source.fetch_zeturf_race_details] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:54 [INFO] Fetching race details from data source via URL: http://zeturf.com/R1C1
PASSED                                                                   [ 20%]
tests/test_dutching_allocation.py::test_equal_profit_stakes_sum PASSED   [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_valid_input PASSED [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_empty_odds_list PASSED [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list0] PASSED [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list1] PASSED [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list2] PASSED [ 20%]
tests/test_dutching_utils.py::test_equal_profit_stakes_invalid_odds_list[odds_list3] PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_no_correlation PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_correlated_same_stable_driver_within_threshold PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_correlated_same_stable_driver_outside_threshold PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_different_stable_same_driver PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_same_stable_different_driver PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_missing_ecurie_or_driver_lenient PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_missing_chrono_lenient PASSED [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_empty_list PASSED     [ 21%]
tests/test_dutching_utils.py::test_diversify_guard_single_horse PASSED   [ 21%]
tests/test_dutching_utils.py::test_require_mid_odds_found PASSED         [ 21%]
tests/test_dutching_utils.py::test_require_mid_odds_not_found_all_low PASSED [ 22%]
tests/test_dutching_utils.py::test_require_mid_odds_not_found_all_high PASSED [ 22%]
tests/test_dutching_utils.py::test_require_mid_odds_empty_list PASSED    [ 22%]
tests/test_dutching_utils.py::test_require_mid_odds_missing_odds PASSED  [ 22%]
tests/test_dutching_utils.py::test_require_mid_odds_non_numeric_odds_ignored PASSED [ 22%]
tests/test_env_utils.py::test_get_env_missing_warns 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [WARNING] Environment variable MISSING_VAR not set; using default 'fallback'
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_logs_critical 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'REQUIRED_MISSING'. App may not function correctly.
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[true] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[True] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[1] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 22%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[t] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[yes] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits_variations[y] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_alias_support 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [INFO] Environment variable ALIAS_VAR='alias_value' used as alias for PRIMARY_VAR
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_casting_error_returns_default 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [ERROR] Invalid value for environment variable 'INT_VAR': 'not-an-int'. Returning default.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/config/env_utils.py", line 81, in get_env
    value = cast(raw_value)
            ^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'not-an-int'
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_value_equals_default_no_override_log PASSED [ 23%]
tests/test_env_utils.py::test_get_env_required_missing_non_prod_logs_critical_no_exit 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'NON_PROD_REQUIRED'. App may not function correctly.
PASSED                                                                   [ 23%]
tests/test_env_utils.py::test_get_env_fail_fast_on_config_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [CRITICAL] Missing required environment variable 'MY_VAR'. App may not function correctly.
2026-01-06 09:43:55 [CRITICAL] FAIL_FAST_ON_CONFIG_ERROR is true. Exiting.
PASSED                                                                   [ 23%]
tests/test_ev_calculator.py::test_make_hashable_hashable_types PASSED    [ 23%]
tests/test_ev_calculator.py::test_make_hashable_list PASSED              [ 23%]
tests/test_ev_calculator.py::test_make_hashable_dict PASSED              [ 23%]
tests/test_ev_calculator.py::test_make_hashable_nested_structures PASSED [ 24%]
tests/test_ev_calculator.py::test_make_hashable_unhashable_fallback PASSED [ 24%]
tests/test_ev_calculator.py::test_kelly_fraction_valid_inputs PASSED     [ 24%]
tests/test_ev_calculator.py::test_kelly_fraction_probability_out_of_range PASSED [ 24%]
tests/test_ev_calculator.py::test_kelly_fraction_odds_out_of_range PASSED [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_single_group PASSED     [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_multiple_groups PASSED  [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_no_dutching_groups PASSED [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_mixed_groups PASSED     [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_invalid_odds_in_group PASSED [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_single_valid_ticket_in_group PASSED [ 24%]
tests/test_ev_calculator.py::test_apply_dutching_group_too_small PASSED  [ 25%]
tests/test_ev_calculator.py::test_ticket_label_with_id PASSED            [ 25%]
tests/test_ev_calculator.py::test_ticket_label_with_name PASSED          [ 25%]
tests/test_ev_calculator.py::test_ticket_label_with_label PASSED         [ 25%]
tests/test_ev_calculator.py::test_ticket_label_with_selection PASSED     [ 25%]
tests/test_ev_calculator.py::test_ticket_label_with_runner PASSED        [ 25%]
tests/test_ev_calculator.py::test_ticket_label_no_label_keys_falls_back_to_index PASSED [ 25%]
tests/test_ev_calculator.py::test_ticket_label_empty_string_values_falls_back_to_index PASSED [ 25%]
tests/test_ev_calculator.py::test_clone_leg_dict PASSED                  [ 25%]
tests/test_ev_calculator.py::test_clone_leg_list_of_dicts PASSED         [ 25%]
tests/test_ev_calculator.py::test_clone_leg_primitive_type PASSED        [ 25%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_for_probability PASSED [ 25%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_details PASSED [ 26%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs PASSED [ 26%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_id_only PASSED [ 26%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_no_identifiable_legs PASSED [ 26%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_ticket_id PASSED [ 26%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_selection_id PASSED [ 26%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_leg_id_in_legs PASSED [ 26%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_mixed_dependencies PASSED [ 26%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_empty PASSED    [ 26%]
tests/test_ev_calculator.py::test_prepare_ticket_dependencies PASSED     [ 26%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_id_dependency PASSED [ 26%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_leg_dependency PASSED [ 27%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_no_specific_dependency PASSED [ 27%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_empty PASSED  [ 27%]
tests/test_ev_calculator.py::test_approx_joint_probability_independent PASSED [ 27%]
tests/test_ev_calculator.py::test_approx_joint_probability_positive_correlation PASSED [ 27%]
tests/test_ev_calculator.py::test_approx_joint_probability_negative_correlation PASSED [ 27%]
tests/test_ev_calculator.py::test_approx_joint_probability_rho_clipping PASSED [ 27%]
tests/test_ev_calculator.py::test_approx_joint_probability_lower_bound PASSED [ 27%]
tests/test_ev_calculator.py::test_merge_legs_no_duplicates PASSED        [ 27%]
tests/test_ev_calculator.py::test_merge_legs_with_duplicates PASSED      [ 27%]
tests/test_ev_calculator.py::test_merge_legs_with_dict_duplicates PASSED [ 27%]
tests/test_ev_calculator.py::test_merge_legs_empty_inputs PASSED         [ 28%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_simulate_fn PASSED [ 28%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_legs PASSED [ 28%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_no_cache PASSED [ 28%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_miss PASSED [ 28%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_hit PASSED [ 28%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_and_cache PASSED [ 28%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_no_cache PASSED [ 28%]
tests/test_ev_calculator.py::test_estimate_joint_probability_no_simulate_fn_uses_approx PASSED [ 28%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_copula_monte_carlo PASSED [ 28%]
tests/test_ev_calculator.py::test_covariance_from_joint_positive PASSED  [ 28%]
tests/test_ev_calculator.py::test_covariance_from_joint_negative PASSED  [ 29%]
tests/test_ev_calculator.py::test_covariance_from_joint_zero_probability PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_tickets PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_fewer_than_min_tickets PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_shared_exposures PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_positive_covariance PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_negative_covariance PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_covariance_below_threshold PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-None-0.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.0-0.01-100-None-1.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.0-100-None-0.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.02-0.0] PASSED [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.005-0.0] PASSED [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.01-0.01-1-None-0.1353352832366127] PASSED [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin_invalid_bankroll PASSED   [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin_respects_baseline_variance PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_with_scipy PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_without_scipy_fallback_to_grid_search PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_empty_tickets PASSED [ 30%]
tests/test_ev_calculator.py::test_process_single_ticket_p_provided PASSED [ 30%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p PASSED [ 30%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p_cached PASSED [ 30%]
tests/test_ev_calculator.py::test_process_single_ticket_no_p_or_legs_raises_value_error PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_p_raises_value_error PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_odds_raises_value_error PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_stake_capping_and_rounding PASSED [ 31%]
tests/test_ev_calculator.py::test_process_tickets_basic_functionality PASSED [ 31%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_single_ticket PASSED [ 31%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_with_combined_ticket PASSED [ 31%]
tests/test_ev_calculator.py::test_calculate_final_metrics_green_flag PASSED [ 31%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ev_ratio PASSED [ 31%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ror PASSED [ 31%]
tests/test_ev_calculator.py::test_compute_ev_roi_basic_functionality PASSED [ 31%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_budget PASSED   [ 32%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_variance_cap_config PASSED [ 32%]
tests/test_ev_calculator.py::test_compute_ev_roi_with_optimize_true PASSED [ 32%]
tests/test_ev_calculator.py::test_compute_ev_roi_variance_capping PASSED [ 32%]
tests/test_ev_thresholds.py::test_ev_sp_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 32%]
tests/test_ev_thresholds.py::test_ev_global_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 32%]
tests/test_ev_thresholds.py::test_validate_policy_roi_below_threshold PASSED [ 32%]
tests/test_ev_thresholds.py::test_validate_policy_raises_on_low_roi_message PASSED [ 32%]
tests/test_evaluate_combo.py::test_default_config_path_missing PASSED    [ 32%]
tests/test_evaluate_combo.py::test_env_path_missing PASSED               [ 32%]
tests/test_evaluate_combo.py::test_env_path_present PASSED               [ 32%]
tests/test_evaluate_combo.py::test_gates_when_calibration_missing PASSED [ 33%]
tests/test_evaluate_combo.py::test_override_missing_calibration 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 33%]
tests/test_evaluate_combo.py::test_with_calibration PASSED               [ 33%]
tests/test_evaluate_combo.py::test_marks_unreliable_probabilities 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 33%]
tests/test_fetch_je_stats.py::test_normalise_text[  Test String  -teststring] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_normalise_text[\xc9curie Sp\xe9ciale-ecuriespeciale] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_normalise_text[J. VANMEERBECK-jvanmeerbeck] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[R\xe9ussite jockey/cheval : 15%-15.0] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[Ratio: 3 / 10-30.0] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires : 5-5.0] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[Taux de r\xe9ussite : 0.25-25.0] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[Just a number 42.5 here-42.5] PASSED [ 33%]
tests/test_fetch_je_stats.py::test_parse_percentage[No number here-None] PASSED [ 34%]
tests/test_fetch_je_stats.py::test_parse_percentage[-None] PASSED        [ 34%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires=10-10.0] PASSED [ 34%]
tests/test_fetch_je_stats.py::test_parse_percentage[12,5%-12.5] PASSED   [ 34%]
tests/test_fetch_je_stats.py::test_extract_links_from_horse_page PASSED  [ 34%]
tests/test_fetch_je_stats.py::test_extract_rate_from_profile PASSED      [ 34%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name PASSED     [ 34%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name_http_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [WARNING] Failed to fetch Geny search results for Bold Eagle
PASSED                                                                   [ 34%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_success PASSED [ 34%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_handles_failures 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:55 [WARNING] Failed to fetch horse page http://horse.url
PASSED                                                                   [ 34%]
tests/test_fetch_je_stats.py::test_collect_stats_edge_cases[h5_data0-0-0-None] PASSED [ 34%]
tests/test_fetch_je_stats.py::test_collect_stats_edge_cases[h5_data1-0-1-] PASSED [ 35%]
tests/test_fetch_je_stats.py::test_collect_stats_edge_cases[h5_data2-0-1-] PASSED [ 35%]
tests/test_fetch_je_stats.py::test_collect_stats_edge_cases[h5_data3-100-1-] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Failed to fetch jockey stats for 'Partially Failing Horse' from https://www.geny.com/jockeys/1234-j-doe.html: Jockey fetch failed
PASSED                                                                   [ 35%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name_empty_name PASSED [ 35%]
tests/test_fetch_je_stats.py::test_extract_rate_from_profile_not_found PASSED [ 35%]
tests/test_fetch_je_stats.py::test_main_function_calls_collect_stats PASSED [ 35%]
tests/test_fetch_je_stats.py::test_collect_stats_local_filesystem PASSED [ 35%]
tests/test_fetch_je_stats.py::test_enrich_from_snapshot_calls_subprocess PASSED [ 35%]
tests/test_fetch_je_stats.py::test_collect_stats_integration PASSED      [ 35%]
tests/test_firestore_client.py::test_update_race_document_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Updating Firestore document
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_update_race_document_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to update document some_id: Firestore unavailable
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 60, in update_race_document
    doc_ref = db.collection(config.FIRESTORE_COLLECTION).document(document_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Firestore unavailable
PASSED                                                                   [ 35%]
tests/test_firestore_client.py::test_update_race_document_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Firestore is not available, skipping update.
PASSED                                                                   [ 36%]
tests/test_firestore_client.py::test_get_races_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 36%]
tests/test_firestore_client.py::test_get_races_for_date_empty 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 36%]
tests/test_firestore_client.py::test_get_races_for_date_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to query races by date 2025-12-30: Query failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 82, in get_races_for_date
    races_ref = db.collection(config.FIRESTORE_COLLECTION)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Query failed
PASSED                                                                   [ 36%]
tests/test_firestore_client.py::test_get_races_for_date_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Firestore is not available, cannot query races.
PASSED                                                                   [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-pmu-2025-12-25-2025-12-25_R1C2] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://turf.fr/R5C3/details-2025-12-25-2025-12-25_R5C3] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[R3C8-2025-12-25-2025-12-25_R3C8] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[R1C1-2025-12-25-2025-12-25_R1C1] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[some-string-r4c1-other-2025-12-25-2025-12-25_R4C1] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[invalid-url-2025-12-25-None] PASSED [ 36%]
tests/test_firestore_client.py::test_get_doc_id_from_url[-2025-12-25-None] PASSED [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_db_not_available PASSED [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_empty_daily_plan 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_explicit_empty_plan_reason 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unprocessed_races 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_error_decision 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unknown_decision 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Queried races from Firestore
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_get_document_success PASSED         [ 37%]
tests/test_firestore_client.py::test_get_document_not_found PASSED       [ 37%]
tests/test_firestore_client.py::test_get_document_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to get document 'test_doc' from 'test_collection': Connection failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 31, in get_document
    doc = doc_ref.get()
          ^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Connection failed
PASSED                                                                   [ 37%]
tests/test_firestore_client.py::test_set_document_success PASSED         [ 38%]
tests/test_firestore_client.py::test_set_document_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to set document 'test_doc' in 'test_collection': Permission denied
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 47, in set_document
    db.collection(collection).document(document_id).set(data)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Permission denied
PASSED                                                                   [ 38%]
tests/test_firestore_client.py::test_get_races_for_date_db_unavailable 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Firestore is not available, cannot query races.
PASSED                                                                   [ 38%]
tests/test_firestore_client.py::test_get_document_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Firestore is not available, cannot get document.
PASSED                                                                   [ 38%]
tests/test_firestore_client.py::test_set_document_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Firestore is not available, cannot set document.
PASSED                                                                   [ 38%]
tests/test_firestore_client_extended.py::test_get_processing_status_for_date_processing_stalled PASSED [ 38%]
tests/test_firestore_client_extended.py::test_get_processing_status_for_date_db_empty PASSED [ 38%]
tests/test_gcs_client_extended.py::test_gcs_manager_init PASSED          [ 38%]
tests/test_gcs_client_extended.py::test_gcs_manager_init_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] GCS_BUCKET is not set in the configuration. GCS operations will fail.
PASSED                                                                   [ 38%]
tests/test_gcs_client_extended.py::test_gcs_manager_lazy_init PASSED     [ 38%]
tests/test_gcs_client_extended.py::test_get_gcs_path PASSED              [ 38%]
tests/test_gcs_client_extended.py::test_file_exists PASSED               [ 39%]
tests/test_gcs_client_extended.py::test_get_gcs_fs PASSED                [ 39%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
PASSED                                                                   [ 39%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_singleton PASSED [ 39%]
tests/test_gcs_client_extended.py::test_get_gcs_fs_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-06 09:43:56 [ERROR] GCSManager is not initialized. Cannot get filesystem.
PASSED                                                                   [ 39%]
tests/test_gcs_client_extended.py::test_build_gcs_path PASSED            [ 39%]
tests/test_gcs_client_extended.py::test_build_gcs_path_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-06 09:43:56 [ERROR] GCSManager is not initialized. Cannot build GCS path.
PASSED                                                                   [ 39%]
tests/test_gcs_client_extended.py::test_gcs_manager_save_json_to_gcs_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Saving JSON to GCS: gs://test-bucket/error.json
2026-01-06 09:43:56 [ERROR] Failed to save JSON to GCS at gs://test-bucket/error.json: Mock GCS write error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/gcs_client.py", line 95, in save_json_to_gcs
    json.dump(data, f)
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Mock GCS write error
PASSED                                                                   [ 39%]
tests/test_gcs_client_extended.py::test_gcs_manager_save_json_to_gcs_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Saving JSON to GCS: gs://test-bucket/test.json
2026-01-06 09:43:56 [INFO] Successfully saved JSON to gs://test-bucket/test.json
PASSED                                                                   [ 39%]
tests/test_gcs_client_extended.py::test_global_save_json_to_gcs_success PASSED [ 39%]
tests/test_gcs_client_extended.py::test_global_save_json_to_gcs_no_manager_raises_runtime_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] GCSManager not initialized. Cannot save JSON to gs://test-bucket/error.json.
PASSED                                                                   [ 39%]
tests/test_gcs_utils.py::test_is_gcs_enabled PASSED                      [ 40%]
tests/test_gcs_utils.py::test_is_gcs_disabled PASSED                     [ 40%]
tests/test_gcs_utils.py::test_disabled_reason_when_disabled PASSED       [ 40%]
tests/test_gcs_utils.py::test_disabled_reason_when_enabled PASSED        [ 40%]
tests/test_gcs_utils.py::test_get_gcs_client_initialization_success PASSED [ 40%]
tests/test_gcs_utils.py::test_get_gcs_client_initialization_failure 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to initialize GCS client: Auth failure
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/gcs_utils.py", line 23, in _get_gcs_client
    _gcs_client = storage.Client()
                  ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Auth failure
PASSED                                                                   [ 40%]
tests/test_gcs_utils.py::test_upload_file_gcs_disabled PASSED            [ 40%]
tests/test_gcs_utils.py::test_upload_file_client_is_none PASSED          [ 40%]
tests/test_gcs_utils.py::test_upload_file_local_file_not_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [WARNING] Local file not found, cannot upload to GCS: nonexistent/file.json
PASSED                                                                   [ 40%]
tests/test_gcs_utils.py::test_upload_file_path_construction[data/snapshots/R1C1/file.json-prod/snapshots/R1C1/file.json] PASSED [ 40%]
tests/test_gcs_utils.py::test_upload_file_path_construction[snapshots/R1C2/file.json-prod/snapshots/R1C2/file.json] PASSED [ 40%]
tests/test_gcs_utils.py::test_upload_file_path_construction[analyses/R1C3/file.json-prod/analyses/R1C3/file.json] PASSED [ 41%]
tests/test_gcs_utils.py::test_upload_file_path_construction[some/other/path/data/analyses/R1/file.json-prod/analyses/R1/file.json] PASSED [ 41%]
tests/test_gcs_utils.py::test_upload_file_path_construction[unknown/path/file.json-prod/unknown/path/file.json] PASSED [ 41%]
tests/test_gcs_utils.py::test_upload_file_gcs_api_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Failed to upload data/snapshots/R1C1/file.json to GCS: 403 Permission denied
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/gcs_utils.py", line 85, in upload_file
    blob.upload_from_filename(str(local_file))
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
google.api_core.exceptions.Forbidden: 403 Permission denied
PASSED                                                                   [ 41%]
tests/test_guardrails.py::test_evaluate_guardrail_uses_multiple_paths PASSED [ 41%]
tests/test_guardrails.py::test_evaluate_guardrail_detects_low_values PASSED [ 41%]
tests/test_guardrails.py::test_load_json_raises_on_non_object PASSED     [ 41%]
tests/test_guardrails.py::test_extract_metric_returns_zero_when_missing PASSED [ 41%]
tests/test_guardrails.py::test_append_env_writes_to_file PASSED          [ 41%]
tests/test_guardrails.py::test_main_success_path PASSED                  [ 41%]
tests/test_guardrails.py::test_main_abstention_path_creates_report PASSED [ 41%]
tests/test_guardrails.py::test_main_file_not_found PASSED                [ 41%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-1.0-1.0-0.25] PASSED    [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.2-3.0-1.0-1.0-0.0] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.3333333333333333-3.0-1.0-1.0-0.0] PASSED [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-0.5-1.0-0.125] PASSED   [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-0.2-0.2] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-0.5-0.3-0.3] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[1.5-3.0-1.0-1.0-0.0] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.0-3.0-1.0-1.0-0.0] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[-0.5-3.0-1.0-1.0-0.0] PASSED    [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.5-1.0-1.0-1.0-0.0] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.5-0.5-1.0-1.0-0.0] PASSED     [ 42%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0--0.5-1.0-0.25] PASSED   [ 43%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-1.5-0.7] PASSED     [ 43%]
tests/test_kelly.py::test_kelly_stake PASSED                             [ 43%]
tests/test_kelly_cap.py::test_kelly_cap_limits_stakes PASSED             [ 43%]
tests/test_kelly_cap.py::test_validate_budget_ok PASSED                  [ 43%]
tests/test_kelly_cap.py::test_validate_budget_total_exceeded PASSED      [ 43%]
tests/test_kelly_cap.py::test_validate_budget_horse_cap_exceeded PASSED  [ 43%]
tests/test_logging_io.py::test_csv_header_and_columns PASSED             [ 43%]
tests/test_logging_io.py::test_append_csv_line_local_filesystem PASSED   [ 43%]
tests/test_logging_io.py::test_append_csv_line_appends_locally PASSED    [ 43%]
tests/test_logging_io.py::test_append_json_local_filesystem PASSED       [ 43%]
tests/test_logging_io.py::test_append_json_gcs PASSED                    [ 44%]
tests/test_no_vig_ev.py::test_no_vig_sum_to_one PASSED                   [ 44%]
tests/test_no_vig_ev.py::test_ev_drops_when_margin_higher PASSED         [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>14h05</td>-14:05] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'> 9h30 </td>-09:30] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>21:45</td>-21:45] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>08:15</td>-08:15] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>12h00</td>-12:00] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>No time here</td>-None] PASSED [ 44%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td></td>-None] PASSED [ 44%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.boturfers.fr/courses/2025-01-01/r2c3-race-name-R2-C3] PASSED [ 44%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.boturfers.fr/courses/2025-01-01/R2C3-race-name-R2-C3] PASSED [ 45%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-R1-C2] PASSED [ 45%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_success[https://zeturf.com/R12C5/details-R12-C5] PASSED [ 45%]
tests/test_orchestrator_runner.py::test_extract_rc_from_url_no_match_raises_value_error PASSED [ 45%]
tests/test_orchestrator_runner.py::test_run_course_extract_rc_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [ERROR] Invalid URL format
PASSED                                                                   [ 45%]
tests/test_orchestrator_runner.py::test_run_course_analysis_pipeline_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:56 [INFO] Starting Firestore-native course analysis
2026-01-06 09:43:56 [INFO] Course analysis completed successfully.
PASSED                                                                   [ 45%]
tests/test_orchestrator_runner.py::test_run_course_analysis_pipeline_failure 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [ERROR] Course analysis failed.
PASSED                                                                   [ 45%]
tests/test_orchestrator_runner.py::test_run_course_unexpected_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Unexpected error
PASSED                                                                   [ 45%]
tests/test_overround.py::test_compute_overround_place_nominal PASSED     [ 45%]
tests/test_overround.py::test_compute_overround_place_with_odds_place_fallback PASSED [ 45%]
tests/test_overround.py::test_compute_overround_place_with_cote_fallback PASSED [ 45%]
tests/test_overround.py::test_compute_overround_place_mixed_sources PASSED [ 46%]
tests/test_overround.py::test_compute_overround_place_handles_invalid_data PASSED [ 46%]
tests/test_overround.py::test_compute_overround_place_empty_list 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] Could not calculate place overround: no valid place odds found.
PASSED                                                                   [ 46%]
tests/test_overround.py::test_compute_overround_place_no_valid_odds 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] Could not calculate place overround: no valid place odds found.
PASSED                                                                   [ 46%]
tests/test_overround.py::test_adaptive_cap_returns_base_cap PASSED       [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_no_pval PASSED            [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_no_maps PASSED            [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_invalid_map_data PASSED   [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_applies_steam_bonus PASSED [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_applies_drift_penalty_to_fav PASSED [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_no_penalty_for_drifting_non_favorite PASSED [ 46%]
tests/test_p_finale.py::test_apply_drift_steam_no_change_if_delta_not_met PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[runners] PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[horses] PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_finds_runners_in_different_keys[partants] PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_empty_if_no_runners PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_extracts_all_fields_with_fallbacks PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_handles_non_dict_runners PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_calls_apply_drift_steam PASSED [ 47%]
tests/test_p_finale.py::test_generate_p_finale_data_no_drift_call_if_maps_missing PASSED [ 47%]
tests/test_p_finale_export.py::test_export_creates_csv_and_excel PASSED  [ 47%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map0-p30_map0-2-0.515] PASSED [ 47%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map1-p30_map1-1-0.485] PASSED [ 48%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map2-p30_map2-2-0.5] PASSED [ 48%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map3-p30_map3-1-0.5] PASSED [ 48%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-None-p30_map4-1-0.5] PASSED [ 48%]
tests/test_p_finale_extended.py::test_apply_drift_steam[0.5-1-p5_map5-None-1-0.5] PASSED [ 48%]
tests/test_p_finale_extended.py::test_apply_drift_steam[None-1-p5_map6-p30_map6-1-0.0] PASSED [ 48%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_basic PASSED [ 48%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_empty_runners PASSED [ 48%]
tests/test_p_finale_extended.py::test_generate_p_finale_data_no_drift_config PASSED [ 48%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_roi_is_low PASSED [ 48%]
tests/test_pipeline_run.py::test_generate_tickets_creates_sp_dutching_ticket_when_roi_is_high PASSED [ 48%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_global_roi_is_low PASSED [ 49%]
tests/test_pipeline_run.py::test_generate_tickets_creates_trio_ticket_with_best_roi PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_normalize_probs_empty_list PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_normalize_probs_zero_sum PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_success PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_missing_budget_raises_error PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_empty_runners_raises_error PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_initialize_and_validate_missing_critical_key_raises_error PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_missing_base_probabilities_raises_error PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_p_base_fallback_from_win_odds PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_real_favorites_detection PASSED [ 49%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_overround_calculation PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_bonus PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_malus PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_volatility_bonus PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_musique_score PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_no_je_or_volatility_data PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_neutral PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_base_stat_adjustment_je_invalid_rate_type PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_success PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_no_best_chronos PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_chrono_adjustment_malformed_chrono_data PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_no_h30_odds PASSED [ 50%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_stable_odds PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_drift_detected PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_steam_detected PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_favorite_drift_factor PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_outsider_steam_factor PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_apply_drift_adjustment_medium_drift_no_special_factors PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_min_candidates PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_mid_range_priority PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_select_sp_dutching_candidates_max_candidates_limit PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_generate_sp_dutching_tickets_no_profitable_candidates PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_generate_sp_dutching_tickets_profitable_candidates_creates_ticket PASSED [ 51%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[COUPLE-2] PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[COUPLE_PLACE-2] PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[ZE234-2] PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[TRIO-3] PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[ZE4-4] PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_get_legs_for_exotic_type[UNKNOWN-3] 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] Unknown exotic type 'UNKNOWN', assuming 3 legs.
PASSED                                                                   [ 52%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_no_profitable_combos PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_overround_too_high PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_no_allowed_types PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_not_enough_sp_candidates PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_generate_exotic_tickets_multiple_profitable_combos_updates_best PASSED [ 52%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_no_tickets PASSED [ 53%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_low_global_roi PASSED [ 53%]
tests/test_pipeline_run_extended.py::test_finalize_and_decide_play PASSED [ 53%]
tests/test_pipeline_run_extended.py::test_generate_tickets_populates_top5_pronostic PASSED [ 53%]
tests/test_pipeline_run_extended.py::test_generate_tickets_populates_market_analysis_table PASSED [ 53%]
tests/test_pipeline_run_extended.py::test_calculate_adjusted_probabilities_p_base_value_error PASSED [ 53%]
tests/test_plan.py::test_build_plan_nominal_case 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 2 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 2 races with times
PASSED                                                                   [ 53%]
tests/test_plan.py::test_build_plan_scraper_fails 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 53%]
tests/test_plan.py::test_build_plan_handles_malformed_data 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 3 races from Boturfers.
2026-01-06 09:43:57 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 53%]
tests/test_plan.py::test_build_plan_today_string 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2026-01-06 using Boturfers as the single source.
2026-01-06 09:43:57 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 53%]
tests/test_plan.py::test_build_plan_empty_enriched_plan 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-06 09:43:57 [INFO] Plan complete: 0 races with times
PASSED                                                                   [ 53%]
tests/test_plan.py::test_build_plan_partants_non_digit_string 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_plan.py::test_build_plan_handles_compact_rc_format 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_plan.py::test_build_plan_sync_wrapper 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 54%]
tests/test_plan.py::test_build_plan_sync_raises_in_event_loop 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] build_plan() is deprecated, use build_plan_async() instead
2026-01-06 09:43:57 [ERROR] Cannot use build_plan() from within event loop. Use build_plan_async() instead.
PASSED                                                                   [ 54%]
tests/test_plan.py::test_build_plan_sync_reraises_other_runtime_errors 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 54%]
tests/test_plan_extended.py::test_build_plan_handles_various_invalid_rc_formats 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 4 races from Boturfers.
2026-01-06 09:43:57 [WARNING] Could not parse R/C from 'R C'. Skipping race.
2026-01-06 09:43:57 [WARNING] Could not parse R/C from 'R1C'. Skipping race.
2026-01-06 09:43:57 [WARNING] Could not parse R/C from 'RC1'. Skipping race.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_plan_extended.py::test_build_plan_data_types 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_plan_extended.py::test_build_plan_invalid_runners_count 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_plan_extended.py::test_build_plan_mandatory_keys 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:57 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-06 09:43:57 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-06 09:43:57 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 54%]
tests/test_post_course_payload.py::test_merge_meta_both_sources PASSED   [ 54%]
tests/test_post_course_payload.py::test_merge_meta_tickets_takes_priority PASSED [ 54%]
tests/test_post_course_payload.py::test_merge_meta_with_top_level_keys PASSED [ 55%]
tests/test_post_course_payload.py::test_merge_meta_handles_missing_or_invalid_inputs PASSED [ 55%]
tests/test_post_course_payload.py::test_merge_meta_model_alias PASSED    [ 55%]
tests/test_post_course_payload.py::test_compute_post_course_summary_nominal PASSED [ 55%]
tests/test_post_course_payload.py::test_compute_post_course_summary_no_winners PASSED [ 55%]
tests/test_post_course_payload.py::test_compute_post_course_summary_empty_tickets PASSED [ 55%]
tests/test_post_course_payload.py::test_summarise_ticket_metrics PASSED  [ 55%]
tests/test_post_course_payload.py::test_apply_summary_to_ticket_container PASSED [ 55%]
tests/test_post_course_payload.py::test_build_payload PASSED             [ 55%]
tests/test_post_course_payload.py::test_build_payload_from_sources PASSED [ 55%]
tests/test_post_course_payload.py::test_format_csv_line PASSED           [ 55%]
tests/test_resolve_course_id.py::test_resolve_course_context_with_fallback PASSED [ 56%]
tests/test_resolve_course_id.py::test_resolve_course_context_picks_closest_future_entry PASSED [ 56%]
tests/test_resolve_course_id.py::test_resolve_course_context_errors_when_empty PASSED [ 56%]
tests/test_resolve_course_id.py::test_iter_schedule_entries_supports_fr_course_urls PASSED [ 56%]
tests/test_resolve_course_id.py::test_resolve_course_context_supports_fr_course_urls PASSED [ 56%]
tests/test_roi_monitor.py::test_load_json_safe_success PASSED            [ 56%]
tests/test_roi_monitor.py::test_load_json_safe_failure PASSED            [ 56%]
tests/test_roi_monitor.py::test_parse_tracking_csv_success PASSED        [ 56%]
tests/test_roi_monitor.py::test_parse_tracking_csv_failure PASSED        [ 56%]
tests/test_roi_monitor.py::test_collect_analyses_no_date_filter PASSED   [ 56%]
tests/test_roi_monitor.py::test_collect_analyses_with_date_filter PASSED [ 56%]
tests/test_roi_monitor.py::test_compute_statistics PASSED                [ 57%]
tests/test_roi_monitor.py::test_print_report PASSED                      [ 57%]
tests/test_roi_monitor.py::test_export_json PASSED                       [ 57%]
tests/test_roi_monitor.py::test_main_run_once PASSED                     [ 57%]
tests/test_roi_monitor.py::test_main_watch_mode PASSED                   [ 57%]
tests/test_roi_rebalancer.py::test_compute_allocation_plan_prioritises_high_ev PASSED [ 57%]
tests/test_roi_rebalancer.py::test_plan_serialisation_round_trip PASSED  [ 57%]
tests/test_roi_rebalancer.py::test_allocation_plan_requires_positive_bankroll PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_empty_tickets PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_no_positive_ev_tickets PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_stake_cap PASSED [ 57%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_invalid_ticket_format PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_allocation_plan_serialization PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_compute_allocation_plan_zero_bankroll PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_nominal PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_missing_metrics_block PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_ev_block PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_calculates_ev_from_roi_and_stake PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_extract_metrics_with_invalid_values PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_from_dir PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_with_direct_file_paths PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_skips_malformed_files PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_skips_files_with_no_metrics PASSED [ 58%]
tests/test_roi_rebalancer_extended.py::test_load_analysis_reports_with_non_existent_path PASSED [ 59%]
tests/test_roi_rebalancer_extended.py::test_score_basic PASSED           [ 59%]
tests/test_roi_rebalancer_extended.py::test_score_zero_ev PASSED         [ 59%]
tests/test_roi_rebalancer_extended.py::test_score_high_risk PASSED       [ 59%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_basic PASSED      [ 59%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_zero_stake PASSED [ 59%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_zero_target_stake PASSED [ 59%]
tests/test_roi_rebalancer_extended.py::test_scale_risk_clamps_max PASSED [ 59%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: True) ---
2026-01-06 09:43:58 [WARNING] Skipping task: Schedule time 2026-01-06T07:13:00+00:00 is in the past.
2026-01-06 09:43:58 [WARNING] Skipping task: Schedule time 2026-01-06T07:38:00+00:00 is in the past.
2026-01-06 09:43:58 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-06 09:43:58 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 59%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: True) ---
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.159357+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.159697+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.159948+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.160184+00:00
2026-01-06 09:43:58 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-06 09:43:58 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 59%]
tests/test_scheduler.py::test_schedule_all_races_real_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.167242+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.167562+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.167820+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.168063+00:00
2026-01-06 09:43:58 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-06 09:43:58 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387920816'>
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387920816'>
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387920816'>
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387920816'>
2026-01-06 09:43:58 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 59%]
tests/test_scheduler.py::test_schedule_all_races_real_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: False) ---
2026-01-06 09:43:58 [WARNING] Skipping task: Schedule time 2026-01-06T07:13:00+00:00 is in the past.
2026-01-06 09:43:58 [WARNING] Skipping task: Schedule time 2026-01-06T07:38:00+00:00 is in the past.
2026-01-06 09:43:58 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-06 09:43:58 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387602128'>
2026-01-06 09:43:58 [INFO] Enqueuing Cloud Task
2026-01-06 09:43:58 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='134624387602128'>
2026-01-06 09:43:58 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_phase_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [ERROR] Error calculating schedule time: invalid literal for int() with base 10: 'NVALID'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 35, in _calculate_task_schedule
    phase_minutes = int(phase[1:])
                    ^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'NVALID'
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_race_time_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [ERROR] Error calculating schedule time: Invalid isoformat string: '2025-01-01Tnot-a-time'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 36, in _calculate_task_schedule
    race_datetime_local = datetime.fromisoformat(f"{date}T{race_time_local}")
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Invalid isoformat string: '2025-01-01Tnot-a-time'
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_enqueue_run_task_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [ERROR] Service URL is not configured. Cannot create task.
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_enqueue_run_task_oidc_config_missing 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [ERROR] Failed to create task for http://example.com/race: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 106, in enqueue_run_task
    raise ValueError("TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.")
ValueError: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_enqueue_run_task_permission_denied 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [CRITICAL] Permission denied to create Cloud Task. Please grant 'roles/cloudtasks.enqueuer' to 'sa@example.com'. Original error: 403 Forbidden by policy
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_enqueue_run_task_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [ERROR] Failed to create task for http://example.com/race: Network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 124, in enqueue_run_task
    response = client.create_task(parent=parent_path, task=task)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Network error
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_schedule_all_races_real_run_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [CRITICAL] Cannot execute real run without a service_url.
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_schedule_all_races_cloud_tasks_client_init_fails 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [CRITICAL] Failed to initialize Cloud Tasks client: Client init failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 209, in schedule_all_races
    client = tasks_v2.CloudTasksClient()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Client init failed
PASSED                                                                   [ 60%]
tests/test_scheduler_extended.py::test_schedule_all_races_results_are_sorted 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:58 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.497863+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.498183+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.498446+00:00
2026-01-06 09:43:58 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-06T08:45:58.498702+00:00
2026-01-06 09:43:58 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-06 09:43:58 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-06 09:43:58 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 60%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_success PASSED [ 60%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_value_error PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_success PASSED  [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_request_error PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_status_error PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_generic_exception PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_elements PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_name_tag PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[14h30-14:30] PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[9h05-09:05] PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[11:15-11:15] PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[invalid-None] PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[-None] PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[None-None] PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_runners_count_non_digit PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_success PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_reunion_tabs PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_race_table_in_reunion PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_success PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_not_found PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_success PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_no_info_block PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_success PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_no_runners_table PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_malformed_row PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_success PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:59 [ERROR] Erreur inattendue lors du fetch HTML de http://programme.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_success PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-06 09:43:59 [ERROR] Erreur inattendue lors du fetch HTML de http://race.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_success PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_empty_url PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_fetcher_error PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_no_races_returned PASSED [ 63%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_general_exception PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_success PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_empty_url PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_url_partant_transformation PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_fetcher_error PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_no_runners_returned PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_general_exception PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_link PASSED [ 64%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_missing_conditions PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_boturfers_fetcher_init_value_error PASSED [ 64%]
tests/test_scraper_boturfers_extended.py::test_fetcher_fetch_html_httpx_status_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:00 [ERROR] Erreur HTTP lors du téléchargement de http://test.url: 404
PASSED                                                                   [ 64%]
tests/test_scraper_boturfers_extended.py::test_fetcher_fetch_html_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:00 [ERROR] Erreur inattendue lors du fetch HTML de http://test.url: Network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Network error
PASSED                                                                   [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_no_reunion_tabs 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:01 [WARNING] Aucun onglet de réunion ('div.tab-pane[id^=r]') trouvé sur la page du programme.
PASSED                                                                   [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_no_race_table_in_reunion 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:01 [WARNING] Tableau des courses ('table.table.data.prgm') introuvable pour la réunion R1.
PASSED                                                                   [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_reunion_id_from_id_attribute PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_empty_race_table PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_programme_malformed_reunion_title PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_not_found PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_from_span_tag PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_distance_from_span_tag_fallback_after_info_block_no_distance PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_no_info_block 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:05 [WARNING] Aucune métadonnée de course n'a pu être extraite de http://race.url.
PASSED                                                                   [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_no_conditions_tag_and_no_conditions_text PASSED [ 65%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_conditions_from_text_snippet PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_empty_metadata_logs_warning 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:06 [WARNING] Aucune métadonnée de course n'a pu être extraite de http://race.url.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_no_runners_table 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:07 [WARNING] Could not find runners table ('table.data') on the page.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_malformed_row 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:07 [WARNING] Failed to parse a runner row: list index out of range. Row skipped.
PASSED                                                                   [ 66%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_runners_from_details_page_no_odds PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_missing_musique_gains PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_row_runners_count_non_digit PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_row_missing_url PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_fetcher_parse_race_row_no_name_tag PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_row_missing_runners_count_tag PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type attel\xe9-Attel\xe9-N/A] PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type mont\xe9 corde \xe0 gauche-Mont\xe9-Gauche] PASSED [ 66%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type plat corde \xe0 droite-Plat-Droite] PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type obstacle-Obstacle-N/A] PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_parse_race_metadata_course_type_and_corde[type inconnu-None-N/A] PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_parse_race_runners_with_odds_place PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_get_snapshot_fetch_html_fails PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_get_snapshot_no_races_extracted 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:13 [ERROR] Aucune course n'a pu être extraite de http://programme.url.
PASSED                                                                   [ 67%]
tests/test_scraper_boturfers_extended.py::test_get_race_snapshot_fetch_html_fails PASSED [ 67%]
tests/test_scraper_boturfers_extended.py::test_get_race_snapshot_no_runners_extracted 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:13 [ERROR] Aucun partant n'a pu être extrait de http://race.url.
PASSED                                                                   [ 67%]
tests/test_scraper_boturfers_extended.py::test_fetch_boturfers_programme_fetcher_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:13 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:44:13 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
PASSED                                                                   [ 67%]
tests/test_scraper_boturfers_extended.py::test_fetch_boturfers_race_details_fetcher_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:13 [INFO] Début du scraping des détails de course.
2026-01-06 09:44:13 [ERROR] Le scraping des détails a échoué.
PASSED                                                                   [ 67%]
tests/test_scraper_boturfers_robustness.py::test_parse_programme_handles_broken_reunion_class PASSED [ 67%]
tests/test_scraper_boturfers_robustness.py::test_parse_programme_handles_missing_race_table PASSED [ 68%]
tests/test_scraper_boturfers_robustness.py::test_parse_programme_from_static_fixture PASSED [ 68%]
tests/test_scraper_boturfers_robustness.py::test_parse_race_details_from_static_fixture PASSED [ 68%]
tests/test_scraper_boturfers_robustness.py::test_programme_fixture_has_expected_structure PASSED [ 68%]
tests/test_scraper_geny.py::test_slugify[Paris-Vincennes (FR)-paris-vincennes-fr] PASSED [ 68%]
tests/test_scraper_geny.py::test_slugify[Hippodrome de la C\xf4te d'Azur-hippodrome-de-la-cote-d-azur] PASSED [ 68%]
tests/test_scraper_geny.py::test_slugify[Saint-Cloud-saint-cloud] PASSED [ 68%]
tests/test_scraper_geny.py::test_slugify[123 Test-123-test] PASSED       [ 68%]
tests/test_scraper_geny.py::test_slugify[-] PASSED                       [ 68%]
tests/test_scraper_geny.py::test_slugify[   -] PASSED                    [ 68%]
tests/test_scraper_geny.py::test_slugify[  _!@# my string 123-my-string-123] PASSED [ 68%]
tests/test_scraper_geny.py::test_fetch_geny_programme_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Discovered 2 meetings from Geny
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_no_races_container 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [WARNING] No 'next-races-container' found on Geny page.
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_empty_rows 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_malformed_row_elements 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [WARNING] Could not find meeting element 'th.race-name' in a row. Skipping row.
2026-01-06 09:44:14 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_request_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [ERROR] An error occurred while requesting 'http://mock.url': Mock request error
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_status_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [ERROR] Error response 404 while requesting 'http://mock.url': Not Found
PASSED                                                                   [ 69%]
tests/test_scraper_geny.py::test_fetch_geny_programme_id_course_from_href_fallback 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Discovered 1 meetings from Geny
PASSED                                                                   [ 69%]
tests/test_scraper_zeturf.py::test_fetch_race_snapshot_full_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] [ZEturf] phase=H30 url=https://www.zeturf.fr/fr/course/2025-11-20/R1C1-saint-galmier partants=12
PASSED                                                                   [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[H-30-H30] PASSED           [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[H30-H30] PASSED            [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[h05-H5] PASSED             [ 69%]
tests/test_scraper_zeturf.py::test_phase_norm[H5-H5] PASSED              [ 70%]
tests/test_scraper_zeturf.py::test_phase_norm[UNKNOWN-H30] PASSED        [ 70%]
tests/test_scraper_zeturf.py::test_phase_norm[-H30] PASSED               [ 70%]
tests/test_scraper_zeturf.py::test_phase_norm[None-H30] PASSED           [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_success PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_value_error_no_rc PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_empty_snapshot PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_missing_runners PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_non_dict_snapshot PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_h5_phase_input PASSED [ 70%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_various_rc_formats PASSED [ 70%]
tests/test_service.py::test_get_pronostics_page 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_pronostics_data_empty_case 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_pronostics_data_etag_304_not_modified 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 304 Not Modified"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_pronostics_data_with_data 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_ops_status 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_get_ops_status_reason_if_empty 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_health_check 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_legacy_redirects 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 71%]
tests/test_service.py::test_post_ops_run_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Manual run triggered for race R1C1 on 2026-01-06
2026-01-06 09:44:14 [INFO] Successfully processed and saved manual run for 2026-01-06_R1C1
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_run_single_race_missing_course_url 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Manual run triggered for race R1C1 on 2026-01-06
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 400 Bad Request"
PASSED                                                                   [ 71%]
tests/test_service.py::test_schedule_day_races_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Received request to schedule day races. Force: True, Dry Run: True
2026-01-06 09:44:14 [INFO] Built plan with 1 races. Passing to scheduler with service_url: https://testserver
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 71%]
tests/test_service.py::test_schedule_day_races_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Received request to schedule day races. Force: False, Dry Run: False
2026-01-06 09:44:14 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_run_single_race_unhandled_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Manual run triggered for race R1C1 on 2026-01-06
2026-01-06 09:44:14 [ERROR] Critical error during manual run for 2026-01-06_R1C1: Simulated pipeline error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/service.py", line 280, in run_single_race
    analysis_result = await analysis_pipeline.run_analysis_for_phase(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Simulated pipeline error
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 72%]
tests/test_service.py::test_schedule_day_races_unhandled_exception 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [ERROR] UNHANDLED EXCEPTION in /schedule endpoint: Simulated unhandled error
TRACEBACK:
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/service.py", line 212, in schedule_day_races
    daily_plan = await plan.build_plan_async(plan_date)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Simulated unhandled error

PASSED                                                                   [ 72%]
tests/test_service.py::test_api_pronostics_schema 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-06 09:44:14 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-06 09:44:14 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:44:14 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-06 09:44:14 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-06 09:44:14 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:44:14 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_run_single_race_not_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Manual run triggered for race R1C1 on 2026-01-06
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 404 Not Found"
PASSED                                                                   [ 72%]
tests/test_service.py::test_get_daily_plan_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:14 [INFO] Request started
2026-01-06 09:44:14 [INFO] Request finished
2026-01-06 09:44:14 [INFO] HTTP Request: GET http://testserver/api/plan?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_debug_config_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/debug/config "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_get_pronostics_data_defaults_to_today 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_ui_contains_critical_elements_and_api_call 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 72%]
tests/test_service.py::test_get_daily_plan_invalid_date_format 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/plan?date=not-a-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 72%]
tests/test_service.py::test_get_ops_status_invalid_date_format 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/ops/status?date=not-a-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 72%]
tests/test_service.py::test_api_pronostics_schema_and_ui_markers 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-06 09:44:15 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-06 09:44:15 [INFO] Début du scraping du programme Boturfers.
2026-01-06 09:44:15 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-06 09:44:15 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-06 09:44:15 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-06 09:44:15 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 73%]
tests/test_service_extended.py::test_get_pronostics_data_invalid_date 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=invalid-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 73%]
tests/test_service_extended.py::test_get_pronostics_data_plan_only 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 73%]
tests/test_service_smoke.py::test_ping_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 73%]
tests/test_service_smoke.py::test_pronostics_endpoint_returns_data 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Request started
2026-01-06 09:44:15 [INFO] Request finished
2026-01-06 09:44:15 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-10 "HTTP/1.1 200 OK"
PASSED                                                                   [ 73%]
tests/test_simulate_ev_module.py::test_implied_probs_normalizes PASSED   [ 73%]
tests/test_simulate_ev_module.py::test_normalize_overround_balances_dict PASSED [ 73%]
tests/test_simulate_ev_module.py::test_kelly_fraction_basic PASSED       [ 73%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_cap PASSED   [ 73%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_min_stake_filter PASSED [ 73%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_skips_invalid PASSED [ 73%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_uses_precomputed_implied_probs PASSED [ 74%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_fallbacks_when_probabilities_invalid PASSED [ 74%]
tests/test_simulate_ev_module.py::test_gate_ev_thresholds PASSED         [ 74%]
tests/test_simulate_ev_module.py::test_gate_ev_sharpe_min PASSED         [ 74%]
tests/test_simulate_ev_module.py::test_simulate_ev_batch_uses_simulate_wrapper PASSED [ 74%]
tests/test_simulate_wrapper.py::test_calibration_details_expose_metadata PASSED [ 74%]
tests/test_simulate_wrapper.py::test_beta_binomial_fallback PASSED       [ 74%]
tests/test_simulate_wrapper.py::test_invalid_calibration PASSED          [ 74%]
tests/test_simulate_wrapper.py::test_combination_order PASSED            [ 74%]
tests/test_simulate_wrapper.py::test_cache_prevents_recomputation PASSED [ 74%]
tests/test_simulate_wrapper.py::test_cache_eviction PASSED               [ 74%]
tests/test_simulate_wrapper.py::test_fallback_uses_leg_probabilities PASSED [ 75%]
tests/test_simulate_wrapper.py::test_fallback_uses_implied_odds PASSED   [ 75%]
tests/test_simulate_wrapper.py::test_correlation_penalty_reduces_probability_and_ev PASSED [ 75%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] No race plan found for 2025-01-01. No snapshots will be created.
PASSED                                                                   [ 75%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_successful_run 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Starting daily snapshot job for 2025-01-01, phase H-5
2026-01-06 09:44:15 [INFO] Found 2 races for 2025-01-01. Creating snapshots...
2026-01-06 09:44:15 [INFO] Finished creating 2 snapshot tasks for 2025-01-01.
PASSED                                                                   [ 75%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_incomplete_race_data 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] Skipping race with incomplete data: {'date': '2025-01-01', 'r_label': 'R2', 'c_label': 'C1'}
2026-01-06 09:44:15 [WARNING] Skipping race with incomplete data: {'course_url': 'url3', 'r_label': 'R3', 'c_label': 'C1'}
PASSED                                                                   [ 75%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_async_error_handling 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [ERROR] Failed during daily snapshot job for 2025-01-01: Failed to build plan
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/snapshot_manager.py", line 33, in write_snapshot_for_day_async
    plan = await build_plan_async(date_str)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Failed to build plan
PASSED                                                                   [ 75%]
tests/test_snapshot_manager.py::test_write_snapshot_for_day_sync_wrapper PASSED [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_no_snapshot_metadata 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [ERROR] Cannot collect stats, no snapshot found for race_id in phase H-5
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_snapshot_metadata_no_path 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [ERROR] Cannot collect stats, no snapshot found for race_id in phase H-5
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_no_runners_in_snapshot 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] No runners found in snapshot path/to/snapshot.json, cannot collect stats.
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_successful_run 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Starting stats collection for race_id
2026-01-06 09:44:15 [INFO] Successfully fetched chrono stats for Horse A
2026-01-06 09:44:15 [INFO] Successfully fetched jockey stats for Jockey A: 25.0%
2026-01-06 09:44:15 [INFO] Successfully fetched trainer stats for Trainer A: 30.0%
2026-01-06 09:44:15 [INFO] Successfully fetched chrono stats for Horse B
2026-01-06 09:44:15 [INFO] Successfully fetched jockey stats for Jockey B: 15.0%
2026-01-06 09:44:15 [INFO] Successfully fetched trainer stats for Trainer B: 10.0%
2026-01-06 09:44:15 [WARNING] Could not fetch chrono stats for Horse C
2026-01-06 09:44:15 [WARNING] Jockey name not available for runner Horse C
2026-01-06 09:44:15 [INFO] Successfully fetched trainer stats for Trainer C: 5.0%
2026-01-06 09:44:15 [WARNING] Could not fetch chrono stats for Horse D
2026-01-06 09:44:15 [INFO] Successfully fetched jockey stats for Jockey D: 20.0%
2026-01-06 09:44:15 [WARNING] Trainer name not available for runner Horse D
2026-01-06 09:44:15 [INFO] Successfully saved aggregated stats to path/to/stats.json
PASSED                                                                   [ 75%]
tests/test_stats_fetcher_extended.py::test_collect_stats_error_fetching_chrono 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [ERROR] Error fetching chrono stats for Horse A: Chrono error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 74, in collect_stats
    chrono_data = await zoneturf_client.get_chrono_stats(horse_name=runner_name)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Chrono error
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_error_fetching_jockey_trainer 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [ERROR] Error fetching jockey stats for Jockey A: Jockey/Trainer error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 93, in collect_stats
    jockey_stats = await zoneturf_client.get_jockey_trainer_stats(jockey_name, "jockey")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Jockey/Trainer error
2026-01-06 09:44:15 [ERROR] Error fetching trainer stats for Trainer A: Jockey/Trainer error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 118, in collect_stats
    trainer_stats = await zoneturf_client.get_jockey_trainer_stats(trainer_name, "entraineur")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 93, in collect_stats
    jockey_stats = await zoneturf_client.get_jockey_trainer_stats(jockey_name, "jockey")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Jockey/Trainer error
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_save_snapshot_failure 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [CRITICAL] CRITICAL: Failed to save stats snapshot to GCS: GCS save error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_fetcher.py", line 172, in collect_stats
    stats_gcs_path = await gcs_client.save_snapshot(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: GCS save error
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_missing_jockey_trainer_names 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] Jockey name not available for runner Horse A
2026-01-06 09:44:15 [WARNING] Trainer name not available for runner Horse A
2026-01-06 09:44:15 [WARNING] Trainer name not available for runner Horse B
2026-01-06 09:44:15 [WARNING] Jockey name not available for runner Horse C
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_runner_without_num_or_nom 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [INFO] Starting stats collection for race_id
2026-01-06 09:44:15 [INFO] Successfully fetched chrono stats for Horse C
2026-01-06 09:44:15 [INFO] Successfully fetched jockey stats for Jockey C: 20.0%
2026-01-06 09:44:15 [INFO] Successfully fetched trainer stats for Trainer C: 20.0%
2026-01-06 09:44:15 [INFO] Successfully saved aggregated stats to path/to/stats.json
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_chrono_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] Could not fetch chrono stats for Horse A
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_jockey_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] Could not fetch jockey stats for Jockey A
PASSED                                                                   [ 76%]
tests/test_stats_fetcher_extended.py::test_collect_stats_get_trainer_stats_returns_none 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:15 [WARNING] Could not fetch trainer stats for Trainer A
PASSED                                                                   [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[Test Name-test-name] PASSED [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[Un cheval avec accentu\xe9-un-cheval-avec-accentue] PASSED [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[  leading & trailing spaces  -leading-trailing-spaces] PASSED [ 76%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[!@#invalid-chars$%-invalid-chars] PASSED [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[-] PASSED [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_slugify[----] PASSED [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_normalize_name[E. Raffin-eraffin] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:15 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_normalize_name[J. DUBOIS-jdubois] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:15 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_normalize_name[Jean-\xc9tienne Dubois-jeanetiennedubois] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:15 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_normalize_name[Horse 123-horse123] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:15 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderHelpers::test_normalize_name[-] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'11"6-71.6] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'12''3-72.3] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'10"-70.0] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 77%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[59"8-59.8] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[None-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[invalid-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [WARNING] Could not parse chrono string: invalid
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_horse_chrono_parsing 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_horse_chrono_parsing_incomplete 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_http_error[fetch_horse_chrono] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [ERROR] HTTP error while fetching chrono for 'Known Entity': Not Found
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_http_error[fetch_jockey_stats] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [ERROR] HTTP error while fetching stats for jockey 'Known Entity': Not Found
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_http_error[fetch_trainer_stats] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [ERROR] HTTP error while fetching stats for trainer 'Known Entity': Not Found
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing_edge_cases[\n                <html><body><h2>Statistiques 2025 de S. Mestries</h2>\n                <table>\n                    <tr><td>Partants</td><td> 0 </td></tr>\n                    <tr><td>Victoires</td><td> 0 </td></tr>\n                    <tr><td>Plac\xe9s</td><td> 0 </td></tr>\n                </table></body></html>\n                -expected_stats0] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 78%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing_edge_cases[<html><body><h2>Statistiques 2025 de S. Mestries</h2></body></html>-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [WARNING] Stats table not found for trainer 'A Trainer' at /entraineur/a-trainer-54007/
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing_edge_cases[<html><body><table><tr><td>Partants</td><td> 10 </td></tr></table></body></html>-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:16 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:16 [WARNING] Stats section not found for trainer 'A Trainer' at /entraineur/a-trainer-54007/
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_id_resolution_failure[fetch_horse_chrono] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_id_resolution_failure[fetch_jockey_stats] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_methods_handle_id_resolution_failure[fetch_trainer_stats] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing_edge_cases[\n                <html><body><h2>Statistiques 2025 de E. Raffin</h2>\n                <table>\n                    <tr><td>Courses</td><td> 0 </td></tr>\n                    <tr><td>Victoires</td><td> 0 </td></tr>\n                    <tr><td>Plac\xe9s</td><td> 0 </td></tr>\n                </table></body></html>\n                -expected_stats0] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing_edge_cases[<html><body><h2>Statistiques 2025 de E. Raffin</h2></body></html>-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [WARNING] Stats table not found for jockey 'A Jockey' at /jockey/a-jockey-2957/
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing_edge_cases[<html><body><table><tr><td>Courses</td><td> 10 </td></tr></table></body></html>-None] 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [WARNING] Stats section not found for jockey 'A Jockey' at /jockey/a-jockey-2957/
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_get_id_from_cache_handles_exception 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [ERROR] Failed to read from cache for horse_myhorse: Firestore unavailable
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_set_id_to_cache_handles_exception 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [ERROR] Failed to write to cache for horse_myhorse: Firestore unavailable
PASSED                                                                   [ 79%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_get_id_from_cache_expired 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache expired for horse 'My Horse'.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_empty_name 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_cache_hit 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_scraping 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache miss for horse 'JULLOU'. Resolving via scraping.
2026-01-06 09:44:17 [INFO] Resolved ID for 'JULLOU' to '1772764'.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_handles_http_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache miss for horse 'My Horse'. Resolving via scraping.
2026-01-06 09:44:17 [ERROR] HTTP error while resolving ID for 'My Horse' at page 1: Server Error
2026-01-06 09:44:17 [WARNING] Could not resolve ID for horse 'My Horse' after scraping.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_handles_non_letter_name 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache miss for horse '1st Horse'. Resolving via scraping.
2026-01-06 09:44:17 [WARNING] Could not resolve ID for horse '1st Horse' after scraping.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_not_found 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache miss for horse 'Unknown Horse'. Resolving via scraping.
2026-01-06 09:44:17 [WARNING] Could not resolve ID for horse 'Unknown Horse' after scraping.
PASSED                                                                   [ 80%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_pagination_limit 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:17 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:17 [INFO] Cache miss for horse 'My Horse'. Resolving via scraping.
2026-01-06 09:44:17 [WARNING] Could not resolve ID for horse 'My Horse' after scraping.
PASSED                                                                   [ 80%]
tests/test_stats_provider_extended.py::test_slugify PASSED               [ 80%]
tests/test_stats_provider_extended.py::test_normalize_name 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 80%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_success 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 80%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_network_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] An error occurred while fetching chrono for 'Test Horse': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 301, in fetch_horse_chrono
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_http_status_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] HTTP error while fetching chrono for 'Test Horse': Not Found
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_records_table 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_performances_table 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_no_data_returns_none 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [WARNING] No chrono data found for horse 'Test Horse' at /cheval/test-horse-12345/
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_network_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] An error occurred while fetching stats for jockey 'Test Jockey': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 368, in fetch_jockey_stats
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_http_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] HTTP error while fetching stats for jockey 'Test Jockey': Server Error
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_no_header 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [WARNING] Stats section not found for jockey 'Test Jockey' at /jockey/test-jockey-123/
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_no_table 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [WARNING] Stats table not found for jockey 'Test Jockey' at /jockey/test-jockey-123/
PASSED                                                                   [ 81%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_network_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] An error occurred while fetching stats for trainer 'Test Trainer': mock network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/stats_provider.py", line 433, in fetch_trainer_stats
    response = self.client.get(url_path)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
httpx.RequestError: mock network error
PASSED                                                                   [ 82%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_http_error 
-------------------------------- live log setup --------------------------------
2026-01-06 09:44:18 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [ERROR] HTTP error while fetching stats for trainer 'Test Trainer': Server Error
PASSED                                                                   [ 82%]
tests/test_tickets_store.py::test_client_returns_storage_client PASSED   [ 82%]
tests/test_tickets_store.py::test_blob_path_constructs_correct_path PASSED [ 82%]
tests/test_tickets_store.py::test_index_path_constructs_correct_path PASSED [ 82%]
tests/test_tickets_store.py::test_render_ticket_html_full_payload PASSED [ 82%]
tests/test_tickets_store.py::test_render_ticket_html_minimal_payload PASSED [ 82%]
tests/test_tickets_store.py::test_render_ticket_html_different_keys_for_ev_roi_tickets PASSED [ 82%]
tests/test_tickets_store.py::test_save_ticket_html_success PASSED        [ 82%]
tests/test_tickets_store.py::test_save_ticket_html_no_bucket_env_var_raises_error PASSED [ 82%]
tests/test_tickets_store.py::test_build_and_save_ticket_success PASSED   [ 82%]
tests/test_tickets_store.py::test_list_ticket_objects_success PASSED     [ 83%]
tests/test_tickets_store.py::test_list_ticket_objects_empty_list PASSED  [ 83%]
tests/test_tickets_store.py::test_list_ticket_objects_no_bucket_env_var_raises_error PASSED [ 83%]
tests/test_tickets_store.py::test_rebuild_index_success PASSED           [ 83%]
tests/test_tickets_store.py::test_rebuild_index_no_bucket_env_var_raises_error PASSED [ 83%]
tests/test_tickets_store.py::test_load_ticket_html_success PASSED        [ 83%]
tests/test_tickets_store.py::test_load_ticket_html_no_bucket_env_var_raises_error PASSED [ 83%]
tests/test_ui.py::test_read_main 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:18 [INFO] Request started
2026-01-06 09:44:18 [INFO] Request finished
2026-01-06 09:44:18 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 83%]
tests/test_update_excel_planning.py::test_cli_invalid_phase_raises_error PASSED [ 83%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[nb_partants-10-partants-10] PASSED [ 83%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[runners_count-11 partants-partants-11] PASSED [ 83%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[start-10h30-start_time-10:30] PASSED [ 83%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[heure_depart-11:00-start_time-11:00] PASSED [ 84%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[specialite-Steeple-discipline-Steeple] PASSED [ 84%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[r-R5-reunion-R5] PASSED [ 84%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[c-C6-course-C6] PASSED [ 84%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets0-] PASSED [ 84%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets1-SG:1@4.5] PASSED [ 84%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets2-JUM:2-4@12.1 | TRIO:5-6-7] PASSED [ 84%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets3-WEIRD:8-9] PASSED [ 84%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets4-2S4:10-11-12] PASSED [ 84%]
tests/test_update_excel_planning.py::test_h30_updates_existing_row PASSED [ 84%]
tests/test_update_excel_planning.py::test_h30_populates_planning_sheet PASSED [ 84%]
tests/test_update_excel_planning.py::test_h5_updates_status_and_tickets PASSED [ 85%]
tests/test_update_excel_planning.py::test_h5_abstention_uses_reason PASSED [ 85%]
tests/test_update_excel_planning.py::test_h5_preserves_existing_metadata_when_missing PASSED [ 85%]
tests/test_update_excel_planning.py::test_h5_converts_timezone_when_tz_env_set PASSED [ 85%]
tests/test_update_excel_planning.py::test_custom_status_h5_flag PASSED   [ 85%]
tests/test_update_excel_planning.py::test_custom_status_h30_and_h5 PASSED [ 85%]
tests/test_update_excel_planning.py::test_h30_preserves_existing_comment PASSED [ 85%]
tests/test_update_excel_planning.py::test_h30_handles_nested_course_payload PASSED [ 85%]
tests/test_update_excel_planning.py::test_h30_infers_rc_fields PASSED    [ 85%]
tests/test_update_excel_planning.py::test_h5_infers_rc_fields PASSED     [ 85%]
tests/test_update_excel_planning.py::test_h5_compact_ticket_summary PASSED [ 85%]
tests/test_update_excel_planning.py::test_format_time_respects_input_timezone PASSED [ 86%]
tests/test_update_excel_planning.py::test_format_time_uses_env_timezone PASSED [ 86%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[13h05-13:05] PASSED [ 86%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[7h-07:00] PASSED [ 86%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[09 heures 30-09:30] PASSED [ 86%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[18.45-18:45] PASSED [ 86%]
tests/test_update_excel_planning.py::test_cli_alias_and_dash_phase PASSED [ 86%]
tests/test_update_excel_with_results.py::test_update_excel_records_observed_roi PASSED [ 86%]
tests/test_validator_ev.py::test_validate_ev_passes_with_defaults 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 86%]
tests/test_validator_ev.py::test_validate_ev_sp_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 86%]
tests/test_validator_ev.py::test_validate_ev_combo_optional 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 86%]
tests/test_validator_ev.py::test_validate_ev_combo_required 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 87%]
tests/test_validator_ev.py::test_validate_ev_logs_context 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': 18.0, 'stake': 10.0, 'EV_ratio': 0.35}
PASSED                                                                   [ 87%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_probability 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': 25.0, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 87%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_payout 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 87%]
tests/test_validator_ev.py::test_validate_policy_pass PASSED             [ 87%]
tests/test_validator_ev.py::test_validate_policy_fail_ev PASSED          [ 87%]
tests/test_validator_ev.py::test_validate_policy_fail_roi PASSED         [ 87%]
tests/test_validator_ev.py::test_validate_combos_pass PASSED             [ 87%]
tests/test_validator_ev.py::test_validate_combos_fail_default PASSED     [ 87%]
tests/test_validator_ev.py::test_combos_allowed_thresholds PASSED        [ 87%]
tests/test_validator_ev.py::test_validate_inputs_ok PASSED               [ 87%]
tests/test_validator_ev.py::test_validate_inputs_partants_insuffisants PASSED [ 88%]
tests/test_validator_ev.py::test_validate_inputs_cote_none PASSED        [ 88%]
tests/test_validator_ev.py::test_validate_inputs_couverture PASSED       [ 88%]
tests/test_validator_ev.py::test_summarise_validation_success PASSED     [ 88%]
tests/test_validator_ev.py::test_summarise_validation_failure_returns_reason PASSED [ 88%]
tests/test_validator_ev.py::test_validator_cli_returns_non_zero_on_failure PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_happy_path PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_not_enough_partants PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_missing_odds PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_none_in_odds PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_je_coverage_insufficient PASSED [ 88%]
tests/test_validator_ev_extended.py::test_validate_inputs_je_coverage_missing_but_allowed PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_inconsistent_partants PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_no_partants PASSED    [ 89%]
tests/test_validator_ev_extended.py::test_validate_missing_odds_h30 PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_non_numeric_odds_h5 PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_invalid_odds_h30 PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_missing_je_stats_when_required PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_happy_path PASSED     [ 89%]
tests/test_validator_ev_extended.py::test_validate_je_stats_not_required PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_ev_sp_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 89%]
tests/test_validator_ev_extended.py::test_validate_ev_global_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 89%]
tests/test_validator_ev_extended.py::test_validate_ev_global_none_and_combo_needed 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_validate_ev_happy_path_with_combo 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_validate_ev_happy_path_no_combo 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_validate_ev_missing_p_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': 10, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_validate_ev_missing_payout_expected 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [INFO] [validate_ev] context {'p_success': 0.5, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 90%]
tests/test_validator_ev_extended.py::test_validate_policy_ev_below_threshold PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_policy_roi_below_threshold PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_policy_happy_path PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_budget_total_exceeded PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_budget_per_horse_exceeded PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_budget_happy_path PASSED [ 90%]
tests/test_validator_ev_extended.py::test_validate_combos_payout_below_threshold PASSED [ 91%]
tests/test_validator_ev_extended.py::test_validate_combos_happy_path PASSED [ 91%]
tests/test_validator_ev_extended.py::test_combos_allowed_ev_below_threshold PASSED [ 91%]
tests/test_validator_ev_extended.py::test_combos_allowed_payout_below_threshold PASSED [ 91%]
tests/test_validator_ev_extended.py::test_combos_allowed_invalid_inputs PASSED [ 91%]
tests/test_validator_ev_extended.py::test_combos_allowed_happy_path PASSED [ 91%]
tests/test_validator_ev_extended.py::test_cli_happy_path PASSED          [ 91%]
tests/test_validator_ev_extended.py::test_cli_file_not_found PASSED      [ 91%]
tests/test_validator_ev_extended.py::test_cli_validation_error PASSED    [ 91%]
tests/test_validator_ev_extended.py::test_cli_readme_roi_mismatch PASSED [ 91%]
tests/test_validator_ev_extended.py::test_cli_allow_je_na_flag PASSED    [ 91%]
tests/test_validator_ev_extended.py::test_load_cfg_no_config_file PASSED [ 91%]
tests/test_validator_ev_extended.py::test_load_cfg_invalid_yaml_returns_empty_dict 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:20 [WARNING] Invalid YAML in config/gpi.yml, returning empty config.
PASSED                                                                   [ 92%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_readme PASSED [ 92%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_match PASSED [ 92%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_invalid_value PASSED [ 92%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_below_target PASSED [ 92%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_above_target PASSED [ 92%]
tests/test_validator_ev_extended.py::test_summarise_validation_all_pass PASSED [ 92%]
tests/test_validator_ev_extended.py::test_summarise_validation_first_fails PASSED [ 92%]
tests/test_validator_ev_extended.py::test_must_have_falsy_value_raises_runtime_error PASSED [ 92%]
tests/test_validator_ev_extended.py::test_must_have_truthy_value_returns_value PASSED [ 92%]
tests/test_validator_ev_extended.py::test_normalise_phase_invalid_phase_raises_value_error PASSED [ 92%]
tests/test_validator_ev_extended.py::test_normalise_phase_h5 PASSED      [ 93%]
tests/test_validator_ev_extended.py::test_normalise_phase_h30 PASSED     [ 93%]
tests/test_validator_ev_extended.py::test_normalise_phase_none_returns_h5 PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_json_payload_invalid_json_raises_json_decode_error PASSED [ 93%]
tests/test_validator_ev_extended.py::test_find_first_existing_none_found PASSED [ 93%]
tests/test_validator_ev_extended.py::test_find_first_existing_found PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_partants_invalid_list_format_returns_empty_list PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_partants_invalid_dict_format_raises_value_error PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_odds_empty_odds_map_raises_value_error PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_odds_from_dict_with_invalid_values PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_odds_from_list_with_invalid_values PASSED [ 93%]
tests/test_validator_ev_extended.py::test_load_config_non_existent_path PASSED [ 94%]
tests/test_validator_ev_extended.py::test_load_config_invalid_yaml 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [WARNING] Invalid YAML in invalid.yml, returning empty config.
PASSED                                                                   [ 94%]
tests/test_validator_ev_extended.py::test_load_config_invalid_json 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [WARNING] Invalid JSON in invalid.json, returning empty config.
PASSED                                                                   [ 94%]
tests/test_validator_ev_extended.py::test_load_config_valid_yaml PASSED  [ 94%]
tests/test_validator_ev_extended.py::test_load_config_valid_json PASSED  [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-jullou] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[  Jullou  -jullou] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou (FR)-jullou] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard-jullou nivard] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard (FR)-jullou nivard] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[\xc9curie Royale-ecurie royale] PASSED [ 94%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou's Horse-jullous horse] PASSED [ 95%]
tests/test_zoneturf_client.py::test_normalize_name[-] PASSED             [ 95%]
tests/test_zoneturf_client.py::test_normalize_name[None-] PASSED         [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11"6-71.6] PASSED  [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'15''3-75.3] PASSED [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'20"0-80.0] PASSED  [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[0'59"9-59.9] PASSED  [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[None-None] PASSED    [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[-None] PASSED        [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[invalid-None] PASSED [ 95%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11-None] PASSED    [ 95%]
tests/test_zoneturf_client.py::test_resolve_horse_id_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-06 09:44:21 [INFO] Resolved 'Jullou' to ID: 1772764
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_resolve_horse_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [INFO] Resolving Zone-Turf ID for 'NonExistentHorse' via alphabetical pages...
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_resolve_horse_id_network_error 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-06 09:44:21 [WARNING] Failed to fetch page https://www.zone-turf.fr/cheval/lettre-j.html?p=1: Network issue
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_resolve_horse_id_cache_hit PASSED    [ 96%]
tests/test_zoneturf_client.py::test_resolve_horse_id_no_alpha_in_name PASSED [ 96%]
tests/test_zoneturf_client.py::test_resolve_person_id_success 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [INFO] Resolving Zone-Turf ID for 'Julien Dupont' (jockey) via alphabetical pages...
2026-01-06 09:44:21 [INFO] Resolved 'Julien Dupont' to ID: 112233
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_resolve_person_id_cache_hit PASSED   [ 96%]
tests/test_zoneturf_client.py::test_resolve_person_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:21 [INFO] Resolving Zone-Turf ID for 'NonExistentJockey' (jockey) via alphabetical pages...
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_with_jullou_page PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_no_chrono_data PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_empty_content PASSED [ 96%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_record PASSED [ 97%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_table_chrono PASSED [ 97%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_correctly_finds_jullou_chrono PASSED [ 97%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_success PASSED [ 97%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_no_stats_block PASSED [ 97%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_empty_content PASSED [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_success PASSED      [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Could not get Zone-Turf ID for horse: Jullou
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Failed to fetch Zone-Turf page for Jullou due to network error
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Failed to fetch Zone-Turf page for Jullou (ID: 1772764) with status 404
PASSED                                                                   [ 97%]
tests/test_zoneturf_client.py::test_get_chrono_stats_cache_hit PASSED    [ 97%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_success PASSED [ 98%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Could not get Zone-Turf ID for jockey: Julien Dupont
PASSED                                                                   [ 98%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_cache_hit PASSED [ 98%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont due to network error
PASSED                                                                   [ 98%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont (ID: 112233) with status 404
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/cheval/lettre-t.html?p=1
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
PASSED                                                                   [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_info_card PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_performance_card PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_tag PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_text PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_list_group PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_attelle_li PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_red_km_header PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_malformed_row PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_other_horse_name PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_multiple_attelle_sections PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/jockey/lettre-t.html?p=1
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-06 09:44:22 [INFO] Resolving Zone-Turf ID for 'TestPerson' (jockey) via alphabetical pages...
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_rates PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_table PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_malformed_table_data PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_no_stat_paragraph PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97      0     14      1    99%   82->85
hippique_orchestrator/analysis_utils.py                        181      8     82      8    93%   61-62, 68-69, 103->105, 107-108, 109->112, 224->252, 229->235, 247, 315->323, 372
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74      0     10      1    99%   214->194
hippique_orchestrator/auth.py                                   28      3      8      1    89%   29, 63-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      0      2      0   100%
hippique_orchestrator/ev_calculator.py                         522     36    208     13    91%   164->171, 171->161, 291, 340, 417, 479, 498-499, 540->543, 643-687, 731, 897, 923, 957-962
hippique_orchestrator/fetch_je_stats.py                        265     24     66     13    89%   66, 86-93, 129, 132, 149, 181->183, 191-192, 197, 205->202, 226->231, 229-230, 232->237, 235-236, 290->297, 297->304, 301-302, 304->309, 306-307, 418
hippique_orchestrator/firestore_client.py                       98      0     32      0   100%
hippique_orchestrator/gcs_client.py                             72      4     14      2    93%   44->46, 113-115, 125
hippique_orchestrator/gcs_utils.py                              52      0     10      0   100%
hippique_orchestrator/kelly.py                                  42      6     18      4    83%   12, 14-15, 48, 59, 61
hippique_orchestrator/logging_io.py                             39      3     10      2    90%   42-44, 47->51
hippique_orchestrator/logging_middleware.py                     22      4      0      0    82%   50-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25      0     10      0   100%
hippique_orchestrator/p_finale.py                               41      0     22      0   100%
hippique_orchestrator/pipeline_run.py                          353      8    142     14    96%   100, 171-172, 240, 242, 322->337, 367->369, 379->385, 437->425, 460, 498->494, 503->507, 507->535, 599->586, 612->586, 684-685
hippique_orchestrator/plan.py                                   42      0     16      0   100%
hippique_orchestrator/post_course_payload.py                   181      6     62     10    93%   85->84, 125-128, 245->247, 249->251, 252, 292->299, 294->296, 298, 301->305, 303->305
hippique_orchestrator/runner.py                                 35      2      6      1    93%   29-30
hippique_orchestrator/scheduler.py                             101      0     28      0   100%
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206      7     80      6    95%   99-104, 109, 143->141, 151, 163->165, 170, 217
hippique_orchestrator/scrapers/geny.py                          61      1     14      2    96%   87, 95->98
hippique_orchestrator/scrapers/zeturf.py                        26      0      6      0   100%
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202     10     48     10    92%   59, 67, 71, 170->173, 174->177, 178->121, 301-304, 313-314, 325, 343
hippique_orchestrator/scripts/concat_je_month.py               108      4     48      6    94%   70->69, 73->76, 77->76, 87-88, 108->110, 204, 208
hippique_orchestrator/scripts/cron_decider.py                   66      1     20      1    98%   133
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39      0     14      0   100%
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204     21     44      8    88%   43-44, 59, 67, 83, 305-308, 317-318, 329, 333-341, 347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1048    373    576    111    60%   53-62, 83, 95-96, 100, 110, 116-117, 121->124, 158, 172-175, 177->167, 191, 225-236, 246, 265-277, 281->279, 286-287, 288->283, 291, 317, 337->339, 340, 342, 349-352, 360-361, 365, 377, 379, 396->399, 402->405, 419->421, 421->424, 424->393, 444, 470-471, 475, 477, 481, 486, 499, 507, 516, 547->556, 552->556, 557-563, 580-581, 599->605, 611-624, 637-683, 705, 708, 712-719, 723-726, 743, 746, 776-804, 812-820, 830, 839, 862->858, 874, 877-883, 927->930, 945->950, 948->950, 951, 987->983, 1013-1020, 1025-1029, 1042->1049, 1044->1043, 1046->1043, 1049->1086, 1054-1058, 1061-1066, 1071-1072, 1074->1068, 1096-1100, 1103-1107, 1110-1114, 1116->1132, 1123->1130, 1133-1138, 1141, 1168, 1170-1173, 1185, 1187, 1194-1197, 1211-1234, 1243, 1248-1249, 1255, 1264->1260, 1270-1271, 1275-1277, 1280, 1286->1288, 1288->1290, 1291, 1303, 1309, 1333->1301, 1337-1372, 1383-1385, 1391->1418, 1396, 1404, 1416, 1419-1421, 1428, 1431, 1434, 1450, 1457->1461, 1459->1458, 1504->1506, 1506->1508, 1554->1557, 1566->1591, 1610-1613, 1618, 1621-1622, 1630, 1637-1638, 1645-1646, 1649->1658, 1656, 1694-1853, 1858, 1862
hippique_orchestrator/scripts/p_finale_export.py                80     30     30     10    56%   15-17, 28-38, 44, 49-50, 69-70, 80->87, 81->80, 84->80, 88-89, 97-100, 103-104, 110, 123-125
hippique_orchestrator/scripts/resolve_course_id.py             141     52     64     13    59%   41, 44, 47-48, 52, 60, 82->88, 84->88, 89-94, 106, 120-170, 178, 182, 204->209, 206->209, 210-213, 226-256
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221     57     98     13    72%   64, 76-77, 88-89, 102-103, 112-113, 122-123, 143, 162, 182, 186->188, 195, 225, 268-284, 297-326, 332->340, 336, 340->353, 348-349, 353->360, 357, 360->exit, 364
hippique_orchestrator/scripts/simulate_wrapper.py              468    128    238     52    67%   45-46, 105-107, 118, 126->129, 127->126, 149-155, 162-171, 184-189, 195-200, 229, 235, 246, 259, 266, 269-271, 282, 286-288, 290, 295-296, 311, 313->308, 329-332, 344, 352->354, 366->342, 380, 398, 400, 404, 422, 474, 477, 481-500, 504->508, 505->504, 537-538, 544, 546, 552, 558, 561, 564, 574, 577, 613-618, 633, 645-646, 666-672, 685, 694, 699-706, 743-747, 750-751, 758-759, 761-764, 789, 793-795, 798-799, 814-820
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424     40    226     46    86%   46, 50, 84, 96->94, 110-111, 122, 125, 130-131, 148-154, 157->159, 166->163, 186, 195, 197, 203, 233->235, 237->239, 253->261, 258-259, 267->269, 271->262, 339, 343, 357, 378, 391, 396->395, 412, 415, 418, 423, 429, 437, 448, 462, 479->481, 481->483, 484->486, 491, 493->446, 551, 555, 558, 581, 610->609, 616, 682
hippique_orchestrator/scripts/update_excel_with_results.py     183     29     66     16    82%   120, 127, 156, 191, 195, 204, 247, 253->255, 287, 293, 309, 315-319, 322, 338, 352->358, 386->390, 395-426
hippique_orchestrator/service.py                               204     23     36      1    88%   35-37, 136->139, 241-242, 357, 381-422
hippique_orchestrator/simulate_ev.py                           221     58     98     19    71%   19-20, 22, 34-35, 37, 41, 64, 76-77, 88-89, 102-103, 112-113, 122-123, 143, 162, 182, 186->188, 190-191, 198, 270, 272, 281, 297-326, 332->340, 336, 340->353, 348-349, 353->360, 357, 360->exit, 364
hippique_orchestrator/simulate_wrapper.py                      475     79    236     48    79%   109, 121, 129->132, 130->129, 154-158, 166, 172, 189, 191, 200, 202, 249, 262, 269, 285, 314, 316->311, 334-337, 339, 346->374, 349, 352->359, 357->359, 371->347, 385, 389, 403, 405, 409, 427, 447, 460-461, 483-502, 506->510, 507->506, 547, 578, 606-611, 626, 638-639, 659-665, 687, 691, 694, 697-699, 759-763, 788, 806, 809, 815->814, 831-837
hippique_orchestrator/snapshot_manager.py                       28      0      6      0   100%
hippique_orchestrator/stats_fetcher.py                          79      0     20      1    99%   78->90
hippique_orchestrator/stats_provider.py                        299     20    102     16    91%   153, 159, 166-167, 178, 190, 214-215, 239->235, 248-251, 254-256, 288-289, 312->310, 317->310, 328, 331->324, 389->387, 394-395, 401->387, 453->451, 458-459, 465->451
hippique_orchestrator/tickets_store.py                          67      0      6      1    99%   137->131
hippique_orchestrator/time_utils.py                             14      4      2      1    69%   15, 22, 35, 44
hippique_orchestrator/validator_ev.py                          319     32    142     13    88%   29, 39-41, 54-55, 384->388, 387, 404-405, 415-421, 430->439, 433, 448, 469, 479, 483, 516, 563-564, 580-587
hippique_orchestrator/zoneturf_client.py                       252     11    116     13    93%   48-49, 59, 111->124, 127->161, 134->157, 148->154, 174, 182-183, 205-207, 246->270, 251->256, 258->263, 265->270, 288, 324
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8373   1652   3264    480    77%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================ 1112 passed in 53.48s =============================
