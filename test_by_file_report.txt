EXECUTING: tests/test_guardrails.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 8 items

tests/test_guardrails.py::test_evaluate_guardrail_uses_multiple_paths PASSED [ 12%]
tests/test_guardrails.py::test_evaluate_guardrail_detects_low_values PASSED [ 25%]
tests/test_guardrails.py::test_load_json_raises_on_non_object PASSED     [ 37%]
tests/test_guardrails.py::test_extract_metric_returns_zero_when_missing PASSED [ 50%]
tests/test_guardrails.py::test_append_env_writes_to_file PASSED          [ 62%]
tests/test_guardrails.py::test_main_success_path PASSED                  [ 75%]
tests/test_guardrails.py::test_main_abstention_path_creates_report PASSED [ 87%]
tests/test_guardrails.py::test_main_file_not_found PASSED                [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39      0     14      0   100%
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7594   3248      5     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 8 passed in 11.77s ==============================
EXECUTING: tests/test_service.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 10 items

tests/test_service.py::test_get_pronostics_page 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:25 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 10%]
tests/test_service.py::test_get_pronostics_data_empty_case 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 20%]
tests/test_service.py::test_get_pronostics_data_with_data 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 30%]
tests/test_service.py::test_get_ops_status 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 40%]
tests/test_service.py::test_get_ops_status_reason_if_empty 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 50%]
tests/test_service.py::test_health_check 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 60%]
tests/test_service.py::test_legacy_redirects 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/api/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 70%]
tests/test_service.py::test_post_ops_run_success 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Manual run triggered for race R1C1 on 2026-01-01
2026-01-01 11:59:26 [INFO] Successfully processed and saved manual run for 2026-01-01_R1C1
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 200 OK"
PASSED                                                                   [ 80%]
tests/test_service.py::test_api_pronostics_schema 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-01 11:59:26 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-01 11:59:26 [INFO] Début du scraping du programme Boturfers.
2026-01-01 11:59:26 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-01 11:59:26 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-01 11:59:26 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-01 11:59:26 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 90%]
tests/test_service.py::test_ui_contains_critical_elements_and_api_call 
-------------------------------- live log call ---------------------------------
2026-01-01 11:59:26 [INFO] Request started
2026-01-01 11:59:26 [INFO] Request finished
2026-01-01 11:59:26 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     16      8      1    36%   27-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      5      2      0    61%   61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     34     24      4    49%   24-41, 46-62, 67-71, 79, 124-127, 136, 138
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22      4      0      0    82%   50-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     24     16      3    36%   36, 42, 51-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    160     80      4    17%   40, 53-54, 58-63, 67-104, 108-146, 150-165, 169-212, 216-260, 266-271, 281-289, 306-307, 316-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203     67     36      8    66%   35-37, 56, 87-88, 100->97, 128-129, 131-132, 136->139, 143->117, 191, 200-246, 253-254, 270, 275, 292-302, 316, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7490   3248     25     8%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================= 10 passed in 10.29s ==============================
EXECUTING: tests/test_no_vig_ev.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 2 items

tests/test_no_vig_ev.py::test_no_vig_sum_to_one PASSED                   [ 50%]
tests/test_no_vig_ev.py::test_ev_drops_when_margin_higher PASSED         [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7633   3248      5     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 2 passed in 9.19s ===============================
EXECUTING: tests/test_analysis_utils.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 18 items

tests/test_analysis_utils.py::test_normalise_text[None-] PASSED          [  5%]
tests/test_analysis_utils.py::test_normalise_text[  \xc9curie Sp\xe9ciale  -ecurie speciale] PASSED [ 11%]
tests/test_analysis_utils.py::test_normalise_text[  -] PASSED            [ 16%]
tests/test_analysis_utils.py::test_normalise_text[TROT-trot] PASSED      [ 22%]
tests/test_analysis_utils.py::test_normalise_text[handicap-handicap] PASSED [ 27%]
tests/test_analysis_utils.py::test_coerce_partants[14-14] PASSED         [ 33%]
tests/test_analysis_utils.py::test_coerce_partants[14.0-14] PASSED       [ 38%]
tests/test_analysis_utils.py::test_coerce_partants[14 partants-14] PASSED [ 44%]
tests/test_analysis_utils.py::test_coerce_partants[environ 14-14] PASSED [ 50%]
tests/test_analysis_utils.py::test_coerce_partants[None-None] PASSED     [ 55%]
tests/test_analysis_utils.py::test_coerce_partants[True-None] PASSED     [ 61%]
tests/test_analysis_utils.py::test_coerce_partants[N/A-None] PASSED      [ 66%]
tests/test_analysis_utils.py::test_coerce_partants[-5-None] PASSED       [ 72%]
tests/test_analysis_utils.py::test_compute_overround_cap_default PASSED  [ 77%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_handicap_large_field PASSED [ 83%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_large_field_from_label PASSED [ 88%]
tests/test_analysis_utils.py::test_compute_overround_cap_small_field_uses_default PASSED [ 94%]
tests/test_analysis_utils.py::test_compute_overround_cap_updates_context PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    105     82      3    37%   61-62, 68-69, 103->105, 107-108, 109->112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7591   3248      8     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 18 passed in 9.02s ==============================
EXECUTING: tests/test_p_finale_export.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 1 item

tests/test_p_finale_export.py::test_export_creates_csv_and_excel PASSED  [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     30     30     10    56%   15-17, 28-38, 44, 49-50, 69-70, 80->87, 81->80, 84->80, 88-89, 97-100, 103-104, 110, 123-125
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7583   3248     15     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 1 passed in 10.38s ==============================
EXECUTING: tests/test_roi_rebalancer.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 3 items

tests/test_roi_rebalancer.py::test_compute_allocation_plan_prioritises_high_ev PASSED [ 33%]
tests/test_roi_rebalancer.py::test_plan_serialisation_round_trip PASSED  [ 66%]
tests/test_roi_rebalancer.py::test_allocation_plan_requires_positive_bankroll PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7633   3248      5     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 3 passed in 9.19s ===============================
EXECUTING: tests/test_online_fetch_start_time.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 7 items

tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>14h05</td>-14:05] PASSED [ 14%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'> 9h30 </td>-09:30] PASSED [ 28%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>21:45</td>-21:45] PASSED [ 42%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>08:15</td>-08:15] PASSED [ 57%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>12h00</td>-12:00] PASSED [ 71%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>No time here</td>-None] PASSED [ 85%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td></td>-None] PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    143     80      8    28%   40, 49-63, 70, 74, 78, 99-104, 109, 114-118, 131-139, 143->141, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7592   3248     13     6%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 7 passed in 9.30s ===============================
EXECUTING: tests/test_validator_ev_extended.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 8 items

tests/test_validator_ev_extended.py::test_readme_has_roi_sp_success PASSED [ 12%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_match PASSED [ 25%]
tests/test_validator_ev_extended.py::test_must_have PASSED               [ 37%]
tests/test_validator_ev_extended.py::test_validate_missing_odds PASSED   [ 50%]
tests/test_validator_ev_extended.py::test_validate_invalid_odds PASSED   [ 62%]
tests/test_validator_ev_extended.py::test_validate_missing_je_stats PASSED [ 75%]
tests/test_validator_ev_extended.py::test_validate_budget_fails PASSED   [ 87%]
tests/test_validator_ev_extended.py::test_prepare_validation_inputs PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    177    140     23    37%   28-37, 43, 50-51, 70-76, 96-101, 128-143, 150, 152, 160, 170->168, 172, 217-249, 254-258, 268->267, 270, 283-285, 297-310, 355, 358, 371, 378-382, 386-400, 409-415, 420-429, 432, 440, 445, 449-453, 464-467, 477-478, 500, 506-507, 516-571, 575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7506   3248     28     7%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 8 passed in 9.33s ===============================
EXECUTING: tests/test_api_tasks.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 7 items

tests/test_api_tasks.py::test_snapshot_9h_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received snapshot-9h request for 2026-01-01 with URLs: [], RC Labels: []
2026-01-01 12:02:28 [INFO] Snapshot-9h completed successfully for 2026-01-01.
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_tasks.py::test_snapshot_9h_task_with_specific_date_and_urls 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received snapshot-9h request for 2025-10-26 with URLs: ['http://example.com/r1c1', 'http://example.com/r1c2'], RC Labels: []
2026-01-01 12:02:28 [INFO] Snapshot-9h completed successfully for 2025-10-26.
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 28%]
tests/test_api_tasks.py::test_run_phase_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Starting Firestore-native course analysis
2026-01-01 12:02:28 [INFO] Course analysis completed successfully.
2026-01-01 12:02:28 [INFO] Updating Firestore document
2026-01-01 12:02:28 [ERROR] Failed to update document None: 403 Cloud Firestore API has not been used in project test-project before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: "SERVICE_DISABLED"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "firestore.googleapis.com"
}
metadata {
  key: "serviceTitle"
  value: "Cloud Firestore API"
}
metadata {
  key: "containerInfo"
  value: "test-project"
}
metadata {
  key: "consumer"
  value: "projects/test-project"
}
metadata {
  key: "activationUrl"
  value: "https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project"
}
, locale: "en-US"
message: "Cloud Firestore API has not been used in project test-project before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry."
, links {
  description: "Google developers console API activation"
  url: "https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project"
}
]
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 38, in update_race_document
    doc_ref.set(data, merge=True)  # Use merge=True to be non-destructive
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/firestore_v1/document.py", line 167, in set
    write_results = batch.commit(**kwargs)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/firestore_v1/batch.py", line 59, in commit
    commit_response = self._client._firestore_api.commit(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/firestore_v1/services/firestore/client.py", line 1371, in commit
    response = rpc(
               ^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
                 ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
             ^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/google/api_core/grpc_helpers.py", line 78, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.PermissionDenied: 403 Cloud Firestore API has not been used in project test-project before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: "SERVICE_DISABLED"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "firestore.googleapis.com"
}
metadata {
  key: "serviceTitle"
  value: "Cloud Firestore API"
}
metadata {
  key: "containerInfo"
  value: "test-project"
}
metadata {
  key: "consumer"
  value: "projects/test-project"
}
metadata {
  key: "activationUrl"
  value: "https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project"
}
, locale: "en-US"
message: "Cloud Firestore API has not been used in project test-project before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry."
, links {
  description: "Google developers console API activation"
  url: "https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=test-project"
}
]
2026-01-01 12:02:28 [INFO] Run phase completed successfully for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 42%]
tests/test_api_tasks.py::test_run_phase_task_run_course_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Starting Firestore-native course analysis
2026-01-01 12:02:28 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: mock_error_from_analysis
2026-01-01 12:02:28 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 57%]
tests/test_api_tasks.py::test_run_phase_task_exception_handling 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Starting Firestore-native course analysis
2026-01-01 12:02:28 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: unexpected_error
2026-01-01 12:02:28 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 71%]
tests/test_api_tasks.py::test_bootstrap_day_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received request to bootstrap day 2026-01-01
2026-01-01 12:02:28 [INFO] Building daily plan for 2026-01-01...
2026-01-01 12:02:28 [INFO] Plan built: 2 races for 2026-01-01.
2026-01-01 12:02:28 [INFO] Bootstrap day completed. Scheduled 3 tasks.
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 200 OK"
PASSED                                                                   [ 85%]
tests/test_api_tasks.py::test_bootstrap_day_task_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-01 12:02:28 [INFO] Request started
2026-01-01 12:02:28 [INFO] Received request to bootstrap day 2026-01-01
2026-01-01 12:02:28 [INFO] Building daily plan for 2026-01-01...
2026-01-01 12:02:28 [WARNING] Empty plan for 2026-01-01. No tasks to schedule.
2026-01-01 12:02:28 [INFO] Request finished
2026-01-01 12:02:28 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 404 Not Found"
PASSED                                                                   [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74      9     10      1    88%   85-91, 134-140, 214->194, 242-248
hippique_orchestrator/auth.py                                   28     12      8      1    47%   24-33, 43, 59-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    446    208      0    10%   59-65, 71-76, 86-104, 110-114, 118-122, 131-149, 155-173, 179-181, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 315-355, 385-434, 446-457, 473-514, 532-545, 551-624, 635-689, 716-764, 818-994
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     48     24      2    26%   25-26, 39, 46-62, 70-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22      4      0      0    82%   50-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     10      6      2    66%   27-32, 50-52, 92-101
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7544   3248     11     7%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 7 passed in 9.92s ===============================
EXECUTING: tests/test_kelly_cap.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 4 items

tests/test_kelly_cap.py::test_kelly_cap_limits_stakes PASSED             [ 25%]
tests/test_kelly_cap.py::test_validate_budget_ok PASSED                  [ 50%]
tests/test_kelly_cap.py::test_validate_budget_total_exceeded PASSED      [ 75%]
tests/test_kelly_cap.py::test_validate_budget_horse_cap_exceeded PASSED  [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522    298    208     40    38%   59-65, 72, 74, 90, 96-104, 113, 118-122, 133, 137, 141-142, 147-148, 159, 162-172, 185-191, 195-204, 208-217, 225-239, 248-272, 276-304, 318-355, 385-434, 447, 449, 451, 455, 476-490, 494, 496, 498-499, 510, 540->543, 544, 608, 638-687, 731, 733, 735, 737, 739, 763, 827->830, 831, 833, 838->841, 869->877, 879-899, 904-925, 933-964, 989-992
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     15     18      8    58%   12, 14-15, 38, 40, 42, 48, 52, 59, 61, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    253    140      0    13%   28-37, 41-52, 70-76, 96-101, 106-108, 128-143, 147-172, 217-249, 254-258, 283-285, 297-310, 354-359, 363, 367-371, 375-382, 386-400, 404-433, 437-440, 444-453, 462-467, 475-479, 485-512, 516-571, 575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7413   3248     53     8%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================== 4 passed in 9.53s ===============================
EXECUTING: tests/test_ev_calculator.py
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 60.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 96 items

tests/test_ev_calculator.py::test_make_hashable_hashable_types PASSED    [  1%]
tests/test_ev_calculator.py::test_make_hashable_list PASSED              [  2%]
tests/test_ev_calculator.py::test_make_hashable_dict PASSED              [  3%]
tests/test_ev_calculator.py::test_make_hashable_nested_structures PASSED [  4%]
tests/test_ev_calculator.py::test_make_hashable_unhashable_fallback PASSED [  5%]
tests/test_ev_calculator.py::test_kelly_fraction_valid_inputs PASSED     [  6%]
tests/test_ev_calculator.py::test_kelly_fraction_probability_out_of_range PASSED [  7%]
tests/test_ev_calculator.py::test_kelly_fraction_odds_out_of_range PASSED [  8%]
tests/test_ev_calculator.py::test_apply_dutching_single_group PASSED     [  9%]
tests/test_ev_calculator.py::test_apply_dutching_multiple_groups PASSED  [ 10%]
tests/test_ev_calculator.py::test_apply_dutching_no_dutching_groups PASSED [ 11%]
tests/test_ev_calculator.py::test_apply_dutching_mixed_groups PASSED     [ 12%]
tests/test_ev_calculator.py::test_apply_dutching_invalid_odds_in_group PASSED [ 13%]
tests/test_ev_calculator.py::test_apply_dutching_single_valid_ticket_in_group PASSED [ 14%]
tests/test_ev_calculator.py::test_apply_dutching_group_too_small PASSED  [ 15%]
tests/test_ev_calculator.py::test_ticket_label_with_id PASSED            [ 16%]
tests/test_ev_calculator.py::test_ticket_label_with_name PASSED          [ 17%]
tests/test_ev_calculator.py::test_ticket_label_with_label PASSED         [ 18%]
tests/test_ev_calculator.py::test_ticket_label_with_selection PASSED     [ 19%]
tests/test_ev_calculator.py::test_ticket_label_with_runner PASSED        [ 20%]
tests/test_ev_calculator.py::test_ticket_label_no_label_keys_falls_back_to_index PASSED [ 21%]
tests/test_ev_calculator.py::test_ticket_label_empty_string_values_falls_back_to_index PASSED [ 22%]
tests/test_ev_calculator.py::test_clone_leg_dict PASSED                  [ 23%]
tests/test_ev_calculator.py::test_clone_leg_list_of_dicts PASSED         [ 25%]
tests/test_ev_calculator.py::test_clone_leg_primitive_type PASSED        [ 26%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_for_probability PASSED [ 27%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_details PASSED [ 28%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs PASSED [ 29%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_id_only PASSED [ 30%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_no_identifiable_legs PASSED [ 31%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_ticket_id PASSED [ 32%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_selection_id PASSED [ 33%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_leg_id_in_legs PASSED [ 34%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_mixed_dependencies PASSED [ 35%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_empty PASSED    [ 36%]
tests/test_ev_calculator.py::test_prepare_ticket_dependencies PASSED     [ 37%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_id_dependency PASSED [ 38%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_leg_dependency PASSED [ 39%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_no_specific_dependency PASSED [ 40%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_empty PASSED  [ 41%]
tests/test_ev_calculator.py::test_approx_joint_probability_independent PASSED [ 42%]
tests/test_ev_calculator.py::test_approx_joint_probability_positive_correlation PASSED [ 43%]
tests/test_ev_calculator.py::test_approx_joint_probability_negative_correlation PASSED [ 44%]
tests/test_ev_calculator.py::test_approx_joint_probability_rho_clipping PASSED [ 45%]
tests/test_ev_calculator.py::test_approx_joint_probability_lower_bound PASSED [ 46%]
tests/test_ev_calculator.py::test_merge_legs_no_duplicates PASSED        [ 47%]
tests/test_ev_calculator.py::test_merge_legs_with_duplicates PASSED      [ 48%]
tests/test_ev_calculator.py::test_merge_legs_with_dict_duplicates PASSED [ 50%]
tests/test_ev_calculator.py::test_merge_legs_empty_inputs PASSED         [ 51%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_simulate_fn PASSED [ 52%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_legs PASSED [ 53%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_no_cache PASSED [ 54%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_miss PASSED [ 55%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_hit PASSED [ 56%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_and_cache PASSED [ 57%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_no_cache PASSED [ 58%]
tests/test_ev_calculator.py::test_estimate_joint_probability_no_simulate_fn_uses_approx PASSED [ 59%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_copula_monte_carlo PASSED [ 60%]
tests/test_ev_calculator.py::test_covariance_from_joint_positive PASSED  [ 61%]
tests/test_ev_calculator.py::test_covariance_from_joint_negative PASSED  [ 62%]
tests/test_ev_calculator.py::test_covariance_from_joint_zero_probability PASSED [ 63%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_tickets PASSED [ 64%]
tests/test_ev_calculator.py::test_compute_joint_moments_fewer_than_min_tickets PASSED [ 65%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_shared_exposures PASSED [ 66%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_positive_covariance PASSED [ 67%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_negative_covariance PASSED [ 68%]
tests/test_ev_calculator.py::test_compute_joint_moments_covariance_below_threshold PASSED [ 69%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-None-0.0] PASSED [ 70%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.0-0.01-100-None-1.0] PASSED [ 71%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.0-100-None-0.0] PASSED [ 72%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.02-0.0] PASSED [ 73%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.005-0.0] PASSED [ 75%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.01-0.01-1-None-0.1353352832366127] PASSED [ 76%]
tests/test_ev_calculator.py::test_risk_of_ruin_invalid_bankroll PASSED   [ 77%]
tests/test_ev_calculator.py::test_risk_of_ruin_respects_baseline_variance PASSED [ 78%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_with_scipy PASSED [ 79%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_without_scipy_fallback_to_grid_search PASSED [ 80%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_empty_tickets PASSED [ 81%]
tests/test_ev_calculator.py::test_process_single_ticket_p_provided PASSED [ 82%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p PASSED [ 83%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p_cached PASSED [ 84%]
tests/test_ev_calculator.py::test_process_single_ticket_no_p_or_legs_raises_value_error PASSED [ 85%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_p_raises_value_error PASSED [ 86%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_odds_raises_value_error PASSED [ 87%]
tests/test_ev_calculator.py::test_process_single_ticket_stake_capping_and_rounding PASSED [ 88%]
tests/test_ev_calculator.py::test_process_tickets_basic_functionality PASSED [ 89%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_single_ticket PASSED [ 90%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_with_combined_ticket PASSED [ 91%]
tests/test_ev_calculator.py::test_calculate_final_metrics_green_flag PASSED [ 92%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ev_ratio PASSED [ 93%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ror PASSED [ 94%]
tests/test_ev_calculator.py::test_compute_ev_roi_basic_functionality PASSED [ 95%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_budget PASSED   [ 96%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_variance_cap_config PASSED [ 97%]
tests/test_ev_calculator.py::test_compute_ev_roi_with_optimize_true PASSED [ 98%]
tests/test_ev_calculator.py::test_compute_ev_roi_variance_capping PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97     80     14      0    15%   26-50, 61-93, 99-105, 112-132, 142-221
hippique_orchestrator/analysis_utils.py                        181    147     82      0    13%   44-48, 53-70, 83-112, 121-188, 207-252, 269-287, 295-327, 336-357, 366-391
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74     53     10      0    25%   39-91, 106-140, 154-248
hippique_orchestrator/auth.py                                   28     18      8      0    28%   24-33, 42-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      7      2      0    50%   37-42, 61-69
hippique_orchestrator/ev_calculator.py                         522     47    208     16    89%   164->171, 171->161, 291, 340, 417, 479, 484-485, 498-499, 540->543, 635-689, 731, 735, 737, 839, 897, 923, 957-962
hippique_orchestrator/fetch_je_stats.py                        259    204     66      1    17%   56-69, 73, 86-93, 98-100, 108-140, 144-163, 172-197, 201-208, 214-237, 255-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71     58     24      0    14%   24-41, 46-62, 67-71, 78-140
hippique_orchestrator/gcs_client.py                             71     46     14      0    29%   32-38, 43-45, 50, 55-57, 69, 81, 91-98, 107-114, 122-126, 133-137, 144-148
hippique_orchestrator/gcs_utils.py                              52     52     10      0     0%   3-90
hippique_orchestrator/kelly.py                                  42     36     18      0    10%   9-15, 31-62, 71-75
hippique_orchestrator/logging_io.py                             39     39     10      0     0%   1-79
hippique_orchestrator/logging_middleware.py                     22     16      0      0    27%   15-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353    320    142      0     7%   38, 43-46, 62-133, 143-182, 192-246, 257-288, 293-299, 309-337, 343-417, 422-441, 450-535, 540-548, 558-632, 640-667, 680-737
hippique_orchestrator/plan.py                                   42     32     16      0    17%   35-86, 98-108
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     27      6      0    20%   21-32, 46-118
hippique_orchestrator/scheduler.py                             101     86     28      0    12%   28-52, 69-140, 146-248
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206    184     80      0     8%   39-45, 49-63, 67-104, 108-146, 150-165, 169-212, 216-260, 264-271, 281-289, 303-329, 336-367
hippique_orchestrator/scrapers/geny.py                          61     61     14      0     0%   5-117
hippique_orchestrator/scrapers/zeturf.py                        26     18      6      0    25%   14-15, 24-51
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39     39     14      0     0%   4-78
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    951    574      1     6%   36-47, 53-62, 70, 82-137, 151-159, 167-179, 187-216, 220-237, 245-291, 314-343, 349-352, 359-454, 467-485, 496-515, 526-603, 609-622, 635-681, 702-717, 721-724, 728-734, 740-746, 774-802, 808-818, 822-829, 835-840, 846-985, 996-1175, 1179-1195, 1206-1229, 1237-1430, 1442-1586, 1599-1660, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     80     30      0     0%   4-142
hippique_orchestrator/scripts/resolve_course_id.py             141    141     64      0     0%   3-259
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424    424    226      0     0%   3-689
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203    138     36      0    27%   35-37, 56, 62, 68, 74, 84-193, 200-246, 251-257, 263-302, 316, 333, 339-348, 356, 380-421
hippique_orchestrator/simulate_ev.py                           221    221     98      0     0%   3-364
hippique_orchestrator/simulate_wrapper.py                      475    418    236      0     8%   54-60, 104-110, 116-122, 128-132, 138-139, 152-158, 165-174, 178-181, 185-192, 196-203, 209-276, 282-294, 298-299, 305-322, 330-375, 381-389, 401-435, 444-464, 470-519, 525-579, 598-679, 685-699, 735-839
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    299    102      0     0%   8-487
hippique_orchestrator/tickets_store.py                          67     67      6      0     0%   2-161
hippique_orchestrator/time_utils.py                             14      7      2      0    44%   15, 22, 30-36, 44
hippique_orchestrator/validator_ev.py                          304    304    140      0     0%   3-575
hippique_orchestrator/zoneturf_client.py                       252    252    116      0     0%   2-352
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8315   7234   3248     21    11%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================= 96 passed in 10.51s ==============================
EXECUTING: tests/test_stats_provider.py
