Traceback (most recent call last):
  File "/home/francoisosmozis/.local/bin/uvicorn", line 7, in <module>
    sys.exit(main())
             ^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/click/core.py", line 1442, in __call__
    return self.main(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/click/core.py", line 1363, in main
    rv = self.invoke(ctx)
         ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/click/core.py", line 1226, in invoke
    return ctx.invoke(self.callback, **ctx.params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/click/core.py", line 794, in invoke
    return callback(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/main.py", line 412, in main
    run(
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/main.py", line 579, in run
    server.run()
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/server.py", line 69, in serve
    await self._serve(sockets)
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/server.py", line 76, in _serve
    config.load()
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/config.py", line 434, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/.local/lib/python3.12/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/francoisosmozis/hippique-orchestrator/src/service.py", line 27, in <module>
    from src.scheduler import schedule_all_races
  File "/home/francoisosmozis/hippique-orchestrator/src/scheduler.py", line 27, in <module>
    config = get_config() # Get the global config instance
             ^^^^^^^^^^^^
  File "/home/francoisosmozis/hippique-orchestrator/app_config.py", line 95, in get_config
    _config = AppConfig.from_env()
              ^^^^^^^^^^^^^^^^^^^^
  File "/home/francoisosmozis/hippique-orchestrator/app_config.py", line 65, in from_env
    raise ValueError("CLOUD_TASKS_SA_EMAIL environment variable is required in non-test environments.")
ValueError: CLOUD_TASKS_SA_EMAIL environment variable is required in non-test environments.
2025-11-24 12:50:43,333 - WARNING - Test environment detected: using a dummy CLOUD_TASKS_SA_EMAIL.
INFO:     Started server process [11766]
INFO:     Waiting for application startup.
{"severity": "INFO", "message": "Service starting", "timestamp": "2025-11-24T11:50:43.619462Z", "logger": "src.service", "version": "2.0.0", "project_id": "local-project", "region": "local-region", "environment": "local"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
{"severity": "INFO", "message": "POST /schedule", "timestamp": "2025-11-24T11:51:08.979635Z", "logger": "src.service", "correlation_id": "3a3e6069-8076-4f6c-b4d8-2d67f37cbb70", "method": "POST", "path": "/schedule", "client": "127.0.0.1"}
DEBUG: Type of config: <class 'app_config.AppConfig'>
DEBUG: Attributes of config: ['__annotations__', '__class__', '__dataclass_fields__', '__dataclass_params__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__match_args__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'cloud_tasks_queue', 'cloud_tasks_sa_email', 'environment', 'from_env', 'h30_offset', 'h5_offset', 'log_level', 'payout_calibration_path', 'project_id', 'queue_path', 'region', 'require_auth', 'service_url']
INFO:     127.0.0.1:51084 - "POST /schedule HTTP/1.1" 422 Unprocessable Entity
{"severity": "INFO", "message": "POST /schedule", "timestamp": "2025-11-24T11:51:17.230942Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f", "method": "POST", "path": "/schedule", "client": "127.0.0.1"}
{"severity": "INFO", "message": "Schedule request received", "timestamp": "2025-11-24T11:51:17.231977Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f", "date": "2025-11-24", "mode": "tasks"}
{"severity": "INFO", "message": "Building daily plan...", "timestamp": "2025-11-24T11:51:17.232063Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f"}
{"severity": "INFO", "message": "Building plan for 2025-11-24", "timestamp": "2025-11-24T11:51:17.232103Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Discovered 3 meetings from Geny", "timestamp": "2025-11-24T11:51:18.177591Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Geny data received: {\n  \"date\": \"2025-11-24\",\n  \"meetings\": [\n    {\n      \"r\": \"R1\",\n      \"hippo\": \"Nantes\",\n      \"slug\": \"nantes\",\n      \"courses\": [\n        {\n          \"c\": \"C3\",\n          \"id_course\": \"1617722\"\n        }\n      ]\n    },\n    {\n      \"r\": \"R2\",\n      \"hippo\": \"Agen-Le Passage\",\n      \"slug\": \"agen-le-passage\",\n      \"courses\": [\n        {\n          \"c\": \"C1\",\n          \"id_course\": \"1617727\"\n        }\n      ]\n    },\n    {\n      \"r\": \"R3\",\n      \"hippo\": \"Casablanca\",\n      \"slug\": \"casablanca\",\n      \"courses\": [\n        {\n          \"c\": \"C5\",\n          \"id_course\": \"1617796\"\n        }\n      ]\n    }\n  ]\n}", "timestamp": "2025-11-24T11:51:18.177841Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Built 3 races from Geny. Plan: [\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R1\",\n    \"c_label\": \"C3\",\n    \"course_id\": \"1617722\",\n    \"meeting\": \"Nantes\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  },\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R2\",\n    \"c_label\": \"C1\",\n    \"course_id\": \"1617727\",\n    \"meeting\": \"Agen-Le Passage\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  },\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R3\",\n    \"c_label\": \"C5\",\n    \"course_id\": \"1617796\",\n    \"meeting\": \"Casablanca\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  }\n]", "timestamp": "2025-11-24T11:51:18.177972Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Fetching programme from Boturfers to enrich plan.", "timestamp": "2025-11-24T11:51:18.178018Z", "logger": "src.plan"}
2025-11-24 12:51:18,178 - INFO - Début du scraping du programme Boturfers pour l'URL: https://www.boturfers.fr/programme-pmu-du-jour
2025-11-24 12:51:18,728 - INFO - Scraping du programme Boturfers réussi pour https://www.boturfers.fr/programme-pmu-du-jour. 49 courses trouvées.
{"severity": "INFO", "message": "Boturfers programme data received: {\n  \"source\": \"boturfers\",\n  \"type\": \"programme\",\n  \"url\": \"https://www.boturfers.fr/programme-pmu-du-jour\",\n  \"scraped_at\": \"2025-11-24T11:51:18.728284\",\n  \"races\": [\n    {\n      \"rc\": \"R1 C1\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Brassac Les Mines\",\n      \"url\": \"https://www.boturfers.fr/quinte-du-jour\",\n      \"runners_count\": 16,\n      \"start_time\": \"13:55\"\n    },\n    {\n      \"rc\": \"R1 C2\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Landivisiau\",\n      \"url\": \"https://www.boturfers.fr/course/1086101-r1c2-prix-de-landivisiau\",\n      \"runners_count\": 10,\n      \"start_time\": \"14:30\"\n    },\n    {\n      \"rc\": \"R1 C3\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix D'Hossegor\",\n      \"url\": \"https://www.boturfers.fr/course/1086104-r1c3-prix-d-hossegor\",\n      \"runners_count\": 14,\n      \"start_time\": \"15:05\"\n    },\n    {\n      \"rc\": \"R1 C4\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Santigny\",\n      \"url\": \"https://www.boturfers.fr/course/1086107-r1c4-prix-de-santigny\",\n      \"runners_count\": 10,\n      \"start_time\": \"15:40\"\n    },\n    {\n      \"rc\": \"R1 C5\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Meslay Du Maine\",\n      \"url\": \"https://www.boturfers.fr/course/1086110-r1c5-prix-de-meslay-du-maine\",\n      \"runners_count\": 12,\n      \"start_time\": \"16:15\"\n    },\n    {\n      \"rc\": \"R1 C6\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Bethune\",\n      \"url\": \"https://www.boturfers.fr/course/1086113-r1c6-prix-de-bethune\",\n      \"runners_count\": 16,\n      \"start_time\": \"16:50\"\n    },\n    {\n      \"rc\": \"R1 C7\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix D'Hennebont\",\n      \"url\": \"https://www.boturfers.fr/course/1086116-r1c7-prix-d-hennebont\",\n      \"runners_count\": 14,\n      \"start_time\": \"17:25\"\n    },\n    {\n      \"rc\": \"R1 C8\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Cerisy\",\n      \"url\": \"https://www.boturfers.fr/course/1086119-r1c8-prix-de-cerisy\",\n      \"runners_count\": 12,\n      \"start_time\": \"18:00\"\n    },\n    {\n      \"rc\": \"R3 C1\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Regis Bertin (prix Doux Pretender)\",\n      \"url\": \"https://www.boturfers.fr/course/1086077-r3c1-prix-regis-bertin-prix-doux-pretender\",\n      \"runners_count\": 7,\n      \"start_time\": \"11:51\"\n    },\n    {\n      \"rc\": \"R3 C2\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Julien Brossais - Challenge De L'Obstacle Equinaxy\",\n      \"url\": \"https://www.boturfers.fr/course/1086080-r3c2-prix-julien-brossais-challenge-de-l-obstacle-equinaxy\",\n      \"runners_count\": 8,\n      \"start_time\": \"12:23\"\n    },\n    {\n      \"rc\": \"R3 C3\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Roger Chaignon\",\n      \"url\": \"https://www.boturfers.fr/course/1086083-r3c3-prix-roger-chaignon\",\n      \"runners_count\": 9,\n      \"start_time\": \"12:55\"\n    },\n    {\n      \"rc\": \"R3 C4\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix De Saint-Malo\",\n      \"url\": \"https://www.boturfers.fr/course/1086086-r3c4-prix-de-saint-malo\",\n      \"runners_count\": 15,\n      \"start_time\": \"13:27\"\n    },\n    {\n      \"rc\": \"R3 C5\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Des Parieurs Pmu+\",\n      \"url\": \"https://www.boturfers.fr/course/1086089-r3c5-prix-des-parieurs-pmu\",\n      \"runners_count\": 14,\n      \"start_time\": \"14:12\"\n    },\n    {\n      \"rc\": \"R3 C6\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Duralock\",\n      \"url\": \"https://www.boturfers.fr/course/1086092-r3c6-prix-duralock\",\n      \"runners_count\": 14,\n      \"start_time\": \"14:47\"\n    },\n    {\n      \"rc\": \"R3 C7\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix President Herve De La Brosse\",\n      \"url\": \"https://www.boturfers.fr/course/1086095-r3c7-prix-president-herve-de-la-brosse\",\n      \"runners_count\": 11,\n      \"start_time\": \"15:22\"\n    },\n    {\n      \"rc\": \"R4 C1\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Fontvieille\",\n      \"url\": \"https://www.boturfers.fr/course/1086053-r4c1-prix-de-fontvieille\",\n      \"runners_count\": 10,\n      \"start_time\": \"15:57\"\n    },\n    {\n      \"rc\": \"R4 C2\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Carpiagne\",\n      \"url\": \"https://www.boturfers.fr/course/1086056-r4c2-prix-de-carpiagne\",\n      \"runners_count\": 8,\n      \"start_time\": \"16:32\"\n    },\n    {\n      \"rc\": \"R4 C3\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Saint-Charles\",\n      \"url\": \"https://www.boturfers.fr/course/1086059-r4c3-prix-de-saint-charles\",\n      \"runners_count\": 9,\n      \"start_time\": \"17:07\"\n    },\n    {\n      \"rc\": \"R4 C4\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Lucien Planard\",\n      \"url\": \"https://www.boturfers.fr/course/1086062-r4c4-prix-lucien-planard\",\n      \"runners_count\": 9,\n      \"start_time\": \"17:42\"\n    },\n    {\n      \"rc\": \"R4 C5\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Ailes\",\n      \"url\": \"https://www.boturfers.fr/course/1086065-r4c5-prix-des-ailes\",\n      \"runners_count\": 13,\n      \"start_time\": \"18:20\"\n    },\n    {\n      \"rc\": \"R4 C6\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Roses\",\n      \"url\": \"https://www.boturfers.fr/course/1086068-r4c6-prix-des-roses\",\n      \"runners_count\": 12,\n      \"start_time\": \"18:55\"\n    },\n    {\n      \"rc\": \"R4 C7\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Tulipes\",\n      \"url\": \"https://www.boturfers.fr/course/1086071-r4c7-prix-des-tulipes\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:27\"\n    },\n    {\n      \"rc\": \"R4 C8\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Calanques\",\n      \"url\": \"https://www.boturfers.fr/course/1086074-r4c8-prix-des-calanques\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:59\"\n    },\n    {\n      \"rc\": \"R5 C1\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Du Pmu\",\n      \"url\": \"https://www.boturfers.fr/course/1086122-r5c1-prix-du-pmu\",\n      \"runners_count\": 14,\n      \"start_time\": \"18:38\"\n    },\n    {\n      \"rc\": \"R5 C2\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Captain Sparrow\",\n      \"url\": \"https://www.boturfers.fr/course/1086125-r5c2-prix-captain-sparrow\",\n      \"runners_count\": 13,\n      \"start_time\": \"19:11\"\n    },\n    {\n      \"rc\": \"R5 C3\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Rolling, Gu Et Un Mec D'Heripre\",\n      \"url\": \"https://www.boturfers.fr/course/1086128-r5c3-prix-rolling-gu-et-un-mec-d-heripre\",\n      \"runners_count\": 16,\n      \"start_time\": \"19:43\"\n    },\n    {\n      \"rc\": \"R5 C4\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Justin Bold\",\n      \"url\": \"https://www.boturfers.fr/course/1086131-r5c4-prix-justin-bold\",\n      \"runners_count\": 13,\n      \"start_time\": \"20:15\"\n    },\n    {\n      \"rc\": \"R5 C5\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Balando\",\n      \"url\": \"https://www.boturfers.fr/course/1086134-r5c5-prix-balando\",\n      \"runners_count\": 10,\n      \"start_time\": \"20:42\"\n    },\n    {\n      \"rc\": \"R5 C6\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix 3id Nord Groupe Resilians\",\n      \"url\": \"https://www.boturfers.fr/course/1086137-r5c6-prix-3id-nord-groupe-resilians\",\n      \"runners_count\": 9,\n      \"start_time\": \"21:09\"\n    },\n    {\n      \"rc\": \"R5 C7\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Des Amateurs\",\n      \"url\": \"https://www.boturfers.fr/course/1086140-r5c7-prix-des-amateurs\",\n      \"runners_count\": 16,\n      \"start_time\": \"21:36\"\n    },\n    {\n      \"rc\": \"R6 C1\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Bristol\",\n      \"url\": \"https://www.boturfers.fr/course/1086399-r6c1-prix-bristol\",\n      \"runners_count\": 10,\n      \"start_time\": \"19:00\"\n    },\n    {\n      \"rc\": \"R6 C2\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Sheffield\",\n      \"url\": \"https://www.boturfers.fr/course/1086402-r6c2-prix-sheffield\",\n      \"runners_count\": 9,\n      \"start_time\": \"19:28\"\n    },\n    {\n      \"rc\": \"R6 C3\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Cardiff\",\n      \"url\": \"https://www.boturfers.fr/course/1086405-r6c3-prix-cardiff\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:56\"\n    },\n    {\n      \"rc\": \"R6 C4\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Belfast\",\n      \"url\": \"https://www.boturfers.fr/course/1086408-r6c4-prix-belfast\",\n      \"runners_count\": 10,\n      \"start_time\": \"20:25\"\n    },\n    {\n      \"rc\": \"R6 C5\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Glasgow\",\n      \"url\": \"https://www.boturfers.fr/course/1086411-r6c5-prix-glasgow\",\n      \"runners_count\": 9,\n      \"start_time\": \"20:55\"\n    },\n    {\n      \"rc\": \"R6 C6\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Gran Bretana\",\n      \"url\": \"https://www.boturfers.fr/course/1086414-r6c6-prix-gran-bretana\",\n      \"runners_count\": 8,\n      \"start_time\": \"21:25\"\n    },\n    {\n      \"rc\": \"R6 C7\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Edimburgo\",\n      \"url\": \"https://www.boturfers.fr/course/1086417-r6c7-prix-edimburgo\",\n      \"runners_count\": 10,\n      \"start_time\": \"21:55\"\n    },\n    {\n      \"rc\": \"R6 C8\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Londres\",\n      \"url\": \"https://www.boturfers.fr/course/1086420-r6c8-prix-londres\",\n      \"runners_count\": 9,\n      \"start_time\": \"22:25\"\n    },\n    {\n      \"rc\": \"R6 C9\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Birmingham\",\n      \"url\": \"https://www.boturfers.fr/course/1086423-r6c9-prix-birmingham\",\n      \"runners_count\": 9,\n      \"start_time\": \"22:55\"\n    },\n    {\n      \"rc\": \"R6 C10\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Liverpool\",\n      \"url\": \"https://www.boturfers.fr/course/1086426-r6c10-prix-liverpool\",\n      \"runners_count\": 11,\n      \"start_time\": \"23:25\"\n    },\n    {\n      \"rc\": \"R6 C11\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Leeds\",\n      \"url\": \"https://www.boturfers.fr/course/1086429-r6c11-prix-leeds\",\n      \"runners_count\": 10,\n      \"start_time\": \"23:55\"\n    },\n    {\n      \"rc\": \"R6 C12\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Manchester\",\n      \"url\": \"https://www.boturfers.fr/course/1086432-r6c12-prix-manchester\",\n      \"runners_count\": 14,\n      \"start_time\": \"00:25\"\n    },\n    {\n      \"rc\": \"R9 C1\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Hubert Sarrazin\",\n      \"url\": \"https://www.boturfers.fr/course/1085939-r9c1-prix-hubert-sarrazin\",\n      \"runners_count\": 13,\n      \"start_time\": \"10:30\"\n    },\n    {\n      \"rc\": \"R9 C2\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Sault\",\n      \"url\": \"https://www.boturfers.fr/course/1085942-r9c2-prix-de-sault\",\n      \"runners_count\": 14,\n      \"start_time\": \"11:00\"\n    },\n    {\n      \"rc\": \"R9 C3\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Des Jouvenceaux\",\n      \"url\": \"https://www.boturfers.fr/course/1085945-r9c3-prix-des-jouvenceaux\",\n      \"runners_count\": 12,\n      \"start_time\": \"11:30\"\n    },\n    {\n      \"rc\": \"R9 C4\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De La Metropole\",\n      \"url\": \"https://www.boturfers.fr/course/1085948-r9c4-prix-de-la-metropole\",\n      \"runners_count\": 14,\n      \"start_time\": \"12:00\"\n    },\n    {\n      \"rc\": \"R9 C5\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Bel Air\",\n      \"url\": \"https://www.boturfers.fr/course/1085951-r9c5-prix-de-bel-air\",\n      \"runners_count\": 18,\n      \"start_time\": \"12:30\"\n    },\n    {\n      \"rc\": \"R9 C6\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Cavaillon\",\n      \"url\": \"https://www.boturfers.fr/course/1085954-r9c6-prix-de-cavaillon\",\n      \"runners_count\": 8,\n      \"start_time\": \"13:00\"\n    },\n    {\n      \"rc\": \"R9 C7\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Philippe Millan\",\n      \"url\": \"https://www.boturfers.fr/course/1085957-r9c7-prix-philippe-millan\",\n      \"runners_count\": 11,\n      \"start_time\": \"13:30\"\n    }\n  ]\n}", "timestamp": "2025-11-24T11:51:18.729443Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Boturfers races map keys: ['R1C1', 'R1C2', 'R1C3', 'R1C4', 'R1C5', 'R1C6', 'R1C7', 'R1C8', 'R3C1', 'R3C2', 'R3C3', 'R3C4', 'R3C5', 'R3C6', 'R3C7', 'R4C1', 'R4C2', 'R4C3', 'R4C4', 'R4C5', 'R4C6', 'R4C7', 'R4C8', 'R5C1', 'R5C2', 'R5C3', 'R5C4', 'R5C5', 'R5C6', 'R5C7', 'R6C1', 'R6C2', 'R6C3', 'R6C4', 'R6C5', 'R6C6', 'R6C7', 'R6C8', 'R6C9', 'R6C10', 'R6C11', 'R6C12', 'R9C1', 'R9C2', 'R9C3', 'R9C4', 'R9C5', 'R9C6', 'R9C7']", "timestamp": "2025-11-24T11:51:18.729728Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R1C3", "timestamp": "2025-11-24T11:51:18.729772Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Enriched R1C3 with time 15:05 and URL https://www.boturfers.fr/course/1086104-r1c3-prix-d-hossegor from Boturfers.", "timestamp": "2025-11-24T11:51:18.729804Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R2C1", "timestamp": "2025-11-24T11:51:18.729832Z", "logger": "src.plan"}
{"severity": "WARNING", "message": "No matching Boturfers race found for Geny race R2C1, skipping.", "timestamp": "2025-11-24T11:51:18.729858Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R3C5", "timestamp": "2025-11-24T11:51:18.729884Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Enriched R3C5 with time 14:12 and URL https://www.boturfers.fr/course/1086089-r3c5-prix-des-parieurs-pmu from Boturfers.", "timestamp": "2025-11-24T11:51:18.729910Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Successfully enriched 2/3 races from Boturfers.", "timestamp": "2025-11-24T11:51:18.729938Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Plan complete: 2 races with times", "timestamp": "2025-11-24T11:51:18.729971Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Plan built: 2 races", "timestamp": "2025-11-24T11:51:18.730009Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f", "total_races": 2}
{"severity": "INFO", "message": "Scheduling Cloud Tasks...", "timestamp": "2025-11-24T11:51:18.730041Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f"}
{"severity": "INFO", "message": "Cloud Tasks parent path components: project_id=local-project, region=local-region, queue_id=hippique-analysis-queue", "timestamp": "2025-11-24T11:51:18.734164Z", "logger": "src.scheduler"}
{"severity": "ERROR", "message": "Schedule failed: File credentials.json was not found.", "timestamp": "2025-11-24T11:51:18.835307Z", "logger": "src.service", "correlation_id": "b9cc484b-4675-4f07-af29-dc78b99a498f", "traceback": "Traceback (most recent call last):\n  File \"/home/francoisosmozis/hippique-orchestrator/src/service.py\", line 293, in schedule_daily_plan\n    scheduled = schedule_all_races(\n                ^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 277, in schedule_all_races\n    task_h30 = enqueue_run_task(\n               ^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 152, in enqueue_run_task\n    client = get_tasks_client()\n             ^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 41, in get_tasks_client\n    _tasks_client = tasks_v2.CloudTasksClient()\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/client.py\", line 470, in __init__\n    self._transport = Transport(\n                      ^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/transports/grpc.py\", line 157, in __init__\n    super().__init__(\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/transports/base.py\", line 105, in __init__\n    credentials, _ = google.auth.default(\n                     ^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 705, in default\n    credentials, project_id = checker()\n                              ^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 698, in <lambda>\n    lambda: _get_explicit_environ_credentials(quota_project_id=quota_project_id),\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 346, in _get_explicit_environ_credentials\n    credentials, project_id = load_credentials_from_file(\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 173, in load_credentials_from_file\n    raise exceptions.DefaultCredentialsError(\ngoogle.auth.exceptions.DefaultCredentialsError: File credentials.json was not found.\n"}
INFO:     127.0.0.1:41430 - "POST /schedule HTTP/1.1" 500 Internal Server Error
INFO:     Shutting down
INFO:     Waiting for application shutdown.
{"severity": "INFO", "message": "Service shutting down", "timestamp": "2025-11-24T12:01:47.003533Z", "logger": "src.service"}
INFO:     Application shutdown complete.
INFO:     Finished server process [11766]
2025-11-24 13:01:56,667 - WARNING - Test environment detected: using a dummy CLOUD_TASKS_SA_EMAIL.
INFO:     Started server process [15520]
INFO:     Waiting for application startup.
{"severity": "INFO", "message": "Service starting", "timestamp": "2025-11-24T12:01:56.905955Z", "logger": "src.service", "version": "2.0.0", "project_id": "local-project", "region": "local-region", "environment": "local"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
{"severity": "INFO", "message": "POST /schedule", "timestamp": "2025-11-24T12:02:12.696160Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912", "method": "POST", "path": "/schedule", "client": "127.0.0.1"}
{"severity": "INFO", "message": "Schedule request received", "timestamp": "2025-11-24T12:02:12.699318Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912", "date": "2025-11-24", "mode": "tasks"}
{"severity": "INFO", "message": "Building daily plan...", "timestamp": "2025-11-24T12:02:12.699438Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912"}
{"severity": "INFO", "message": "Building plan for 2025-11-24", "timestamp": "2025-11-24T12:02:12.699502Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Discovered 3 meetings from Geny", "timestamp": "2025-11-24T12:02:13.860039Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Geny data received: {\n  \"date\": \"2025-11-24\",\n  \"meetings\": [\n    {\n      \"r\": \"R1\",\n      \"hippo\": \"Agen-Le Passage\",\n      \"slug\": \"agen-le-passage\",\n      \"courses\": [\n        {\n          \"c\": \"C1\",\n          \"id_course\": \"1617727\"\n        }\n      ]\n    },\n    {\n      \"r\": \"R2\",\n      \"hippo\": \"Casablanca\",\n      \"slug\": \"casablanca\",\n      \"courses\": [\n        {\n          \"c\": \"C5\",\n          \"id_course\": \"1617796\"\n        }\n      ]\n    },\n    {\n      \"r\": \"R3\",\n      \"hippo\": \"Nantes\",\n      \"slug\": \"nantes\",\n      \"courses\": [\n        {\n          \"c\": \"C4\",\n          \"id_course\": \"1617723\"\n        }\n      ]\n    }\n  ]\n}", "timestamp": "2025-11-24T12:02:13.860359Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Built 3 races from Geny. Plan: [\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R1\",\n    \"c_label\": \"C1\",\n    \"course_id\": \"1617727\",\n    \"meeting\": \"Agen-Le Passage\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  },\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R2\",\n    \"c_label\": \"C5\",\n    \"course_id\": \"1617796\",\n    \"meeting\": \"Casablanca\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  },\n  {\n    \"date\": \"2025-11-24\",\n    \"r_label\": \"R3\",\n    \"c_label\": \"C4\",\n    \"course_id\": \"1617723\",\n    \"meeting\": \"Nantes\",\n    \"course_url\": null,\n    \"reunion_url\": null\n  }\n]", "timestamp": "2025-11-24T12:02:13.860901Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Fetching programme from Boturfers to enrich plan.", "timestamp": "2025-11-24T12:02:13.860978Z", "logger": "src.plan"}
2025-11-24 13:02:13,865 - INFO - Début du scraping du programme Boturfers pour l'URL: https://www.boturfers.fr/programme-pmu-du-jour
2025-11-24 13:02:14,728 - INFO - Scraping du programme Boturfers réussi pour https://www.boturfers.fr/programme-pmu-du-jour. 49 courses trouvées.
{"severity": "INFO", "message": "Boturfers programme data received: {\n  \"source\": \"boturfers\",\n  \"type\": \"programme\",\n  \"url\": \"https://www.boturfers.fr/programme-pmu-du-jour\",\n  \"scraped_at\": \"2025-11-24T12:02:14.728862\",\n  \"races\": [\n    {\n      \"rc\": \"R1 C1\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Brassac Les Mines\",\n      \"url\": \"https://www.boturfers.fr/quinte-du-jour\",\n      \"runners_count\": 16,\n      \"start_time\": \"13:55\"\n    },\n    {\n      \"rc\": \"R1 C2\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Landivisiau\",\n      \"url\": \"https://www.boturfers.fr/course/1086101-r1c2-prix-de-landivisiau\",\n      \"runners_count\": 10,\n      \"start_time\": \"14:30\"\n    },\n    {\n      \"rc\": \"R1 C3\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix D'Hossegor\",\n      \"url\": \"https://www.boturfers.fr/course/1086104-r1c3-prix-d-hossegor\",\n      \"runners_count\": 14,\n      \"start_time\": \"15:05\"\n    },\n    {\n      \"rc\": \"R1 C4\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Santigny\",\n      \"url\": \"https://www.boturfers.fr/course/1086107-r1c4-prix-de-santigny\",\n      \"runners_count\": 10,\n      \"start_time\": \"15:40\"\n    },\n    {\n      \"rc\": \"R1 C5\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Meslay Du Maine\",\n      \"url\": \"https://www.boturfers.fr/course/1086110-r1c5-prix-de-meslay-du-maine\",\n      \"runners_count\": 12,\n      \"start_time\": \"16:15\"\n    },\n    {\n      \"rc\": \"R1 C6\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Bethune\",\n      \"url\": \"https://www.boturfers.fr/course/1086113-r1c6-prix-de-bethune\",\n      \"runners_count\": 16,\n      \"start_time\": \"16:50\"\n    },\n    {\n      \"rc\": \"R1 C7\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix D'Hennebont\",\n      \"url\": \"https://www.boturfers.fr/course/1086116-r1c7-prix-d-hennebont\",\n      \"runners_count\": 14,\n      \"start_time\": \"17:25\"\n    },\n    {\n      \"rc\": \"R1 C8\",\n      \"reunion\": \"R1\",\n      \"name\": \"Prix De Cerisy\",\n      \"url\": \"https://www.boturfers.fr/course/1086119-r1c8-prix-de-cerisy\",\n      \"runners_count\": 12,\n      \"start_time\": \"18:00\"\n    },\n    {\n      \"rc\": \"R3 C1\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Regis Bertin (prix Doux Pretender)\",\n      \"url\": \"https://www.boturfers.fr/course/1086077-r3c1-prix-regis-bertin-prix-doux-pretender\",\n      \"runners_count\": 7,\n      \"start_time\": \"11:51\"\n    },\n    {\n      \"rc\": \"R3 C2\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Julien Brossais - Challenge De L'Obstacle Equinaxy\",\n      \"url\": \"https://www.boturfers.fr/course/1086080-r3c2-prix-julien-brossais-challenge-de-l-obstacle-equinaxy\",\n      \"runners_count\": 8,\n      \"start_time\": \"12:23\"\n    },\n    {\n      \"rc\": \"R3 C3\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Roger Chaignon\",\n      \"url\": \"https://www.boturfers.fr/course/1086083-r3c3-prix-roger-chaignon\",\n      \"runners_count\": 9,\n      \"start_time\": \"12:55\"\n    },\n    {\n      \"rc\": \"R3 C4\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix De Saint-Malo\",\n      \"url\": \"https://www.boturfers.fr/course/1086086-r3c4-prix-de-saint-malo\",\n      \"runners_count\": 15,\n      \"start_time\": \"13:27\"\n    },\n    {\n      \"rc\": \"R3 C5\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Des Parieurs Pmu+\",\n      \"url\": \"https://www.boturfers.fr/course/1086089-r3c5-prix-des-parieurs-pmu\",\n      \"runners_count\": 14,\n      \"start_time\": \"14:12\"\n    },\n    {\n      \"rc\": \"R3 C6\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix Duralock\",\n      \"url\": \"https://www.boturfers.fr/course/1086092-r3c6-prix-duralock\",\n      \"runners_count\": 14,\n      \"start_time\": \"14:47\"\n    },\n    {\n      \"rc\": \"R3 C7\",\n      \"reunion\": \"R3\",\n      \"name\": \"Prix President Herve De La Brosse\",\n      \"url\": \"https://www.boturfers.fr/course/1086095-r3c7-prix-president-herve-de-la-brosse\",\n      \"runners_count\": 11,\n      \"start_time\": \"15:22\"\n    },\n    {\n      \"rc\": \"R4 C1\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Fontvieille\",\n      \"url\": \"https://www.boturfers.fr/course/1086053-r4c1-prix-de-fontvieille\",\n      \"runners_count\": 10,\n      \"start_time\": \"15:57\"\n    },\n    {\n      \"rc\": \"R4 C2\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Carpiagne\",\n      \"url\": \"https://www.boturfers.fr/course/1086056-r4c2-prix-de-carpiagne\",\n      \"runners_count\": 8,\n      \"start_time\": \"16:32\"\n    },\n    {\n      \"rc\": \"R4 C3\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix De Saint-Charles\",\n      \"url\": \"https://www.boturfers.fr/course/1086059-r4c3-prix-de-saint-charles\",\n      \"runners_count\": 9,\n      \"start_time\": \"17:07\"\n    },\n    {\n      \"rc\": \"R4 C4\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Lucien Planard\",\n      \"url\": \"https://www.boturfers.fr/course/1086062-r4c4-prix-lucien-planard\",\n      \"runners_count\": 9,\n      \"start_time\": \"17:42\"\n    },\n    {\n      \"rc\": \"R4 C5\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Ailes\",\n      \"url\": \"https://www.boturfers.fr/course/1086065-r4c5-prix-des-ailes\",\n      \"runners_count\": 13,\n      \"start_time\": \"18:20\"\n    },\n    {\n      \"rc\": \"R4 C6\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Roses\",\n      \"url\": \"https://www.boturfers.fr/course/1086068-r4c6-prix-des-roses\",\n      \"runners_count\": 12,\n      \"start_time\": \"18:55\"\n    },\n    {\n      \"rc\": \"R4 C7\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Tulipes\",\n      \"url\": \"https://www.boturfers.fr/course/1086071-r4c7-prix-des-tulipes\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:27\"\n    },\n    {\n      \"rc\": \"R4 C8\",\n      \"reunion\": \"R4\",\n      \"name\": \"Prix Des Calanques\",\n      \"url\": \"https://www.boturfers.fr/course/1086074-r4c8-prix-des-calanques\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:59\"\n    },\n    {\n      \"rc\": \"R5 C1\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Du Pmu\",\n      \"url\": \"https://www.boturfers.fr/course/1086122-r5c1-prix-du-pmu\",\n      \"runners_count\": 14,\n      \"start_time\": \"18:38\"\n    },\n    {\n      \"rc\": \"R5 C2\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Captain Sparrow\",\n      \"url\": \"https://www.boturfers.fr/course/1086125-r5c2-prix-captain-sparrow\",\n      \"runners_count\": 13,\n      \"start_time\": \"19:11\"\n    },\n    {\n      \"rc\": \"R5 C3\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Rolling, Gu Et Un Mec D'Heripre\",\n      \"url\": \"https://www.boturfers.fr/course/1086128-r5c3-prix-rolling-gu-et-un-mec-d-heripre\",\n      \"runners_count\": 16,\n      \"start_time\": \"19:43\"\n    },\n    {\n      \"rc\": \"R5 C4\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Justin Bold\",\n      \"url\": \"https://www.boturfers.fr/course/1086131-r5c4-prix-justin-bold\",\n      \"runners_count\": 13,\n      \"start_time\": \"20:15\"\n    },\n    {\n      \"rc\": \"R5 C5\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Balando\",\n      \"url\": \"https://www.boturfers.fr/course/1086134-r5c5-prix-balando\",\n      \"runners_count\": 10,\n      \"start_time\": \"20:42\"\n    },\n    {\n      \"rc\": \"R5 C6\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix 3id Nord Groupe Resilians\",\n      \"url\": \"https://www.boturfers.fr/course/1086137-r5c6-prix-3id-nord-groupe-resilians\",\n      \"runners_count\": 9,\n      \"start_time\": \"21:09\"\n    },\n    {\n      \"rc\": \"R5 C7\",\n      \"reunion\": \"R5\",\n      \"name\": \"Prix Des Amateurs\",\n      \"url\": \"https://www.boturfers.fr/course/1086140-r5c7-prix-des-amateurs\",\n      \"runners_count\": 16,\n      \"start_time\": \"21:36\"\n    },\n    {\n      \"rc\": \"R6 C1\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Bristol\",\n      \"url\": \"https://www.boturfers.fr/course/1086399-r6c1-prix-bristol\",\n      \"runners_count\": 10,\n      \"start_time\": \"19:00\"\n    },\n    {\n      \"rc\": \"R6 C2\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Sheffield\",\n      \"url\": \"https://www.boturfers.fr/course/1086402-r6c2-prix-sheffield\",\n      \"runners_count\": 9,\n      \"start_time\": \"19:28\"\n    },\n    {\n      \"rc\": \"R6 C3\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Cardiff\",\n      \"url\": \"https://www.boturfers.fr/course/1086405-r6c3-prix-cardiff\",\n      \"runners_count\": 7,\n      \"start_time\": \"19:56\"\n    },\n    {\n      \"rc\": \"R6 C4\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Belfast\",\n      \"url\": \"https://www.boturfers.fr/course/1086408-r6c4-prix-belfast\",\n      \"runners_count\": 10,\n      \"start_time\": \"20:25\"\n    },\n    {\n      \"rc\": \"R6 C5\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Glasgow\",\n      \"url\": \"https://www.boturfers.fr/course/1086411-r6c5-prix-glasgow\",\n      \"runners_count\": 9,\n      \"start_time\": \"20:55\"\n    },\n    {\n      \"rc\": \"R6 C6\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Gran Bretana\",\n      \"url\": \"https://www.boturfers.fr/course/1086414-r6c6-prix-gran-bretana\",\n      \"runners_count\": 8,\n      \"start_time\": \"21:25\"\n    },\n    {\n      \"rc\": \"R6 C7\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Edimburgo\",\n      \"url\": \"https://www.boturfers.fr/course/1086417-r6c7-prix-edimburgo\",\n      \"runners_count\": 10,\n      \"start_time\": \"21:55\"\n    },\n    {\n      \"rc\": \"R6 C8\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Londres\",\n      \"url\": \"https://www.boturfers.fr/course/1086420-r6c8-prix-londres\",\n      \"runners_count\": 9,\n      \"start_time\": \"22:25\"\n    },\n    {\n      \"rc\": \"R6 C9\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Birmingham\",\n      \"url\": \"https://www.boturfers.fr/course/1086423-r6c9-prix-birmingham\",\n      \"runners_count\": 9,\n      \"start_time\": \"22:55\"\n    },\n    {\n      \"rc\": \"R6 C10\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Liverpool\",\n      \"url\": \"https://www.boturfers.fr/course/1086426-r6c10-prix-liverpool\",\n      \"runners_count\": 11,\n      \"start_time\": \"23:25\"\n    },\n    {\n      \"rc\": \"R6 C11\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Leeds\",\n      \"url\": \"https://www.boturfers.fr/course/1086429-r6c11-prix-leeds\",\n      \"runners_count\": 10,\n      \"start_time\": \"23:55\"\n    },\n    {\n      \"rc\": \"R6 C12\",\n      \"reunion\": \"R6\",\n      \"name\": \"Prix Manchester\",\n      \"url\": \"https://www.boturfers.fr/course/1086432-r6c12-prix-manchester\",\n      \"runners_count\": 14,\n      \"start_time\": \"00:25\"\n    },\n    {\n      \"rc\": \"R9 C1\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Hubert Sarrazin\",\n      \"url\": \"https://www.boturfers.fr/course/1085939-r9c1-prix-hubert-sarrazin\",\n      \"runners_count\": 13,\n      \"start_time\": \"10:30\"\n    },\n    {\n      \"rc\": \"R9 C2\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Sault\",\n      \"url\": \"https://www.boturfers.fr/course/1085942-r9c2-prix-de-sault\",\n      \"runners_count\": 14,\n      \"start_time\": \"11:00\"\n    },\n    {\n      \"rc\": \"R9 C3\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Des Jouvenceaux\",\n      \"url\": \"https://www.boturfers.fr/course/1085945-r9c3-prix-des-jouvenceaux\",\n      \"runners_count\": 12,\n      \"start_time\": \"11:30\"\n    },\n    {\n      \"rc\": \"R9 C4\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De La Metropole\",\n      \"url\": \"https://www.boturfers.fr/course/1085948-r9c4-prix-de-la-metropole\",\n      \"runners_count\": 14,\n      \"start_time\": \"12:00\"\n    },\n    {\n      \"rc\": \"R9 C5\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Bel Air\",\n      \"url\": \"https://www.boturfers.fr/course/1085951-r9c5-prix-de-bel-air\",\n      \"runners_count\": 18,\n      \"start_time\": \"12:30\"\n    },\n    {\n      \"rc\": \"R9 C6\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix De Cavaillon\",\n      \"url\": \"https://www.boturfers.fr/course/1085954-r9c6-prix-de-cavaillon\",\n      \"runners_count\": 8,\n      \"start_time\": \"13:00\"\n    },\n    {\n      \"rc\": \"R9 C7\",\n      \"reunion\": \"R9\",\n      \"name\": \"Prix Philippe Millan\",\n      \"url\": \"https://www.boturfers.fr/course/1085957-r9c7-prix-philippe-millan\",\n      \"runners_count\": 11,\n      \"start_time\": \"13:30\"\n    }\n  ]\n}", "timestamp": "2025-11-24T12:02:14.731262Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Boturfers races map keys: ['R1C1', 'R1C2', 'R1C3', 'R1C4', 'R1C5', 'R1C6', 'R1C7', 'R1C8', 'R3C1', 'R3C2', 'R3C3', 'R3C4', 'R3C5', 'R3C6', 'R3C7', 'R4C1', 'R4C2', 'R4C3', 'R4C4', 'R4C5', 'R4C6', 'R4C7', 'R4C8', 'R5C1', 'R5C2', 'R5C3', 'R5C4', 'R5C5', 'R5C6', 'R5C7', 'R6C1', 'R6C2', 'R6C3', 'R6C4', 'R6C5', 'R6C6', 'R6C7', 'R6C8', 'R6C9', 'R6C10', 'R6C11', 'R6C12', 'R9C1', 'R9C2', 'R9C3', 'R9C4', 'R9C5', 'R9C6', 'R9C7']", "timestamp": "2025-11-24T12:02:14.731594Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R1C1", "timestamp": "2025-11-24T12:02:14.731653Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Enriched R1C1 with time 13:55 and URL https://www.boturfers.fr/quinte-du-jour from Boturfers.", "timestamp": "2025-11-24T12:02:14.731687Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R2C5", "timestamp": "2025-11-24T12:02:14.731714Z", "logger": "src.plan"}
{"severity": "WARNING", "message": "No matching Boturfers race found for Geny race R2C5, skipping.", "timestamp": "2025-11-24T12:02:14.731763Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Attempting to match Geny race R3C4", "timestamp": "2025-11-24T12:02:14.731791Z", "logger": "src.plan"}
{"severity": "DEBUG", "message": "Enriched R3C4 with time 13:27 and URL https://www.boturfers.fr/course/1086086-r3c4-prix-de-saint-malo from Boturfers.", "timestamp": "2025-11-24T12:02:14.731821Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Successfully enriched 2/3 races from Boturfers.", "timestamp": "2025-11-24T12:02:14.731851Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Plan complete: 2 races with times", "timestamp": "2025-11-24T12:02:14.731884Z", "logger": "src.plan"}
{"severity": "INFO", "message": "Plan built: 2 races", "timestamp": "2025-11-24T12:02:14.731924Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912", "total_races": 2}
{"severity": "INFO", "message": "Scheduling Cloud Tasks...", "timestamp": "2025-11-24T12:02:14.731969Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912"}
{"severity": "INFO", "message": "Cloud Tasks parent path components: project_id=local-project, region=local-region, queue_id=hippique-analysis-queue", "timestamp": "2025-11-24T12:02:14.740815Z", "logger": "src.scheduler"}
{"severity": "ERROR", "message": "Schedule failed: File /home/francoisosmozis/hippique-orchestrator/credentials.json was not found.", "timestamp": "2025-11-24T12:02:14.784612Z", "logger": "src.service", "correlation_id": "16f62eb8-49ba-4a9a-b3f5-36e9e1a84912", "traceback": "Traceback (most recent call last):\n  File \"/home/francoisosmozis/hippique-orchestrator/src/service.py\", line 293, in schedule_daily_plan\n    scheduled = schedule_all_races(\n                ^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 277, in schedule_all_races\n    task_h30 = enqueue_run_task(\n               ^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 152, in enqueue_run_task\n    client = get_tasks_client()\n             ^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/hippique-orchestrator/src/scheduler.py\", line 41, in get_tasks_client\n    _tasks_client = tasks_v2.CloudTasksClient()\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/client.py\", line 470, in __init__\n    self._transport = Transport(\n                      ^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/transports/grpc.py\", line 157, in __init__\n    super().__init__(\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/cloud/tasks_v2/services/cloud_tasks/transports/base.py\", line 105, in __init__\n    credentials, _ = google.auth.default(\n                     ^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 705, in default\n    credentials, project_id = checker()\n                              ^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 698, in <lambda>\n    lambda: _get_explicit_environ_credentials(quota_project_id=quota_project_id),\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 346, in _get_explicit_environ_credentials\n    credentials, project_id = load_credentials_from_file(\n                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/francoisosmozis/.local/lib/python3.12/site-packages/google/auth/_default.py\", line 173, in load_credentials_from_file\n    raise exceptions.DefaultCredentialsError(\ngoogle.auth.exceptions.DefaultCredentialsError: File /home/francoisosmozis/hippique-orchestrator/credentials.json was not found.\n"}
DEBUG: Type of config: <class 'app_config.AppConfig'>
DEBUG: Attributes of config: ['__annotations__', '__class__', '__dataclass_fields__', '__dataclass_params__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__match_args__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'cloud_tasks_queue', 'cloud_tasks_sa_email', 'environment', 'from_env', 'h30_offset', 'h5_offset', 'log_level', 'payout_calibration_path', 'project_id', 'queue_path', 'region', 'require_auth', 'service_url']
INFO:     127.0.0.1:47906 - "POST /schedule HTTP/1.1" 500 Internal Server Error
INFO:     Shutting down
INFO:     Waiting for application shutdown.
{"severity": "INFO", "message": "Service shutting down", "timestamp": "2025-11-24T12:20:37.416245Z", "logger": "src.service"}
INFO:     Application shutdown complete.
INFO:     Finished server process [15520]
2025-11-24 13:20:50,503 - WARNING - Test environment detected: using a dummy CLOUD_TASKS_SA_EMAIL.
INFO:     Started server process [16993]
INFO:     Waiting for application startup.
{"severity": "INFO", "message": "Service starting", "timestamp": "2025-11-24T12:20:50.726360Z", "logger": "src.service", "version": "2.0.0", "project_id": "local-project", "region": "local-region", "environment": "local"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
INFO:     Shutting down
INFO:     Waiting for application shutdown.
{"severity": "INFO", "message": "Service shutting down", "timestamp": "2025-11-24T12:21:11.828782Z", "logger": "src.service"}
INFO:     Application shutdown complete.
INFO:     Finished server process [16993]
2025-11-24 13:21:21,015 - WARNING - Test environment detected: using a dummy CLOUD_TASKS_SA_EMAIL.
INFO:     Started server process [17047]
INFO:     Waiting for application startup.
{"severity": "INFO", "message": "Service starting", "timestamp": "2025-11-24T12:21:21.210757Z", "logger": "src.service", "version": "2.0.0", "project_id": "local-project", "region": "local-region", "environment": "local"}
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
