============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /usr/bin/python
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, rerunfailures-16.1, cov-7.0.0, mock-3.14.0, timeout-2.4.0, xdist-3.8.0, env-1.1.3, asyncio-0.23.7, repeat-0.9.4
timeout: 300.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.STRICT
collecting ... collected 592 items

tests/scripts/test_online_fetch_zeturf.py::test_fallback_parse_html_extracts_data PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R1-C1-R1C1] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[1-2-R1C2] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R4C5-None-R4C5] PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag_raises_error PASSED [  0%]
tests/scripts/test_online_fetch_zeturf.py::test_coerce_runner_entry PASSED [  1%]
tests/scripts/test_online_fetch_zeturf.py::test_build_snapshot_payload PASSED [  1%]
tests/scripts/test_online_fetch_zeturf.py::test_fetch_race_snapshot_cli 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] [CLI] snapshot chargé depuis snapshot.json
PASSED                                                                   [  1%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_no_runners_table PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_runner_missing_data PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw0-expected0] PASSED [  1%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw1-expected1] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw2-expected2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw3-expected3] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw4-expected4] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw5-expected5] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw6-expected6] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw7-expected7] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw8-None] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_coerce_runner_entry_variations[raw9-expected9] PASSED [  3%]
tests/test_analysis_drift.py::test_drift_is_detected_and_applied 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Starting analysis pipeline for phase.
2026-01-01 09:38:57 [INFO] Fetching race details from data source.
2026-01-01 09:38:57 [INFO] Snapshot fetched successfully.
2026-01-01 09:38:57 [INFO] Snapshot saved to GCS at data/2025-01-01_R1C1/snapshots/20260101_083857_H-5.json
2026-01-01 09:38:57 [INFO] Preparing to run GPI ticket generation.
2026-01-01 09:38:57 [INFO] H-5 phase: attempting to load H-30 snapshot for drift.
2026-01-01 09:38:57 [INFO] Found latest H-30 snapshot: data/R1C1/snapshots/20250101_120000_H-30.json
2026-01-01 09:38:57 [INFO] Calling generate_tickets.
2026-01-01 09:38:57 [INFO] Analysis and ticket generation complete.
PASSED                                                                   [  3%]
tests/test_analysis_drift.py::test_pipeline_raises_if_doc_id_missing PASSED [  3%]
tests/test_analysis_drift.py::test_pipeline_abstains_if_snapshot_is_empty 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Starting analysis pipeline for phase.
2026-01-01 09:38:57 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  3%]
tests/test_analysis_drift.py::test_pipeline_handles_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Starting analysis pipeline for phase.
2026-01-01 09:38:57 [ERROR] Analysis pipeline failed: Unexpected GCS error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/analysis_pipeline.py", line 156, in run_analysis_for_phase
    snapshot_data, gcs_path = await _fetch_and_save_snapshot(
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: Unexpected GCS error

PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [WARNING] No snapshots found in directory.
PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_no_h30_snapshots_found 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [WARNING] No H-30 snapshot found for drift calculation.
PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_list_files_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [ERROR] Failed to find or load H-30 snapshot: GCS List Error
PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_find_and_load_h30_snapshot_read_file_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [ERROR] Failed to find or load H-30 snapshot: GCS Read Error
PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_empty_snapshot_from_data_source 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Starting analysis pipeline for phase.
2026-01-01 09:38:57 [INFO] Fetching race details from data source.
2026-01-01 09:38:57 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  4%]
tests/test_analysis_pipeline_extended.py::test_run_analysis_for_phase_abstains_on_snapshot_with_no_runners 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Starting analysis pipeline for phase.
2026-01-01 09:38:57 [INFO] Fetching race details from data source.
2026-01-01 09:38:57 [WARNING] Snapshot invalid or runners empty -> abstention.
PASSED                                                                   [  5%]
tests/test_analysis_utils.py::test_normalise_text[None-] PASSED          [  5%]
tests/test_analysis_utils.py::test_normalise_text[  \xc9curie Sp\xe9ciale  -ecurie speciale] PASSED [  5%]
tests/test_analysis_utils.py::test_normalise_text[  -] PASSED            [  5%]
tests/test_analysis_utils.py::test_normalise_text[TROT-trot] PASSED      [  5%]
tests/test_analysis_utils.py::test_normalise_text[handicap-handicap] PASSED [  5%]
tests/test_analysis_utils.py::test_coerce_partants[14-14] PASSED         [  6%]
tests/test_analysis_utils.py::test_coerce_partants[14.0-14] PASSED       [  6%]
tests/test_analysis_utils.py::test_coerce_partants[14 partants-14] PASSED [  6%]
tests/test_analysis_utils.py::test_coerce_partants[environ 14-14] PASSED [  6%]
tests/test_analysis_utils.py::test_coerce_partants[None-None] PASSED     [  6%]
tests/test_analysis_utils.py::test_coerce_partants[True-None] PASSED     [  6%]
tests/test_analysis_utils.py::test_coerce_partants[N/A-None] PASSED      [  7%]
tests/test_analysis_utils.py::test_coerce_partants[-5-None] PASSED       [  7%]
tests/test_analysis_utils.py::test_compute_overround_cap_default PASSED  [  7%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_handicap_large_field PASSED [  7%]
tests/test_analysis_utils.py::test_compute_overround_cap_flat_large_field_from_label PASSED [  7%]
tests/test_analysis_utils.py::test_compute_overround_cap_small_field_uses_default PASSED [  7%]
tests/test_analysis_utils.py::test_compute_overround_cap_updates_context PASSED [  8%]
tests/test_analysis_utils_extended.py::test_parse_musique[1p2p(23)3p4hDAI-expected0] PASSED [  8%]
tests/test_analysis_utils_extended.py::test_parse_musique[0a9a8a-expected1] PASSED [  8%]
tests/test_analysis_utils_extended.py::test_parse_musique[None-expected2] PASSED [  8%]
tests/test_analysis_utils_extended.py::test_parse_musique[   -expected3] PASSED [  8%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data0-VOLATIL] PASSED [  8%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data1-VOLATIL] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data2-VOLATIL] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data3-S\xdbR] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data4-VOLATIL] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_calculate_volatility[musique_data5-NEUTRE] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list0-expected_probs0-1.0] PASSED [  9%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list1-expected_probs1-0.0] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list2-expected_probs2-0.25] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_convert_odds_to_implied_probabilities[odds_list3-expected_probs3-0.5] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data0-True] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data1-False] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data2-False] PASSED [ 10%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data3-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_outsider_reparable[runner_data4-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data0-True] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data1-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data2-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data3-False] PASSED [ 11%]
tests/test_analysis_utils_extended.py::test_identify_profil_oublie[runner_data4-False] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data0-expected_score0] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data1-expected_score1] PASSED [ 12%]
tests/test_analysis_utils_extended.py::test_score_musique_form[musique_data2-0.0] PASSED [ 12%]
tests/test_api_endpoints.py::test_health_check_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Request started
2026-01-01 09:38:57 [INFO] Request finished
2026-01-01 09:38:57 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 12%]
tests/test_api_endpoints.py::test_pronostics_ui_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Request started
2026-01-01 09:38:57 [INFO] Request finished
2026-01-01 09:38:57 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_root_redirect 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Request started
2026-01-01 09:38:57 [INFO] Request finished
2026-01-01 09:38:57 [INFO] HTTP Request: GET http://testserver/ "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_date_validation 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Request started
2026-01-01 09:38:57 [INFO] Request finished
2026-01-01 09:38:57 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=not-a-real-date "HTTP/1.1 422 Unprocessable Entity"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_default_date_is_today 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:57 [INFO] Request started
2026-01-01 09:38:57 [INFO] Building plan for 2025-07-15 using Boturfers as the single source.
2026-01-01 09:38:57 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-07-15
2026-01-01 09:38:57 [INFO] Début du scraping du programme Boturfers.
2026-01-01 09:38:58 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-07-15 "HTTP/1.1 404 Not Found"
2026-01-01 09:38:58 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-07-15: 404
2026-01-01 09:38:58 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-01 09:38:58 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: GET http://testserver/api/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_empty_response 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-01 09:38:58 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-01 09:38:58 [INFO] Début du scraping du programme Boturfers.
2026-01-01 09:38:58 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-01 09:38:58 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-01 09:38:58 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-01 09:38:58 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_etag_304_not_modified 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-01 09:38:58 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-01 09:38:58 [INFO] Début du scraping du programme Boturfers.
2026-01-01 09:38:58 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-01 09:38:58 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-01 09:38:58 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-01 09:38:58 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Building plan for 2025-01-01 using Boturfers as the single source.
2026-01-01 09:38:58 [INFO] Fetching programme from data source via URL: https://www.boturfers.fr/courses/2025-01-01
2026-01-01 09:38:58 [INFO] Début du scraping du programme Boturfers.
2026-01-01 09:38:58 [INFO] HTTP Request: GET https://www.boturfers.fr/courses/2025-01-01 "HTTP/1.1 404 Not Found"
2026-01-01 09:38:58 [ERROR] Erreur HTTP lors du téléchargement de https://www.boturfers.fr/courses/2025-01-01: 404
2026-01-01 09:38:58 [ERROR] Le scraping du programme a échoué ou n'a retourné aucune course.
2026-01-01 09:38:58 [WARNING] Failed to fetch programme from Boturfers or it was empty.
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 304 Not Modified"
PASSED                                                                   [ 13%]
tests/test_api_endpoints.py::test_api_pronostics_rich_response_structure 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_api_key_required_and_missing 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
2026-01-01 09:38:58 [INFO] Request started
2026-01-01 09:38:58 [INFO] Request finished
2026-01-01 09:38:58 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_ops_run_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_api_key_not_required 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received request to schedule day races. Force: False, Dry Run: True
2026-01-01 09:38:59 [WARNING] No races found in plan for 2025-01-01. Nothing to schedule.
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/schedule "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_valid_token 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received run-phase request for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-01 09:38:59 [INFO] Updating Firestore document
2026-01-01 09:38:59 [INFO] Run phase completed successfully for http://example.com/2025-01-01/R1C1-test (phase: H-5)
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 14%]
tests/test_api_security.py::test_task_worker_google_auth_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_task_worker_invalid_token_scheme 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 401 Unauthorized"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_snapshot_9h_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_security.py::test_bootstrap_day_endpoint_security 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 403 Forbidden"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_snapshot_9h_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received snapshot-9h request for 2026-01-01 with URLs: [], RC Labels: []
2026-01-01 09:38:59 [INFO] Snapshot-9h completed successfully for 2026-01-01.
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_snapshot_9h_task_with_specific_date_and_urls 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received snapshot-9h request for 2025-10-26 with URLs: ['http://example.com/r1c1', 'http://example.com/r1c2'], RC Labels: []
2026-01-01 09:38:59 [INFO] Snapshot-9h completed successfully for 2025-10-26.
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/snapshot-9h "HTTP/1.1 200 OK"
PASSED                                                                   [ 15%]
tests/test_api_tasks.py::test_run_phase_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Starting Firestore-native course analysis
2026-01-01 09:38:59 [INFO] Course analysis completed successfully.
2026-01-01 09:38:59 [INFO] Updating Firestore document
2026-01-01 09:38:59 [INFO] Run phase completed successfully for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_run_phase_task_run_course_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Starting Firestore-native course analysis
2026-01-01 09:38:59 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: mock_error_from_analysis
2026-01-01 09:38:59 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_run_phase_task_exception_handling 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received run-phase request for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Starting Firestore-native course analysis
2026-01-01 09:38:59 [ERROR] An unexpected error occurred during course analysis.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/runner.py", line 71, in run_course
    result = await analysis_pipeline.run_analysis_for_phase(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
Exception: unexpected_error
2026-01-01 09:38:59 [ERROR] Run phase failed for http://example.com/race/2025-12-29_R1C1 (phase: H30)
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/run-phase "HTTP/1.1 500 Internal Server Error"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_bootstrap_day_task_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received request to bootstrap day 2026-01-01
2026-01-01 09:38:59 [INFO] Building daily plan for 2026-01-01...
2026-01-01 09:38:59 [INFO] Plan built: 2 races for 2026-01-01.
2026-01-01 09:38:59 [INFO] Bootstrap day completed. Scheduled 3 tasks.
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 200 OK"
PASSED                                                                   [ 16%]
tests/test_api_tasks.py::test_bootstrap_day_task_empty_plan 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Request started
2026-01-01 09:38:59 [INFO] Received request to bootstrap day 2026-01-01
2026-01-01 09:38:59 [INFO] Building daily plan for 2026-01-01...
2026-01-01 09:38:59 [WARNING] Empty plan for 2026-01-01. No tasks to schedule.
2026-01-01 09:38:59 [INFO] Request finished
2026-01-01 09:38:59 [INFO] HTTP Request: POST http://testserver/tasks/bootstrap-day "HTTP/1.1 404 Not Found"
PASSED                                                                   [ 16%]
tests/test_dutching_allocation.py::test_equal_profit_stakes_sum PASSED   [ 16%]
tests/test_env_utils.py::test_get_env_missing_warns 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [WARNING] Environment variable FOO not set; using default 'bar'
PASSED                                                                   [ 17%]
tests/test_env_utils.py::test_get_env_required_missing_logs_critical 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [CRITICAL] Missing required environment variable 'BAR'. App may not function correctly.
PASSED                                                                   [ 17%]
tests/test_env_utils.py::test_get_env_required_missing_in_prod_exits 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [CRITICAL] Missing required environment variable 'PROD_VAR'. App may not function correctly.
2026-01-01 09:38:59 [CRITICAL] IS_PROD=True. Exiting.
PASSED                                                                   [ 17%]
tests/test_env_utils.py::test_get_env_alias_support 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] Environment variable FOO_ALIAS=42 used as alias for FOO
2026-01-01 09:38:59 [INFO] Environment variable FOO_ALIAS=42 overrides default 0
PASSED                                                                   [ 17%]
tests/test_env_utils.py::test_get_env_casting_error_returns_default 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [ERROR] Invalid value for environment variable 'BAD_INT': 'not_an_integer'. Returning default.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/config/env_utils.py", line 77, in get_env
    value = cast(raw_value)
            ^^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'not_an_integer'
PASSED                                                                   [ 17%]
tests/test_env_utils.py::test_get_env_value_equals_default_no_override_log PASSED [ 17%]
tests/test_ev_calculator.py::test_make_hashable_hashable_types PASSED    [ 18%]
tests/test_ev_calculator.py::test_make_hashable_list PASSED              [ 18%]
tests/test_ev_calculator.py::test_make_hashable_dict PASSED              [ 18%]
tests/test_ev_calculator.py::test_make_hashable_nested_structures PASSED [ 18%]
tests/test_ev_calculator.py::test_make_hashable_unhashable_fallback PASSED [ 18%]
tests/test_ev_calculator.py::test_kelly_fraction_valid_inputs PASSED     [ 18%]
tests/test_ev_calculator.py::test_kelly_fraction_probability_out_of_range PASSED [ 19%]
tests/test_ev_calculator.py::test_kelly_fraction_odds_out_of_range PASSED [ 19%]
tests/test_ev_calculator.py::test_apply_dutching_single_group PASSED     [ 19%]
tests/test_ev_calculator.py::test_apply_dutching_multiple_groups PASSED  [ 19%]
tests/test_ev_calculator.py::test_apply_dutching_no_dutching_groups PASSED [ 19%]
tests/test_ev_calculator.py::test_apply_dutching_mixed_groups PASSED     [ 19%]
tests/test_ev_calculator.py::test_apply_dutching_invalid_odds_in_group PASSED [ 20%]
tests/test_ev_calculator.py::test_apply_dutching_single_valid_ticket_in_group PASSED [ 20%]
tests/test_ev_calculator.py::test_apply_dutching_group_too_small PASSED  [ 20%]
tests/test_ev_calculator.py::test_ticket_label_with_id PASSED            [ 20%]
tests/test_ev_calculator.py::test_ticket_label_with_name PASSED          [ 20%]
tests/test_ev_calculator.py::test_ticket_label_with_label PASSED         [ 20%]
tests/test_ev_calculator.py::test_ticket_label_with_selection PASSED     [ 21%]
tests/test_ev_calculator.py::test_ticket_label_with_runner PASSED        [ 21%]
tests/test_ev_calculator.py::test_ticket_label_no_label_keys_falls_back_to_index PASSED [ 21%]
tests/test_ev_calculator.py::test_ticket_label_empty_string_values_falls_back_to_index PASSED [ 21%]
tests/test_ev_calculator.py::test_clone_leg_dict PASSED                  [ 21%]
tests/test_ev_calculator.py::test_clone_leg_list_of_dicts PASSED         [ 21%]
tests/test_ev_calculator.py::test_clone_leg_primitive_type PASSED        [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_for_probability PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs_details PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_legs PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_with_id_only PASSED [ 22%]
tests/test_ev_calculator.py::test_prepare_legs_for_covariance_no_identifiable_legs PASSED [ 22%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_ticket_id PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_selection_id PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_leg_id_in_legs PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_with_mixed_dependencies PASSED [ 23%]
tests/test_ev_calculator.py::test_ticket_dependency_keys_empty PASSED    [ 23%]
tests/test_ev_calculator.py::test_prepare_ticket_dependencies PASSED     [ 23%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_id_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_leg_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_no_specific_dependency PASSED [ 24%]
tests/test_ev_calculator.py::test_rho_for_shared_exposures_empty PASSED  [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_independent PASSED [ 24%]
tests/test_ev_calculator.py::test_approx_joint_probability_positive_correlation PASSED [ 25%]
tests/test_ev_calculator.py::test_approx_joint_probability_negative_correlation PASSED [ 25%]
tests/test_ev_calculator.py::test_approx_joint_probability_rho_clipping PASSED [ 25%]
tests/test_ev_calculator.py::test_approx_joint_probability_lower_bound PASSED [ 25%]
tests/test_ev_calculator.py::test_merge_legs_no_duplicates PASSED        [ 25%]
tests/test_ev_calculator.py::test_merge_legs_with_duplicates PASSED      [ 25%]
tests/test_ev_calculator.py::test_merge_legs_with_dict_duplicates PASSED [ 26%]
tests/test_ev_calculator.py::test_merge_legs_empty_inputs PASSED         [ 26%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_simulate_fn PASSED [ 26%]
tests/test_ev_calculator.py::test_simulate_joint_probability_no_legs PASSED [ 26%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_no_cache PASSED [ 26%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_miss PASSED [ 26%]
tests/test_ev_calculator.py::test_simulate_joint_probability_with_simulate_fn_and_cache_hit PASSED [ 27%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_and_cache PASSED [ 27%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_simulate_fn_no_cache PASSED [ 27%]
tests/test_ev_calculator.py::test_estimate_joint_probability_no_simulate_fn_uses_approx PASSED [ 27%]
tests/test_ev_calculator.py::test_estimate_joint_probability_with_copula_monte_carlo PASSED [ 27%]
tests/test_ev_calculator.py::test_covariance_from_joint_positive PASSED  [ 27%]
tests/test_ev_calculator.py::test_covariance_from_joint_negative PASSED  [ 28%]
tests/test_ev_calculator.py::test_covariance_from_joint_zero_probability PASSED [ 28%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_tickets PASSED [ 28%]
tests/test_ev_calculator.py::test_compute_joint_moments_fewer_than_min_tickets PASSED [ 28%]
tests/test_ev_calculator.py::test_compute_joint_moments_no_shared_exposures PASSED [ 28%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_positive_covariance PASSED [ 28%]
tests/test_ev_calculator.py::test_compute_joint_moments_with_shared_exposures_negative_covariance PASSED [ 29%]
tests/test_ev_calculator.py::test_compute_joint_moments_covariance_below_threshold PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-None-0.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.0-0.01-100-None-1.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.0-100-None-0.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.02-0.0] PASSED [ 29%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.1-0.01-100-0.005-0.0] PASSED [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin[0.01-0.01-1-None-0.1353352832366127] PASSED [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin_invalid_bankroll PASSED   [ 30%]
tests/test_ev_calculator.py::test_risk_of_ruin_respects_baseline_variance PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_with_scipy PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_without_scipy_fallback_to_grid_search PASSED [ 30%]
tests/test_ev_calculator.py::test_optimize_stake_allocation_empty_tickets PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_p_provided PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_legs_provided_simulated_p_cached PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_no_p_or_legs_raises_value_error PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_p_raises_value_error PASSED [ 31%]
tests/test_ev_calculator.py::test_process_single_ticket_invalid_odds_raises_value_error PASSED [ 32%]
tests/test_ev_calculator.py::test_process_single_ticket_stake_capping_and_rounding PASSED [ 32%]
tests/test_ev_calculator.py::test_process_tickets_basic_functionality PASSED [ 32%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_single_ticket PASSED [ 32%]
tests/test_ev_calculator.py::test_calculate_ticket_metrics_with_combined_ticket PASSED [ 32%]
tests/test_ev_calculator.py::test_calculate_final_metrics_green_flag PASSED [ 32%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ev_ratio PASSED [ 33%]
tests/test_ev_calculator.py::test_calculate_final_metrics_red_flag_ror PASSED [ 33%]
tests/test_ev_calculator.py::test_compute_ev_roi_basic_functionality PASSED [ 33%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_budget PASSED   [ 33%]
tests/test_ev_calculator.py::test_compute_ev_roi_invalid_variance_cap_config PASSED [ 33%]
tests/test_ev_calculator.py::test_compute_ev_roi_with_optimize_true PASSED [ 33%]
tests/test_ev_calculator.py::test_compute_ev_roi_variance_capping PASSED [ 34%]
tests/test_ev_thresholds.py::test_ev_sp_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 34%]
tests/test_ev_thresholds.py::test_ev_global_below_default_threshold 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 34%]
tests/test_ev_thresholds.py::test_validate_policy_roi_below_threshold PASSED [ 34%]
tests/test_ev_thresholds.py::test_validate_policy_raises_on_low_roi_message PASSED [ 34%]
tests/test_evaluate_combo.py::test_default_config_path_missing PASSED    [ 34%]
tests/test_evaluate_combo.py::test_env_path_missing PASSED               [ 35%]
tests/test_evaluate_combo.py::test_env_path_present PASSED               [ 35%]
tests/test_evaluate_combo.py::test_gates_when_calibration_missing PASSED [ 35%]
tests/test_evaluate_combo.py::test_override_missing_calibration 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 35%]
tests/test_evaluate_combo.py::test_with_calibration PASSED               [ 35%]
tests/test_evaluate_combo.py::test_marks_unreliable_probabilities 
-------------------------------- live log call ---------------------------------
2026-01-01 09:38:59 [WARNING] [COMBO] allow_heuristic override ignored; payout calibration is mandatory for combo evaluation.
PASSED                                                                   [ 35%]
tests/test_fetch_je_stats.py::test_normalise_text[  Test String  -teststring] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_normalise_text[\xc9curie Sp\xe9ciale-ecuriespeciale] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_normalise_text[J. VANMEERBECK-jvanmeerbeck] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_parse_percentage[R\xe9ussite jockey/cheval : 15%-15.0] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_parse_percentage[Ratio: 3 / 10-30.0] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires : 5-5.0] PASSED [ 36%]
tests/test_fetch_je_stats.py::test_parse_percentage[Taux de r\xe9ussite : 0.25-25.0] PASSED [ 37%]
tests/test_fetch_je_stats.py::test_parse_percentage[Just a number 42.5 here-42.5] PASSED [ 37%]
tests/test_fetch_je_stats.py::test_parse_percentage[No number here-None] PASSED [ 37%]
tests/test_fetch_je_stats.py::test_parse_percentage[-None] PASSED        [ 37%]
tests/test_fetch_je_stats.py::test_parse_percentage[Victoires=10-10.0] PASSED [ 37%]
tests/test_fetch_je_stats.py::test_parse_percentage[12,5%-12.5] PASSED   [ 38%]
tests/test_fetch_je_stats.py::test_extract_links_from_horse_page PASSED  [ 38%]
tests/test_fetch_je_stats.py::test_extract_rate_from_profile PASSED      [ 38%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name PASSED     [ 38%]
tests/test_fetch_je_stats.py::test_discover_horse_url_by_name_http_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] Failed to fetch Geny search results for Bold Eagle
PASSED                                                                   [ 38%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_success PASSED [ 38%]
tests/test_fetch_je_stats.py::test_parse_horse_percentages_handles_failures 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] Failed to fetch horse page http://horse.url
PASSED                                                                   [ 39%]
tests/test_fetch_je_stats.py::test_collect_stats_integration PASSED      [ 39%]
tests/test_firestore_client.py::test_update_race_document_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Updating Firestore document
PASSED                                                                   [ 39%]
tests/test_firestore_client.py::test_update_race_document_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Failed to update document some_id: Firestore unavailable
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 29, in update_race_document
    doc_ref = db.collection(config.FIRESTORE_COLLECTION).document(document_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Firestore unavailable
PASSED                                                                   [ 39%]
tests/test_firestore_client.py::test_update_race_document_skips_if_db_not_available 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] Firestore is not available, skipping update.
PASSED                                                                   [ 39%]
tests/test_firestore_client.py::test_get_races_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 39%]
tests/test_firestore_client.py::test_get_races_for_date_empty 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 40%]
tests/test_firestore_client.py::test_get_races_for_date_handles_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Failed to query races by date 2025-12-30: Query failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/firestore_client.py", line 51, in get_races_for_date
    races_ref = db.collection(config.FIRESTORE_COLLECTION)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Query failed
PASSED                                                                   [ 40%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://www.zeturf.fr/fr/course/2025-12-25/R1C2-test-pmu-2025-12-25-2025-12-25_R1C2] PASSED [ 40%]
tests/test_firestore_client.py::test_get_doc_id_from_url[https://turf.fr/R5C3/details-2025-12-25-2025-12-25_R5C3] PASSED [ 40%]
tests/test_firestore_client.py::test_get_doc_id_from_url[R3C8-2025-12-25-2025-12-25_R3C8] PASSED [ 40%]
tests/test_firestore_client.py::test_get_doc_id_from_url[some-string-r4c1-other-2025-12-25-2025-12-25_R4C1] PASSED [ 40%]
tests/test_firestore_client.py::test_get_doc_id_from_url[invalid-url-2025-12-25-None] PASSED [ 41%]
tests/test_firestore_client.py::test_get_doc_id_from_url[-2025-12-25-None] PASSED [ 41%]
tests/test_firestore_client.py::test_get_processing_status_for_date_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 41%]
tests/test_firestore_client.py::test_get_processing_status_for_date_db_not_available PASSED [ 41%]
tests/test_firestore_client.py::test_get_processing_status_for_date_empty_daily_plan 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 41%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unprocessed_races 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 41%]
tests/test_firestore_client.py::test_get_processing_status_for_date_error_decision 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 42%]
tests/test_firestore_client.py::test_get_processing_status_for_date_unknown_decision 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Queried races from Firestore
PASSED                                                                   [ 42%]
tests/test_gcs_client_extended.py::test_gcs_manager_init PASSED          [ 42%]
tests/test_gcs_client_extended.py::test_gcs_manager_init_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] GCS_BUCKET is not set in the configuration. GCS operations will fail.
PASSED                                                                   [ 42%]
tests/test_gcs_client_extended.py::test_gcs_manager_lazy_init PASSED     [ 42%]
tests/test_gcs_client_extended.py::test_get_gcs_path PASSED              [ 42%]
tests/test_gcs_client_extended.py::test_file_exists PASSED               [ 43%]
tests/test_gcs_client_extended.py::test_get_gcs_fs PASSED                [ 43%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_no_bucket 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
PASSED                                                                   [ 43%]
tests/test_gcs_client_extended.py::test_get_gcs_manager_singleton PASSED [ 43%]
tests/test_gcs_client_extended.py::test_get_gcs_fs_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-01 09:39:00 [ERROR] GCSManager is not initialized. Cannot get filesystem.
PASSED                                                                   [ 43%]
tests/test_gcs_client_extended.py::test_build_gcs_path PASSED            [ 43%]
tests/test_gcs_client_extended.py::test_build_gcs_path_no_manager 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] GCS operations are disabled because BUCKET_NAME is not set.
2026-01-01 09:39:00 [ERROR] GCSManager is not initialized. Cannot build GCS path.
PASSED                                                                   [ 44%]
tests/test_guardrails.py::test_evaluate_guardrail_uses_multiple_paths PASSED [ 44%]
tests/test_guardrails.py::test_evaluate_guardrail_detects_low_values PASSED [ 44%]
tests/test_guardrails.py::test_load_json_raises_on_non_object PASSED     [ 44%]
tests/test_guardrails.py::test_extract_metric_returns_zero_when_missing PASSED [ 44%]
tests/test_guardrails.py::test_append_env_writes_to_file PASSED          [ 44%]
tests/test_guardrails.py::test_main_success_path PASSED                  [ 45%]
tests/test_guardrails.py::test_main_abstention_path_creates_report PASSED [ 45%]
tests/test_guardrails.py::test_main_file_not_found PASSED                [ 45%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-1.0-1.0-0.25] PASSED    [ 45%]
tests/test_kelly.py::test_kelly_fraction[0.2-3.0-1.0-1.0-0.0] PASSED     [ 45%]
tests/test_kelly.py::test_kelly_fraction[0.3333333333333333-3.0-1.0-1.0-0.0] PASSED [ 45%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0-0.5-1.0-0.125] PASSED   [ 46%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-0.2-0.2] PASSED     [ 46%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-0.5-0.3-0.3] PASSED     [ 46%]
tests/test_kelly.py::test_kelly_fraction[1.5-3.0-1.0-1.0-0.0] PASSED     [ 46%]
tests/test_kelly.py::test_kelly_fraction[0.0-3.0-1.0-1.0-0.0] PASSED     [ 46%]
tests/test_kelly.py::test_kelly_fraction[-0.5-3.0-1.0-1.0-0.0] PASSED    [ 46%]
tests/test_kelly.py::test_kelly_fraction[0.5-1.0-1.0-1.0-0.0] PASSED     [ 47%]
tests/test_kelly.py::test_kelly_fraction[0.5-0.5-1.0-1.0-0.0] PASSED     [ 47%]
tests/test_kelly.py::test_kelly_fraction[0.5-3.0--0.5-1.0-0.25] PASSED   [ 47%]
tests/test_kelly.py::test_kelly_fraction[0.8-3.0-1.0-1.5-0.7] PASSED     [ 47%]
tests/test_kelly.py::test_kelly_stake PASSED                             [ 47%]
tests/test_kelly_cap.py::test_kelly_cap_limits_stakes PASSED             [ 47%]
tests/test_kelly_cap.py::test_validate_budget_ok PASSED                  [ 48%]
tests/test_kelly_cap.py::test_validate_budget_total_exceeded PASSED      [ 48%]
tests/test_kelly_cap.py::test_validate_budget_horse_cap_exceeded PASSED  [ 48%]
tests/test_logging_io.py::test_csv_header_and_columns PASSED             [ 48%]
tests/test_no_vig_ev.py::test_no_vig_sum_to_one PASSED                   [ 48%]
tests/test_no_vig_ev.py::test_ev_drops_when_margin_higher PASSED         [ 48%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>14h05</td>-14:05] PASSED [ 49%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'> 9h30 </td>-09:30] PASSED [ 49%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>21:45</td>-21:45] PASSED [ 49%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>08:15</td>-08:15] PASSED [ 49%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>12h00</td>-12:00] PASSED [ 49%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td class='hour'>No time here</td>-None] PASSED [ 50%]
tests/test_online_fetch_start_time.py::test_extract_start_time_from_programme_row[<td></td>-None] PASSED [ 50%]
tests/test_p_finale_export.py::test_export_creates_csv_and_excel PASSED  [ 50%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_roi_is_low PASSED [ 50%]
tests/test_pipeline_run.py::test_generate_tickets_creates_sp_dutching_ticket_when_roi_is_high PASSED [ 50%]
tests/test_pipeline_run.py::test_generate_tickets_abstains_when_global_roi_is_low PASSED [ 50%]
tests/test_pipeline_run.py::test_generate_tickets_creates_trio_ticket_with_best_roi PASSED [ 51%]
tests/test_plan.py::test_build_plan_nominal_case 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-01 09:39:00 [INFO] Successfully fetched 2 races from Boturfers.
2026-01-01 09:39:00 [INFO] Plan complete: 2 races with times
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_scraper_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-01 09:39:00 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_handles_malformed_data 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-01 09:39:00 [INFO] Successfully fetched 3 races from Boturfers.
2026-01-01 09:39:00 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-01 09:39:00 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_today_string 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2026-01-01 using Boturfers as the single source.
2026-01-01 09:39:00 [WARNING] Failed to fetch programme from Boturfers or it was empty.
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_empty_enriched_plan 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-01 09:39:00 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-01 09:39:00 [WARNING] Could not parse R/C from 'invalid'. Skipping race.
2026-01-01 09:39:00 [INFO] Plan complete: 0 races with times
PASSED                                                                   [ 51%]
tests/test_plan.py::test_build_plan_handles_compact_rc_format 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] Building plan for 2025-12-20 using Boturfers as the single source.
2026-01-01 09:39:00 [INFO] Successfully fetched 1 races from Boturfers.
2026-01-01 09:39:00 [INFO] Plan complete: 1 races with times
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_wrapper 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_raises_in_event_loop 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] build_plan() is deprecated, use build_plan_async() instead
2026-01-01 09:39:00 [ERROR] Cannot use build_plan() from within event loop. Use build_plan_async() instead.
PASSED                                                                   [ 52%]
tests/test_plan.py::test_build_plan_sync_reraises_other_runtime_errors 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [WARNING] build_plan() is deprecated, use build_plan_async() instead
PASSED                                                                   [ 52%]
tests/test_resolve_course_id.py::test_resolve_course_context_with_fallback PASSED [ 52%]
tests/test_resolve_course_id.py::test_resolve_course_context_picks_closest_future_entry PASSED [ 52%]
tests/test_resolve_course_id.py::test_resolve_course_context_errors_when_empty PASSED [ 53%]
tests/test_resolve_course_id.py::test_iter_schedule_entries_supports_fr_course_urls PASSED [ 53%]
tests/test_resolve_course_id.py::test_resolve_course_context_supports_fr_course_urls PASSED [ 53%]
tests/test_roi_rebalancer.py::test_compute_allocation_plan_prioritises_high_ev PASSED [ 53%]
tests/test_roi_rebalancer.py::test_plan_serialisation_round_trip PASSED  [ 53%]
tests/test_roi_rebalancer.py::test_allocation_plan_requires_positive_bankroll PASSED [ 53%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: True) ---
2026-01-01 09:39:00 [WARNING] Skipping task: Schedule time 2026-01-01T07:08:00+00:00 is in the past.
2026-01-01 09:39:00 [WARNING] Skipping task: Schedule time 2026-01-01T07:33:00+00:00 is in the past.
2026-01-01 09:39:00 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-01 09:39:00 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 54%]
tests/test_scheduler.py::test_schedule_all_races_dry_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: True) ---
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.883214+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.883503+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.883743+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.884101+00:00
2026-01-01 09:39:00 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-01 09:39:00 [INFO] --- Dry run complete. Returning calculated tasks. ---
PASSED                                                                   [ 54%]
tests/test_scheduler.py::test_schedule_all_races_real_run_with_force 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.892728+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.893274+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.893763+00:00
2026-01-01 09:39:00 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:00.894368+00:00
2026-01-01 09:39:00 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-01 09:39:00 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795755248'>
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795755248'>
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795755248'>
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795755248'>
2026-01-01 09:39:00 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 54%]
tests/test_scheduler.py::test_schedule_all_races_real_run_no_force 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [INFO] --- Starting schedule_all_races (Force: False, Dry Run: False) ---
2026-01-01 09:39:00 [WARNING] Skipping task: Schedule time 2026-01-01T07:08:00+00:00 is in the past.
2026-01-01 09:39:00 [WARNING] Skipping task: Schedule time 2026-01-01T07:33:00+00:00 is in the past.
2026-01-01 09:39:00 [INFO] Calculation complete. Candidates: 2, Skipped: 2
2026-01-01 09:39:00 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795584496'>
2026-01-01 09:39:00 [INFO] Enqueuing Cloud Task
2026-01-01 09:39:00 [INFO] Task created: <MagicMock name='projects/p/locations/l/queues/q/tasks/t.name' id='133983795584496'>
2026-01-01 09:39:00 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 54%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_phase_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Error calculating schedule time: invalid literal for int() with base 10: 'NVALID'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 35, in _calculate_task_schedule
    phase_minutes = int(phase[1:])
                    ^^^^^^^^^^^^^^
ValueError: invalid literal for int() with base 10: 'NVALID'
PASSED                                                                   [ 54%]
tests/test_scheduler_extended.py::test_calculate_task_schedule_invalid_race_time_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Error calculating schedule time: Invalid isoformat string: '2025-01-01Tnot-a-time'
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 36, in _calculate_task_schedule
    race_datetime_local = datetime.fromisoformat(f"{date}T{race_time_local}")
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Invalid isoformat string: '2025-01-01Tnot-a-time'
PASSED                                                                   [ 54%]
tests/test_scheduler_extended.py::test_enqueue_run_task_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Service URL is not configured. Cannot create task.
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_enqueue_run_task_oidc_config_missing 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Failed to create task for http://example.com/race: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 106, in enqueue_run_task
    raise ValueError("TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.")
ValueError: TASK_OIDC_SA_EMAIL must be set when REQUIRE_AUTH is True.
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_enqueue_run_task_permission_denied 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [CRITICAL] Permission denied to create Cloud Task. Please grant 'roles/cloudtasks.enqueuer' to 'sa@example.com'. Original error: 403 Forbidden by policy
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_enqueue_run_task_generic_exception 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:00 [ERROR] Failed to create task for http://example.com/race: Network error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 124, in enqueue_run_task
    response = client.create_task(parent=parent_path, task=task)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Network error
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_schedule_all_races_real_run_no_service_url 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:01 [CRITICAL] Cannot execute real run without a service_url.
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_schedule_all_races_cloud_tasks_client_init_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:01 [CRITICAL] Failed to initialize Cloud Tasks client: Client init failed
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scheduler.py", line 209, in schedule_all_races
    client = tasks_v2.CloudTasksClient()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
Exception: Client init failed
PASSED                                                                   [ 55%]
tests/test_scheduler_extended.py::test_schedule_all_races_results_are_sorted 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:01 [INFO] --- Starting schedule_all_races (Force: True, Dry Run: False) ---
2026-01-01 09:39:01 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:01.019880+00:00
2026-01-01 09:39:01 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:01.020184+00:00
2026-01-01 09:39:01 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:01.020423+00:00
2026-01-01 09:39:01 [INFO] [Force Mode] Forced schedule to now + 2 minutes: 2026-01-01T08:41:01.020660+00:00
2026-01-01 09:39:01 [INFO] Calculation complete. Candidates: 4, Skipped: 0
2026-01-01 09:39:01 [INFO] --- Executing real run. Initializing Cloud Tasks client. ---
2026-01-01 09:39:01 [INFO] --- schedule_all_races complete. ---
PASSED                                                                   [ 56%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_success PASSED [ 56%]
tests/test_scraper_boturfers.py::test_boturfers_fetcher_init_value_error PASSED [ 56%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_success PASSED  [ 56%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_request_error PASSED [ 56%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_httpx_status_error PASSED [ 56%]
tests/test_scraper_boturfers.py::test_fetcher_fetch_html_generic_exception PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_success PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_missing_elements PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[14h30-14:30] PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[9h05-09:05] PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[11:15-11:15] PASSED [ 57%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[invalid-None] PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[-None] PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_time_formats[None-None] PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_row_runners_count_non_digit PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_success PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_reunion_tabs PASSED [ 58%]
tests/test_scraper_boturfers.py::test_fetcher_parse_programme_no_race_table_in_reunion PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_success PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_distance_not_found PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_success PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_metadata_no_info_block PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_success PASSED [ 59%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_no_runners_table PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_parse_race_runners_from_details_page_malformed_row PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_success PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_get_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:01 [ERROR] Erreur inattendue lors du fetch HTML de http://programme.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_success PASSED [ 60%]
tests/test_scraper_boturfers.py::test_fetcher_get_race_snapshot_fetch_html_fails 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:01 [ERROR] Erreur inattendue lors du fetch HTML de http://race.url: Mock error
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/scrapers/boturfers.py", line 51, in _fetch_html
    response = await client.get(self.race_url, headers=HTTP_HEADERS, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 2262, in _execute_mock_call
    raise effect
httpx.RequestError: Mock error
PASSED                                                                   [ 60%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_empty_url PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_fetcher_error PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_no_races_returned PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_programme_general_exception PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_success PASSED [ 61%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_empty_url PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_url_partant_transformation PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_fetcher_error PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_no_runners_returned PASSED [ 62%]
tests/test_scraper_boturfers.py::test_fetch_boturfers_race_details_general_exception PASSED [ 62%]
tests/test_scraper_geny.py::test_slugify[Paris-Vincennes (FR)-paris-vincennes-fr] PASSED [ 63%]
tests/test_scraper_geny.py::test_slugify[Hippodrome de la C\xf4te d'Azur-hippodrome-de-la-cote-d-azur] PASSED [ 63%]
tests/test_scraper_geny.py::test_slugify[Saint-Cloud-saint-cloud] PASSED [ 63%]
tests/test_scraper_geny.py::test_slugify[123 Test-123-test] PASSED       [ 63%]
tests/test_scraper_geny.py::test_slugify[-] PASSED                       [ 63%]
tests/test_scraper_geny.py::test_slugify[   -] PASSED                    [ 63%]
tests/test_scraper_geny.py::test_slugify[  _!@# my string 123-my-string-123] PASSED [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Discovered 2 meetings from Geny
PASSED                                                                   [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_no_races_container 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [WARNING] No 'next-races-container' found on Geny page.
PASSED                                                                   [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_empty_rows 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_malformed_row_elements 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [WARNING] Could not find meeting element 'th.race-name' in a row. Skipping row.
2026-01-01 09:39:02 [INFO] Discovered 0 meetings from Geny
PASSED                                                                   [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_request_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [ERROR] An error occurred while requesting 'http://mock.url': Mock request error
PASSED                                                                   [ 64%]
tests/test_scraper_geny.py::test_fetch_geny_programme_httpx_status_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [ERROR] Error response 404 while requesting 'http://mock.url': Not Found
PASSED                                                                   [ 65%]
tests/test_scraper_geny.py::test_fetch_geny_programme_id_course_from_href_fallback 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Discovered 1 meetings from Geny
PASSED                                                                   [ 65%]
tests/test_scraper_zeturf.py::test_fetch_race_snapshot_full_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] [ZEturf] phase=H30 url=https://www.zeturf.fr/fr/course/2025-11-20/R1C1-saint-galmier partants=12
PASSED                                                                   [ 65%]
tests/test_scraper_zeturf.py::test_phase_norm[H-30-H30] PASSED           [ 65%]
tests/test_scraper_zeturf.py::test_phase_norm[H30-H30] PASSED            [ 65%]
tests/test_scraper_zeturf.py::test_phase_norm[h05-H5] PASSED             [ 65%]
tests/test_scraper_zeturf.py::test_phase_norm[H5-H5] PASSED              [ 66%]
tests/test_scraper_zeturf.py::test_phase_norm[UNKNOWN-H30] PASSED        [ 66%]
tests/test_scraper_zeturf.py::test_phase_norm[-H30] PASSED               [ 66%]
tests/test_scraper_zeturf.py::test_phase_norm[None-H30] PASSED           [ 66%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_success PASSED [ 66%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_value_error_no_rc PASSED [ 66%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_empty_snapshot PASSED [ 67%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_missing_runners PASSED [ 67%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_non_dict_snapshot PASSED [ 67%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_h5_phase_input PASSED [ 67%]
tests/test_scraper_zeturf.py::test_fetch_zeturf_race_details_various_rc_formats PASSED [ 67%]
tests/test_service.py::test_get_pronostics_page 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 67%]
tests/test_service.py::test_get_pronostics_data_empty_case 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 68%]
tests/test_service.py::test_get_pronostics_data_with_data 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 68%]
tests/test_service.py::test_get_ops_status 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 68%]
tests/test_service.py::test_get_ops_status_reason_if_empty 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/ops/status?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 68%]
tests/test_service.py::test_health_check 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 68%]
tests/test_service.py::test_legacy_redirects 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/api/pronostics/ui "HTTP/1.1 307 Temporary Redirect"
PASSED                                                                   [ 68%]
tests/test_service.py::test_post_ops_run_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Manual run triggered for race R1C1 on 2026-01-01
2026-01-01 09:39:02 [INFO] Successfully processed and saved manual run for 2026-01-01_R1C1
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: POST http://testserver/ops/run?rc=R1C1 "HTTP/1.1 200 OK"
PASSED                                                                   [ 69%]
tests/test_service.py::test_api_pronostics_schema 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-01 "HTTP/1.1 200 OK"
PASSED                                                                   [ 69%]
tests/test_service.py::test_ui_contains_critical_elements_and_api_call 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 69%]
tests/test_service_smoke.py::test_ping_endpoint 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/health "HTTP/1.1 200 OK"
PASSED                                                                   [ 69%]
tests/test_service_smoke.py::test_pronostics_endpoint_returns_data 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:02 [INFO] Request started
2026-01-01 09:39:02 [INFO] Request finished
2026-01-01 09:39:02 [INFO] HTTP Request: GET http://testserver/api/pronostics?date=2025-01-10 "HTTP/1.1 200 OK"
PASSED                                                                   [ 69%]
tests/test_simulate_ev_module.py::test_implied_probs_normalizes PASSED   [ 69%]
tests/test_simulate_ev_module.py::test_normalize_overround_balances_dict PASSED [ 70%]
tests/test_simulate_ev_module.py::test_kelly_fraction_basic PASSED       [ 70%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_cap PASSED   [ 70%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_min_stake_filter PASSED [ 70%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_skips_invalid PASSED [ 70%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_uses_precomputed_implied_probs PASSED [ 70%]
tests/test_simulate_ev_module.py::test_allocate_dutching_sp_fallbacks_when_probabilities_invalid PASSED [ 71%]
tests/test_simulate_ev_module.py::test_gate_ev_thresholds PASSED         [ 71%]
tests/test_simulate_ev_module.py::test_gate_ev_sharpe_min PASSED         [ 71%]
tests/test_simulate_ev_module.py::test_simulate_ev_batch_uses_simulate_wrapper PASSED [ 71%]
tests/test_simulate_wrapper.py::test_calibration_details_expose_metadata PASSED [ 71%]
tests/test_simulate_wrapper.py::test_beta_binomial_fallback PASSED       [ 71%]
tests/test_simulate_wrapper.py::test_invalid_calibration PASSED          [ 72%]
tests/test_simulate_wrapper.py::test_combination_order PASSED            [ 72%]
tests/test_simulate_wrapper.py::test_cache_prevents_recomputation PASSED [ 72%]
tests/test_simulate_wrapper.py::test_cache_eviction PASSED               [ 72%]
tests/test_simulate_wrapper.py::test_fallback_uses_leg_probabilities PASSED [ 72%]
tests/test_simulate_wrapper.py::test_fallback_uses_implied_odds PASSED   [ 72%]
tests/test_simulate_wrapper.py::test_correlation_penalty_reduces_probability_and_ev PASSED [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'11"6-71.6] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'12''3-72.3] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[1'10"-70.0] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[59"8-59.8] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[None-None] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 73%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[-None] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 74%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_parse_chrono_to_seconds[invalid-None] 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:03 [WARNING] Could not parse chrono string: invalid
PASSED                                                                   [ 74%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_horse_chrono_parsing 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 74%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_jockey_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 74%]
tests/test_stats_provider.py::TestZoneTurfProviderParsing::test_fetch_trainer_stats_parsing 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 74%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_cache_hit 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 75%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_scraping 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 75%]
tests/test_stats_provider.py::TestZoneTurfIdResolution::test_resolve_entity_id_not_found 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 75%]
tests/test_stats_provider_extended.py::test_slugify PASSED               [ 75%]
tests/test_stats_provider_extended.py::test_normalize_name 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 75%]
tests/test_stats_provider_extended.py::test_fetch_horse_chrono_success 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 75%]
tests/test_stats_provider_extended.py::test_fetch_jockey_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_stats_provider_extended.py::test_fetch_trainer_stats_success 
-------------------------------- live log setup --------------------------------
2026-01-01 09:39:03 [INFO] ZoneTurfProvider initialized.
PASSED                                                                   [ 76%]
tests/test_tickets_store.py::test_client_returns_storage_client PASSED   [ 76%]
tests/test_tickets_store.py::test_blob_path_constructs_correct_path PASSED [ 76%]
tests/test_tickets_store.py::test_index_path_constructs_correct_path PASSED [ 76%]
tests/test_tickets_store.py::test_render_ticket_html_full_payload PASSED [ 76%]
tests/test_tickets_store.py::test_render_ticket_html_minimal_payload PASSED [ 77%]
tests/test_tickets_store.py::test_render_ticket_html_different_keys_for_ev_roi_tickets PASSED [ 77%]
tests/test_tickets_store.py::test_save_ticket_html_success PASSED        [ 77%]
tests/test_tickets_store.py::test_save_ticket_html_no_bucket_env_var_raises_error PASSED [ 77%]
tests/test_tickets_store.py::test_build_and_save_ticket_success PASSED   [ 77%]
tests/test_tickets_store.py::test_list_ticket_objects_success PASSED     [ 77%]
tests/test_tickets_store.py::test_list_ticket_objects_empty_list PASSED  [ 78%]
tests/test_tickets_store.py::test_list_ticket_objects_no_bucket_env_var_raises_error PASSED [ 78%]
tests/test_tickets_store.py::test_rebuild_index_success PASSED           [ 78%]
tests/test_tickets_store.py::test_rebuild_index_no_bucket_env_var_raises_error PASSED [ 78%]
tests/test_tickets_store.py::test_load_ticket_html_success PASSED        [ 78%]
tests/test_tickets_store.py::test_load_ticket_html_no_bucket_env_var_raises_error PASSED [ 78%]
tests/test_ui.py::test_read_main 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:04 [INFO] Request started
2026-01-01 09:39:04 [INFO] Request finished
2026-01-01 09:39:04 [INFO] HTTP Request: GET http://testserver/pronostics "HTTP/1.1 200 OK"
PASSED                                                                   [ 79%]
tests/test_update_excel_planning.py::test_cli_invalid_phase_raises_error PASSED [ 79%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[nb_partants-10-partants-10] PASSED [ 79%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[runners_count-11 partants-partants-11] PASSED [ 79%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[start-10h30-start_time-10:30] PASSED [ 79%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[heure_depart-11:00-start_time-11:00] PASSED [ 79%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[specialite-Steeple-discipline-Steeple] PASSED [ 80%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[r-R5-reunion-R5] PASSED [ 80%]
tests/test_update_excel_planning.py::test_extract_common_meta_aliases[c-C6-course-C6] PASSED [ 80%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets0-] PASSED [ 80%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets1-SG:1@4.5] PASSED [ 80%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets2-JUM:2-4@12.1 | TRIO:5-6-7] PASSED [ 80%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets3-WEIRD:8-9] PASSED [ 81%]
tests/test_update_excel_planning.py::test_summarise_tickets_formats[tickets4-2S4:10-11-12] PASSED [ 81%]
tests/test_update_excel_planning.py::test_h30_updates_existing_row PASSED [ 81%]
tests/test_update_excel_planning.py::test_h30_populates_planning_sheet PASSED [ 81%]
tests/test_update_excel_planning.py::test_h5_updates_status_and_tickets PASSED [ 81%]
tests/test_update_excel_planning.py::test_h5_abstention_uses_reason PASSED [ 81%]
tests/test_update_excel_planning.py::test_h5_preserves_existing_metadata_when_missing PASSED [ 82%]
tests/test_update_excel_planning.py::test_h5_converts_timezone_when_tz_env_set PASSED [ 82%]
tests/test_update_excel_planning.py::test_custom_status_h5_flag PASSED   [ 82%]
tests/test_update_excel_planning.py::test_custom_status_h30_and_h5 PASSED [ 82%]
tests/test_update_excel_planning.py::test_h30_preserves_existing_comment PASSED [ 82%]
tests/test_update_excel_planning.py::test_h30_handles_nested_course_payload PASSED [ 82%]
tests/test_update_excel_planning.py::test_h30_infers_rc_fields PASSED    [ 83%]
tests/test_update_excel_planning.py::test_h5_infers_rc_fields PASSED     [ 83%]
tests/test_update_excel_planning.py::test_h5_compact_ticket_summary PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_respects_input_timezone PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_uses_env_timezone PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[13h05-13:05] PASSED [ 83%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[7h-07:00] PASSED [ 84%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[09 heures 30-09:30] PASSED [ 84%]
tests/test_update_excel_planning.py::test_format_time_handles_textual_hours[18.45-18:45] PASSED [ 84%]
tests/test_update_excel_planning.py::test_cli_alias_and_dash_phase PASSED [ 84%]
tests/test_update_excel_with_results.py::test_update_excel_records_observed_roi PASSED [ 84%]
tests/test_validator_ev.py::test_validate_ev_passes_with_defaults 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 84%]
tests/test_validator_ev.py::test_validate_ev_sp_below_threshold 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_combo_optional 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_combo_required 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_logs_context 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': 18.0, 'stake': 10.0, 'EV_ratio': 0.35}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_probability 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': None, 'payout_expected': 25.0, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_ev_invalid_input_for_missing_payout 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] [validate_ev] context {'p_success': 0.45, 'payout_expected': None, 'stake': None, 'EV_ratio': None}
PASSED                                                                   [ 85%]
tests/test_validator_ev.py::test_validate_policy_pass PASSED             [ 86%]
tests/test_validator_ev.py::test_validate_policy_fail_ev PASSED          [ 86%]
tests/test_validator_ev.py::test_validate_policy_fail_roi PASSED         [ 86%]
tests/test_validator_ev.py::test_validate_combos_pass PASSED             [ 86%]
tests/test_validator_ev.py::test_validate_combos_fail_default PASSED     [ 86%]
tests/test_validator_ev.py::test_combos_allowed_thresholds PASSED        [ 86%]
tests/test_validator_ev.py::test_validate_inputs_ok PASSED               [ 87%]
tests/test_validator_ev.py::test_validate_inputs_partants_insuffisants PASSED [ 87%]
tests/test_validator_ev.py::test_validate_inputs_cote_none PASSED        [ 87%]
tests/test_validator_ev.py::test_validate_inputs_couverture PASSED       [ 87%]
tests/test_validator_ev.py::test_summarise_validation_success PASSED     [ 87%]
tests/test_validator_ev.py::test_summarise_validation_failure_returns_reason PASSED [ 88%]
tests/test_validator_ev.py::test_validator_cli_returns_non_zero_on_failure PASSED [ 88%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_success PASSED [ 88%]
tests/test_validator_ev_extended.py::test_readme_has_roi_sp_no_match PASSED [ 88%]
tests/test_validator_ev_extended.py::test_must_have PASSED               [ 88%]
tests/test_validator_ev_extended.py::test_validate_missing_odds PASSED   [ 88%]
tests/test_validator_ev_extended.py::test_validate_invalid_odds PASSED   [ 89%]
tests/test_validator_ev_extended.py::test_validate_missing_je_stats PASSED [ 89%]
tests/test_validator_ev_extended.py::test_validate_budget_fails PASSED   [ 89%]
tests/test_validator_ev_extended.py::test_prepare_validation_inputs PASSED [ 89%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-jullou] PASSED [ 89%]
tests/test_zoneturf_client.py::test_normalize_name[  Jullou  -jullou] PASSED [ 89%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou (FR)-jullou] PASSED [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard-jullou nivard] PASSED [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou-Nivard (FR)-jullou nivard] PASSED [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[\xc9curie Royale-ecurie royale] PASSED [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[Jullou's Horse-jullous horse] PASSED [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[-] PASSED             [ 90%]
tests/test_zoneturf_client.py::test_normalize_name[None-] PASSED         [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11"6-71.6] PASSED  [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'15''3-75.3] PASSED [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'20"0-80.0] PASSED  [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[0'59"9-59.9] PASSED  [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[None-None] PASSED    [ 91%]
tests/test_zoneturf_client.py::test_parse_rk_string[-None] PASSED        [ 92%]
tests/test_zoneturf_client.py::test_parse_rk_string[invalid-None] PASSED [ 92%]
tests/test_zoneturf_client.py::test_parse_rk_string[1'11-None] PASSED    [ 92%]
tests/test_zoneturf_client.py::test_resolve_horse_id_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-01 09:39:05 [INFO] Resolved 'Jullou' to ID: 1772764
PASSED                                                                   [ 92%]
tests/test_zoneturf_client.py::test_resolve_horse_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] Resolving Zone-Turf ID for 'NonExistentHorse' via alphabetical pages...
PASSED                                                                   [ 92%]
tests/test_zoneturf_client.py::test_resolve_horse_id_network_error 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
2026-01-01 09:39:05 [WARNING] Failed to fetch page https://www.zone-turf.fr/cheval/lettre-j.html?p=1: Network issue
PASSED                                                                   [ 92%]
tests/test_zoneturf_client.py::test_resolve_horse_id_cache_hit PASSED    [ 93%]
tests/test_zoneturf_client.py::test_resolve_horse_id_no_alpha_in_name PASSED [ 93%]
tests/test_zoneturf_client.py::test_resolve_person_id_success 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] Resolving Zone-Turf ID for 'Julien Dupont' (jockey) via alphabetical pages...
2026-01-01 09:39:05 [INFO] Resolved 'Julien Dupont' to ID: 112233
PASSED                                                                   [ 93%]
tests/test_zoneturf_client.py::test_resolve_person_id_cache_hit PASSED   [ 93%]
tests/test_zoneturf_client.py::test_resolve_person_id_not_found 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:05 [INFO] Resolving Zone-Turf ID for 'NonExistentJockey' (jockey) via alphabetical pages...
PASSED                                                                   [ 93%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_with_jullou_page PASSED [ 93%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_no_chrono_data PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_empty_content PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_record PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_malformed_table_chrono PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_chrono_from_html_correctly_finds_jullou_chrono PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_success PASSED [ 94%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_no_stats_block PASSED [ 95%]
tests/test_zoneturf_client.py::test_fetch_person_stats_from_html_empty_content PASSED [ 95%]
tests/test_zoneturf_client.py::test_get_chrono_stats_success PASSED      [ 95%]
tests/test_zoneturf_client.py::test_get_chrono_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Could not get Zone-Turf ID for horse: Jullou
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_get_chrono_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Failed to fetch Zone-Turf page for Jullou due to network error
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_get_chrono_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Failed to fetch Zone-Turf page for Jullou (ID: 1772764) with status 404
PASSED                                                                   [ 95%]
tests/test_zoneturf_client.py::test_get_chrono_stats_cache_hit PASSED    [ 96%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_success PASSED [ 96%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_id_not_resolved 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Could not get Zone-Turf ID for jockey: Julien Dupont
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_cache_hit PASSED [ 96%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_network_error_fetching_page 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont due to network error
PASSED                                                                   [ 96%]
tests/test_zoneturf_client.py::test_get_jockey_trainer_stats_page_fetch_failed 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Failed to fetch Zone-Turf page for jockey Julien Dupont (ID: 112233) with status 404
PASSED                                                                   [ 96%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/cheval/lettre-t.html?p=1
PASSED                                                                   [ 97%]
tests/test_zoneturf_client_extended.py::test_resolve_horse_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [INFO] Resolving Zone-Turf ID for 'Jullou' via alphabetical pages...
PASSED                                                                   [ 97%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_info_card PASSED [ 97%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_performance_card PASSED [ 97%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_tag PASSED [ 97%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_no_record_text PASSED [ 97%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_list_group PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_attelle_li PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_no_red_km_header PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_malformed_row PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_performance_other_horse_name PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_fetch_chrono_from_html_multiple_attelle_sections PASSED [ 98%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_non_200_status 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [WARNING] Received non-200 status code 404 for URL: https://www.zone-turf.fr/jockey/lettre-t.html?p=1
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_resolve_person_id_url_without_id 
-------------------------------- live log call ---------------------------------
2026-01-01 09:39:06 [INFO] Resolving Zone-Turf ID for 'TestPerson' (jockey) via alphabetical pages...
PASSED                                                                   [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_rates PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_missing_table PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_malformed_table_data PASSED [ 99%]
tests/test_zoneturf_client_extended.py::test_fetch_person_stats_from_html_no_stat_paragraph PASSED [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                         Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------------------
config/__init__.py                                               0      0      0      0   100%
config/env_utils.py                                             37      0     16      0   100%
config/test_env_utils.py                                        24     24      0      0     0%   1-30
hippique_orchestrator/__init__.py                                1      0      0      0   100%
hippique_orchestrator/analysis_pipeline.py                      97      0     14      1    99%   82->85
hippique_orchestrator/analysis_utils.py                        181      8     82      8    93%   61-62, 68-69, 103->105, 107-108, 109->112, 224->252, 229->235, 247, 315->323, 372
hippique_orchestrator/api/__init__.py                            1      0      0      0   100%
hippique_orchestrator/api/tasks.py                              74      9     10      1    88%   85-91, 134-140, 214->194, 242-248
hippique_orchestrator/auth.py                                   28      4      8      2    83%   29, 33, 63-64
hippique_orchestrator/config.py                                 19      0      0      0   100%
hippique_orchestrator/data_source.py                            16      5      2      0    61%   61-69
hippique_orchestrator/ev_calculator.py                         522     36    208     13    91%   164->171, 171->161, 291, 340, 417, 479, 498-499, 540->543, 643-687, 731, 897, 923, 957-962
hippique_orchestrator/fetch_je_stats.py                        259     58     66     18    76%   62-69, 73, 86-93, 109, 129, 132, 149, 181->183, 191-192, 197, 205->202, 207-208, 226->231, 229-230, 232->237, 235-236, 279->303, 283->303, 290->294, 294->298, 298->303, 300-301, 348-371, 375-399, 404-408, 412
hippique_orchestrator/firestore_client.py                       71      3     24      2    95%   47-48, 136
hippique_orchestrator/gcs_client.py                             71     17     14      2    75%   43->45, 91-98, 112-114, 124, 144-148
hippique_orchestrator/gcs_utils.py                              49     49     10      0     0%   3-86
hippique_orchestrator/kelly.py                                  42      6     18      4    83%   12, 14-15, 48, 59, 61
hippique_orchestrator/logging_io.py                             39     19     10      3    47%   42-44, 47->51, 59-66, 71-79
hippique_orchestrator/logging_middleware.py                     22      4      0      0    82%   50-61
hippique_orchestrator/logging_utils.py                          32      1      6      3    89%   18->20, 20->exit, 32->35, 60
hippique_orchestrator/overround.py                              25     25     10      0     0%   8-77
hippique_orchestrator/p_finale.py                               39     39     20      0     0%   7-98
hippique_orchestrator/pipeline_run.py                          353     55    142     33    80%   45, 82-83, 86-89, 98, 100, 105-108, 157, 162-182, 212-213, 219, 233, 234->237, 240, 242, 260, 264, 285-286, 322->337, 367->369, 379->385, 393, 396, 435-436, 437->425, 460, 498->494, 503->507, 507->535, 541, 544-548, 569-570, 582, 590-591, 599->586, 612->586, 618->632, 684-685
hippique_orchestrator/plan.py                                   42      0     16      0   100%
hippique_orchestrator/post_course_payload.py                   181    181     62      0     0%   3-319
hippique_orchestrator/runner.py                                 35     10      6      2    66%   27-32, 50-52, 92-101
hippique_orchestrator/scheduler.py                             101      0     28      0   100%
hippique_orchestrator/schemas.py                                32      0      0      0   100%
hippique_orchestrator/scrapers/__init__.py                       0      0      0      0   100%
hippique_orchestrator/scrapers/boturfers.py                    206     18     80     12    87%   74, 78, 99-104, 109, 143->141, 151, 162-164, 170, 186->191, 187->186, 193-196, 202-204, 217
hippique_orchestrator/scrapers/geny.py                          61      1     14      2    96%   87, 95->98
hippique_orchestrator/scrapers/zeturf.py                        26      0      6      0   100%
hippique_orchestrator/scripts/__init__.py                        0      0      0      0   100%
hippique_orchestrator/scripts/backup_restore.py                202    202     48      0     0%   14-343
hippique_orchestrator/scripts/concat_je_month.py               105    105     44      0     0%   12-205
hippique_orchestrator/scripts/cron_decider.py                   66     66     20      0     0%   10-137
hippique_orchestrator/scripts/drive_sync.py                      8      8      2      0     0%   7-20
hippique_orchestrator/scripts/enrich_requirements.py            49     49     20      0     0%   4-100
hippique_orchestrator/scripts/fetch_je_chrono.py                84     84     22      0     0%   3-189
hippique_orchestrator/scripts/fetch_je_stats.py                248    248     62      0     0%   3-404
hippique_orchestrator/scripts/gcs_utils.py                      14     14      8      0     0%   3-23
hippique_orchestrator/scripts/guardrails.py                     39      0     14      0   100%
hippique_orchestrator/scripts/lint_sources.py                   94     94     32      0     0%   3-190
hippique_orchestrator/scripts/merge_all_data.py                 21     21      2      0     0%   1-42
hippique_orchestrator/scripts/monitor_roi.py                   204    204     44      0     0%   14-347
hippique_orchestrator/scripts/online_fetch_zeturf.py          1044    541    574     98    43%   53-62, 83, 95-96, 100, 110, 116-117, 121->124, 151-159, 171-178, 191, 198->210, 212-213, 216, 225-236, 246, 265-277, 281->279, 286-287, 288->283, 291, 317, 337->339, 340, 342, 349-352, 360-361, 365, 373, 377, 379, 394->397, 398->403, 400->403, 405-407, 411->422, 413->422, 417->419, 419->422, 422->391, 428->434, 440-442, 446->449, 451->454, 467-485, 496-515, 526-603, 609-622, 635-681, 703, 706, 710-717, 721-724, 729, 741, 744, 774-802, 810-818, 828, 837, 857->853, 869, 872-878, 909-910, 922->925, 940->945, 943->945, 946, 982->978, 1008-1015, 1020-1024, 1037->1044, 1039->1038, 1041->1038, 1044->1081, 1049-1053, 1056-1061, 1066-1067, 1069->1063, 1091-1095, 1098-1102, 1105-1109, 1111->1127, 1118->1125, 1128-1133, 1136, 1163, 1165-1168, 1180, 1182, 1188-1195, 1206-1229, 1237-1430, 1445, 1452->1456, 1454->1453, 1499->1501, 1501->1503, 1503->1507, 1522->1528, 1524->1522, 1529, 1536, 1549->1552, 1555-1556, 1558-1559, 1561->1586, 1564, 1605-1608, 1613, 1616-1617, 1625, 1632-1633, 1640-1641, 1644->1653, 1651, 1689-1848, 1853, 1857
hippique_orchestrator/scripts/p_finale_export.py                80     30     30     10    56%   15-17, 28-38, 44, 49-50, 69-70, 80->87, 81->80, 84->80, 88-89, 97-100, 103-104, 110, 123-125
hippique_orchestrator/scripts/resolve_course_id.py             141     52     64     13    59%   41, 44, 47-48, 52, 60, 82->88, 84->88, 89-94, 106, 120-170, 178, 182, 204->209, 206->209, 210-213, 226-256
hippique_orchestrator/scripts/restore_from_drive.py             33     33     12      0     0%   3-56
hippique_orchestrator/scripts/simulate_ev.py                   221    221     98      0     0%   3-364
hippique_orchestrator/scripts/simulate_wrapper.py              469    469    240      0     0%   15-815
hippique_orchestrator/scripts/snapshot_enricher.py              16     16      2      0     0%   1-31
hippique_orchestrator/scripts/update_excel_planning.py         424     40    226     46    86%   46, 50, 84, 96->94, 110-111, 122, 125, 130-131, 148-154, 157->159, 166->163, 186, 195, 197, 203, 233->235, 237->239, 253->261, 258-259, 267->269, 271->262, 339, 343, 357, 378, 391, 396->395, 412, 415, 418, 423, 429, 437, 448, 462, 479->481, 481->483, 484->486, 491, 493->446, 551, 555, 558, 581, 610->609, 616, 682
hippique_orchestrator/scripts/update_excel_with_results.py     183    183     66      0     0%   3-426
hippique_orchestrator/service.py                               203     49     36      4    76%   35-37, 141->117, 219-245, 252-253, 269, 274, 291-301, 315, 338-347, 355, 379-420
hippique_orchestrator/simulate_ev.py                           221     58     98     19    71%   19-20, 22, 34-35, 37, 41, 64, 76-77, 88-89, 102-103, 112-113, 122-123, 143, 162, 182, 186->188, 190-191, 198, 270, 272, 281, 297-326, 332->340, 336, 340->353, 348-349, 353->360, 357, 360->exit, 364
hippique_orchestrator/simulate_wrapper.py                      475     79    236     48    79%   109, 121, 129->132, 130->129, 154-158, 166, 172, 189, 191, 200, 202, 249, 262, 269, 285, 314, 316->311, 334-337, 339, 346->374, 349, 352->359, 357->359, 371->347, 385, 389, 403, 405, 409, 427, 447, 460-461, 483-502, 506->510, 507->506, 547, 578, 606-611, 626, 638-639, 659-665, 687, 691, 694, 697-699, 759-763, 788, 806, 809, 815->814, 831-837
hippique_orchestrator/snapshot_manager.py                       28     20      6      0    24%   27-68, 85
hippique_orchestrator/stats_fetcher.py                          79     79     20      0     0%   5-181
hippique_orchestrator/stats_provider.py                        299    111    102     27    60%   31, 136, 151-170, 176-192, 200, 207-259, 288-289, 295, 309->321, 312->310, 317->310, 323->336, 328, 331->324, 333->324, 337->340, 341-342, 346-353, 360, 375-376, 380-381, 387->385, 392-393, 399->385, 406-407, 411-419, 425, 439-442, 446-447, 451->449, 456-457, 463->449, 470-471, 475-483
hippique_orchestrator/tickets_store.py                          67      0      6      1    99%   137->131
hippique_orchestrator/time_utils.py                             14      4      2      1    69%   15, 22, 35, 44
hippique_orchestrator/validator_ev.py                          304    124    140     22    58%   28-37, 43, 50-51, 133, 150, 152, 160, 170->168, 172, 299-300, 303-304, 355, 358, 371, 378-382, 386-400, 409-415, 420-429, 432, 440, 445, 449-453, 464-467, 477-478, 500, 506-507, 516-571, 575
hippique_orchestrator/zoneturf_client.py                       252     11    116     13    93%   48-49, 59, 111->124, 127->161, 134->157, 148->154, 174, 182-183, 205-207, 246->270, 251->256, 258->263, 265->270, 288, 324
--------------------------------------------------------------------------------------------------------
TOTAL                                                         8373   3787   3264    408    53%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================= 592 passed in 22.47s =============================
