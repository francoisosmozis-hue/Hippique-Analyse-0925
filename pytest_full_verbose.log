============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.6.0 -- /home/francoisosmozis/hippique-orchestrator/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/francoisosmozis/hippique-orchestrator
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.12.1, pyfakefs-6.0.0, cov-7.0.0, mock-3.14.0, asyncio-0.23.7
asyncio: mode=Mode.STRICT
collecting ... collected 1144 items

tests/hippique/utils/test_probabilities.py::test_implied_prob_from_odds_valid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_implied_prob_from_odds_invalid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_valid_input PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_empty_list PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_no_vig_probs_invalid_odds_in_list PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_positive_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_negative_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_zero_ev PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_various_stakes PASSED [  0%]
tests/hippique/utils/test_probabilities.py::test_expected_value_simple_edge_cases PASSED [  0%]
tests/providers/test_geny_provider.py::test_geny_provider_initialization 
-------------------------------- live log setup --------------------------------
2026-01-11 21:59:44 [INFO] GenyProvider initialized.
PASSED                                                                   [  0%]
tests/providers/test_geny_provider.py::test_fetch_stats_for_runner_returns_stats 
-------------------------------- live log setup --------------------------------
2026-01-11 21:59:44 [INFO] GenyProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Fetching Geny stats for: Y. LEBOURGEOIS
2026-01-11 21:59:44 [INFO] Stats parsées depuis Geny: {'driver_rate': 0.155}
PASSED                                                                   [  1%]
tests/providers/test_geny_provider.py::test_fetch_stats_for_runner_handles_no_driver 
-------------------------------- live log setup --------------------------------
2026-01-11 21:59:44 [INFO] GenyProvider initialized.
PASSED                                                                   [  1%]
tests/providers/test_geny_provider.py::test_fetch_stats_for_runner_handles_fetch_failure 
-------------------------------- live log setup --------------------------------
2026-01-11 21:59:44 [INFO] GenyProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Fetching Geny stats for: Y. LEBOURGEOIS
2026-01-11 21:59:44 [WARNING] Impossible de récupérer la page pour Y. LEBOURGEOIS sur Geny.
PASSED                                                                   [  1%]
tests/providers/test_geny_provider.py::test_fetch_stats_uses_cache 
-------------------------------- live log setup --------------------------------
2026-01-11 21:59:44 [INFO] GenyProvider initialized.
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Fetching Geny stats for: Y. LEBOURGEOIS
2026-01-11 21:59:44 [INFO] Stats parsées depuis Geny: {'driver_rate': 0.155}
PASSED                                                                   [  1%]
tests/providers/test_zeturf_provider.py::test_zeturf_provider_initialization PASSED [  1%]
tests/providers/test_zeturf_provider.py::test_fetch_snapshot_returns_normalized_data 
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Début du scraping ZEturf: https://www.zeturf.fr/fr/course/2024-01-11/R1C1-prix-de-la-course
PASSED                                                                   [  1%]
tests/providers/test_zeturf_provider.py::test_fetch_snapshot_handles_http_error 
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Début du scraping ZEturf: https://www.zeturf.fr/fr/course/2024-01-11/R1C1-prix-de-la-course
2026-01-11 21:59:44 [ERROR] Failed to create RaceSnapshotNormalized for https://www.zeturf.fr/fr/course/2024-01-11/R1C1-prix-de-la-course: HTTP 404
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/sources/zeturf_provider.py", line 48, in _fetch_race_snapshot_sync
    html_content = self._http_get_sync(race_url)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1134, in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1138, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/unittest/mock.py", line 1193, in _execute_mock_call
    raise effect
RuntimeError: HTTP 404
PASSED                                                                   [  1%]
tests/providers/test_zeturf_provider.py::test_fetch_snapshot_handles_empty_runners 
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] Début du scraping ZEturf: https://www.zeturf.fr/fr/course/2024-01-11/R1C1-prix-de-la-course
2026-01-11 21:59:44 [ERROR] Failed to create RaceSnapshotNormalized for https://www.zeturf.fr/fr/course/2024-01-11/R1C1-prix-de-la-course: No runners found in snapshot data.
Traceback (most recent call last):
  File "/home/francoisosmozis/hippique-orchestrator/hippique_orchestrator/sources/zeturf_provider.py", line 52, in _fetch_race_snapshot_sync
    raise ValueError("No runners found in snapshot data.")
ValueError: No runners found in snapshot data.
PASSED                                                                   [  1%]
tests/providers/test_zeturf_provider.py::test_fetch_stats_for_runner_returns_empty_stats PASSED [  1%]
tests/scripts/test_monitor_roi.py::test_load_json_safe_success PASSED    [  1%]
tests/scripts/test_monitor_roi.py::test_load_json_safe_failure PASSED    [  1%]
tests/scripts/test_monitor_roi.py::test_parse_tracking_csv_success PASSED [  2%]
tests/scripts/test_monitor_roi.py::test_collect_analyses_no_date_filter PASSED [  2%]
tests/scripts/test_monitor_roi.py::test_collect_analyses_with_date_filter PASSED [  2%]
tests/scripts/test_monitor_roi.py::test_compute_statistics PASSED        [  2%]
tests/scripts/test_monitor_roi.py::test_compute_statistics_no_races_played PASSED [  2%]
tests/scripts/test_monitor_roi.py::test_print_report PASSED              [  2%]
tests/scripts/test_monitor_roi.py::test_export_json PASSED               [  2%]
tests/scripts/test_monitor_roi.py::test_main_run_once PASSED             [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_fallback_parse_html_extracts_data PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R1-C1-R1C1] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[1-2-R1C2] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag[R4C5-None-R4C5] PASSED [  2%]
tests/scripts/test_online_fetch_zeturf.py::test_normalise_rc_tag_raises_error PASSED [  3%]
tests/scripts/test_online_fetch_zeturf.py::test_coerce_runner_entry PASSED [  3%]
tests/scripts/test_online_fetch_zeturf.py::test_build_snapshot_payload PASSED [  3%]
tests/scripts/test_online_fetch_zeturf.py::test_fetch_race_snapshot_cli 
-------------------------------- live log call ---------------------------------
2026-01-11 21:59:44 [INFO] [CLI] snapshot chargé depuis snapshot.json
PASSED                                                                   [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[1-2-R1C2] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R1-C2-R1C2] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[R3-10-R3C10] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalise_rc_tag_valid[4-5-R4C5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_slugify_hippodrome PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[12,5-12.5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[15.5-15.5] PASSED [  3%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[20-20.0] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[abc-None] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_normalize_decimal[None-None] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_extracts_data PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_data_odd_attribute PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_cotes_infos_script PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_missing_cheval PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_fallback_parse_html_no_tbody PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw0-expected0] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw1-expected1] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw2-expected2] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw3-expected3] PASSED [  4%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw4-expected4] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw5-None] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw6-None] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_coverage.py::test_coerce_runner_entry_variations[raw7-expected7] PASSED [  5%]
tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_no_runners_table ERROR [  5%]

==================================== ERRORS ====================================
_________ ERROR at setup of test_fallback_parse_html_no_runners_table __________

    @pytest.fixture
    def zeturf_course_html():
        """Returns the content of the Zeturf course page fixture."""
        fixture_path = Path(__file__).parent.parent / "fixtures" / "zeturf_course_page.html"
>       return fixture_path.read_text(encoding="utf-8")

tests/scripts/test_online_fetch_zeturf_extended.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/usr/lib/python3.12/pathlib.py:1029: in read_text
    with self.open(mode='r', encoding=encoding, errors=errors) as f:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/home/francoisosmozis/hippique-orchestrator/tests/fixtures/zeturf_course_page.html')
mode = 'r', buffering = -1, encoding = 'utf-8', errors = None, newline = None

    def open(self, mode='r', buffering=-1, encoding=None,
             errors=None, newline=None):
        """
        Open the file pointed by this path and return a file object, as
        the built-in open() function does.
        """
        if "b" not in mode:
            encoding = io.text_encoding(encoding)
>       return io.open(self, mode, buffering, encoding, errors, newline)
E       FileNotFoundError: [Errno 2] No such file or directory: '/home/francoisosmozis/hippique-orchestrator/tests/fixtures/zeturf_course_page.html'

/usr/lib/python3.12/pathlib.py:1015: FileNotFoundError
=========================== short test summary info ============================
ERROR tests/scripts/test_online_fetch_zeturf_extended.py::test_fallback_parse_html_no_runners_table - FileNotFoundError: [Errno 2] No such file or directory: '/home/francoisosmozis/hippique-orchestrator/tests/fixtures/zeturf_course_page.html'
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 61 passed, 1 error in 5.35s ==========================
